

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>事件模型 &mdash; JS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="事件种类" href="event-type.html" />
    <link rel="prev" title="Text 节点和 DocumentFragment 节点" href="text.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html">stdlib 标准库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oop/index.html">面向对象编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">语法专题</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">DOM 模型</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="node.html">DOM 模型概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">document 对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="element.html">Element对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="attribute.html">属性的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html">Text 节点和 DocumentFragment 节点</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">事件模型</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#eventtarget">EventTarget 接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#eventtarget-addeventlistener">EventTarget.addEventListener()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eventtarget-removeeventlistener">EventTarget.removeEventListener()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eventtarget-dispatchevent">EventTarget.dispatchEvent()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">监听函数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#html-on">HTML 的 on- 属性</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">元素节点的事件属性</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eventtarget-addeventlistener">EventTarget.addEventListener()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">小结</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#this">this 的指向</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">事件的传播</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">事件的代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event">Event 对象概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event">Event 对象的实例属性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#event-bubbles-event-eventphase">Event.bubbles，Event.eventPhase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-cancelable-event-cancelbubble-event-defaultprevented">Event.cancelable，Event.cancelBubble，event.defaultPrevented</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-currenttarget-event-target">Event.currentTarget，Event.target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-type">Event.type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-timestamp">Event.timeStamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-istrusted">Event.isTrusted</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-detail">Event.detail</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#event">Event 对象的实例方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#event-preventdefault">Event.preventDefault()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-stoppropagation">Event.stopPropagation()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-stopimmediatepropagation">Event.stopImmediatePropagation()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-composedpath">Event.composedPath()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#customevent">CustomEvent 接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">参考链接</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="event-type.html">事件种类</a></li>
<li class="toctree-l2"><a class="reference internal" href="css.html">CSS操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="image.html">Image对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="mutationobserver.html">Mutation Observer API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bom/index.html">BOM 浏览器环境</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">DOM 模型</a> &raquo;</li>
        
      <li>事件模型</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>事件模型<a class="headerlink" href="#" title="永久链接至标题">¶</a></h1>
<p>事件的本质是程序各个组成部分之间的一种通信方式，也是异步编程的一种实现。DOM 支持大量的事件，本章介绍 DOM 的事件编程。</p>
<div class="section" id="eventtarget">
<span id="eventtarget"></span><h2>EventTarget 接口<a class="headerlink" href="#eventtarget" title="永久链接至标题">¶</a></h2>
<p>DOM 的事件操作（监听和触发），都定义在<code class="docutils literal notranslate"><span class="pre">EventTarget</span></code>接口。所有节点对象都部署了这个接口，其他一些需要事件通信的浏览器内置对象（比如，<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>、<code class="docutils literal notranslate"><span class="pre">AudioNode</span></code>、<code class="docutils literal notranslate"><span class="pre">AudioContext</span></code>）也部署了这个接口。</p>
<p>该接口主要提供三个实例方法。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>：绑定事件的监听函数</li>
<li><code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>：移除事件的监听函数</li>
<li><code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code>：触发事件</li>
</ul>
<div class="section" id="eventtarget-addeventlistener">
<span id="eventtarget-addeventlistener"></span><h3>EventTarget.addEventListener()<a class="headerlink" href="#eventtarget-addeventlistener" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">EventTarget.addEventListener()</span></code>用于在当前节点或对象上，定义一个特定事件的监听函数。一旦这个事件发生，就会执行监听函数。该方法没有返回值。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">target</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">[,</span> <span class="nx">useCapture</span><span class="p">]);</span>
</pre></div>
</div>
<p>该方法接受三个参数。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>：事件名称，大小写敏感。</li>
<li><code class="docutils literal notranslate"><span class="pre">listener</span></code>：监听函数。事件发生时，会调用该监听函数。</li>
<li><code class="docutils literal notranslate"><span class="pre">useCapture</span></code>：布尔值，表示监听函数是否在捕获阶段（capture）触发（参见后文《事件的传播》部分），默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>（监听函数只在冒泡阶段被触发）。该参数可选。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello world&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;btn&#39;</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">hello</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">button</span></code>节点的<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法绑定<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的监听函数<code class="docutils literal notranslate"><span class="pre">hello</span></code>，该函数只在冒泡阶段触发。</p>
<p>关于参数，有两个地方需要注意。</p>
<p>首先，第二个参数除了监听函数，还可以是一个具有<code class="docutils literal notranslate"><span class="pre">handleEvent</span></code>方法的对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">buttonElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">handleEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法的第二个参数，就是一个具有<code class="docutils literal notranslate"><span class="pre">handleEvent</span></code>方法的对象。</p>
<p>其次，第三个参数除了布尔值<code class="docutils literal notranslate"><span class="pre">useCapture</span></code>，还可以是一个属性配置对象。该对象有以下属性。</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">capture</span></code>：布尔值，表示该事件是否在<code class="docutils literal notranslate"><span class="pre">捕获阶段</span></code>触发监听函数。</li>
<li><code class="docutils literal notranslate"><span class="pre">once</span></code>：布尔值，表示监听函数是否只触发一次，然后就自动移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">passive</span></code>：布尔值，表示监听函数不会调用事件的<code class="docutils literal notranslate"><span class="pre">preventDefault</span></code>方法。如果监听函数调用了，浏览器将忽略这个要求，并在监控台输出一行警告。</li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法可以为针对当前对象的同一个事件，添加多个不同的监听函数。这些函数按照添加顺序触发，即先添加先触发。如果为同一个事件多次添加同一个监听函数，该函数只会执行一次，多余的添加将自动被去除（不必使用<code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>方法手动去除）。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello world&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">hello</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">hello</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>执行上面代码，点击文档只会输出一行<code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">world</span></code>。</p>
<p>如果希望向监听函数传递参数，可以用匿名函数包装一下监听函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">print</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;div1&#39;</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码通过匿名函数，向监听函数<code class="docutils literal notranslate"><span class="pre">print</span></code>传递了一个参数。</p>
<p>监听函数内部的<code class="docutils literal notranslate"><span class="pre">this</span></code>，指向当前事件所在的那个对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;p id=&quot;para&quot;&gt;Hello&lt;/p&gt;</span>
<span class="kd">var</span> <span class="nx">para</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;para&#39;</span><span class="p">);</span>
<span class="nx">para</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">);</span> <span class="c1">// &quot;P&quot;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，监听函数内部的<code class="docutils literal notranslate"><span class="pre">this</span></code>指向事件所在的对象<code class="docutils literal notranslate"><span class="pre">para</span></code>。</p>
</div>
<div class="section" id="eventtarget-removeeventlistener">
<span id="eventtarget-removeeventlistener"></span><h3>EventTarget.removeEventListener()<a class="headerlink" href="#eventtarget-removeeventlistener" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">EventTarget.removeEventListener</span></code>方法用来移除<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法添加的事件监听函数。该方法没有返回值。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>方法的参数，与<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法完全一致。它的第一个参数“事件类型”，大小写敏感。</p>
<p>注意，<code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>方法移除的监听函数，必须是<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法添加的那个监听函数，而且必须在同一个元素节点，否则无效。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{},</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>方法无效，因为监听函数不是同一个匿名函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="nx">handleMouseDown</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">handleMouseDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code>方法也是无效的，因为第三个参数不一样。</p>
</div>
<div class="section" id="eventtarget-dispatchevent">
<span id="eventtarget-dispatchevent"></span><h3>EventTarget.dispatchEvent()<a class="headerlink" href="#eventtarget-dispatchevent" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">EventTarget.dispatchEvent</span></code>方法在当前节点上触发指定事件，从而触发监听函数的执行。该方法返回一个布尔值，只要有一个监听函数调用了<code class="docutils literal notranslate"><span class="pre">Event.preventDefault()</span></code>，则返回值为<code class="docutils literal notranslate"><span class="pre">false</span></code>，否则为<code class="docutils literal notranslate"><span class="pre">true</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">target</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code>方法的参数是一个<code class="docutils literal notranslate"><span class="pre">Event</span></code>对象的实例（详见《Event 对象》章节）。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">para</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">hello</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="nx">para</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码在当前节点触发了<code class="docutils literal notranslate"><span class="pre">click</span></code>事件。</p>
<p>如果<code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code>方法的参数为空，或者不是一个有效的事件对象，将报错。</p>
<p>下面代码根据<code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code>方法的返回值，判断事件是否被取消了。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">canceled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">cb</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">canceled</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;事件取消&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;事件未取消&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id2"></span><h2>监听函数<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>浏览器的事件模型，就是通过监听函数（listener）对事件做出反应。事件发生后，浏览器监听到了这个事件，就会执行对应的监听函数。这是事件驱动编程模式（event-driven）的主要编程方式。</p>
<p>JavaScript 有三种方法，可以为事件绑定监听函数。</p>
<div class="section" id="html-on">
<span id="html-on"></span><h3>HTML 的 on- 属性<a class="headerlink" href="#html-on" title="永久链接至标题">¶</a></h3>
<p>HTML 语言允许在元素的属性中，直接定义某些事件的监听代码。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;doSomething()&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;console.log(&#39;触发事件&#39;)&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码为<code class="docutils literal notranslate"><span class="pre">body</span></code>节点的<code class="docutils literal notranslate"><span class="pre">load</span></code>事件、<code class="docutils literal notranslate"><span class="pre">div</span></code>节点的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件，指定了监听代码。一旦事件发生，就会执行这段代码。</p>
<p>元素的事件监听属性，都是<code class="docutils literal notranslate"><span class="pre">on</span></code>加上事件名，比如<code class="docutils literal notranslate"><span class="pre">onload</span></code>就是<code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">+</span> <span class="pre">load</span></code>，表示<code class="docutils literal notranslate"><span class="pre">load</span></code>事件的监听代码。</p>
<p>注意，这些属性的值是将会执行的代码，而不是一个函数。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- 正确 --&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;doSomething()&quot;</span><span class="p">&gt;</span>

<span class="c">&lt;!-- 错误 --&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;doSomething&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>一旦指定的事件发生，<code class="docutils literal notranslate"><span class="pre">on-</span></code>属性的值是原样传入 JavaScript 引擎执行。因此如果要执行函数，不要忘记加上一对圆括号。</p>
<p>使用这个方法指定的监听代码，只会在冒泡阶段触发。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;console.log(2)&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;console.log(1)&quot;</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">&lt;button&gt;</span></code>是<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>的子元素。<code class="docutils literal notranslate"><span class="pre">&lt;button&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件，也会触发<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件。由于<code class="docutils literal notranslate"><span class="pre">on-</span></code>属性的监听代码，只在冒泡阶段触发，所以点击结果是先输出<code class="docutils literal notranslate"><span class="pre">1</span></code>，再输出<code class="docutils literal notranslate"><span class="pre">2</span></code>，即事件从子元素开始冒泡到父元素。</p>
<p>直接设置<code class="docutils literal notranslate"><span class="pre">on-</span></code>属性，与通过元素节点的<code class="docutils literal notranslate"><span class="pre">setAttribute</span></code>方法设置<code class="docutils literal notranslate"><span class="pre">on-</span></code>属性，效果是一样的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="s1">&#39;doSomething()&#39;</span><span class="p">);</span>
<span class="c1">// 等同于</span>
<span class="c1">// &lt;Element onclick=&quot;doSomething()&quot;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id3"></span><h3>元素节点的事件属性<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>元素节点对象的事件属性，同样可以指定监听函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">;</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;触发事件&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>使用这个方法指定的监听函数，也是只会在冒泡阶段触发。</p>
<p>注意，这种方法与 HTML 的<code class="docutils literal notranslate"><span class="pre">on-</span></code>属性的差异是，它的值是函数名（<code class="docutils literal notranslate"><span class="pre">doSomething</span></code>），而不像后者，必须给出完整的监听代码（<code class="docutils literal notranslate"><span class="pre">doSomething()</span></code>）。</p>
</div>
<div class="section" id="eventtarget-addeventlistener">
<span id="id4"></span><h3>EventTarget.addEventListener()<a class="headerlink" href="#eventtarget-addeventlistener" title="永久链接至标题">¶</a></h3>
<p>所有 DOM 节点实例都有<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法，用来为该节点定义事件的监听函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">doSomething</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法的详细介绍，参见<code class="docutils literal notranslate"><span class="pre">EventTarget</span></code>章节。</p>
</div>
<div class="section" id="">
<span id="id5"></span><h3>小结<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>上面三种方法，第一种“HTML 的 on- 属性”，违反了 HTML 与 JavaScript 代码相分离的原则，将两者写在一起，不利于代码分工，因此不推荐使用。</p>
<p>第二种“元素节点的事件属性”的缺点在于，同一个事件只能定义一个监听函数，也就是说，如果定义两次<code class="docutils literal notranslate"><span class="pre">onclick</span></code>属性，后一次定义会覆盖前一次。因此，也不推荐使用。</p>
<p>第三种<code class="docutils literal notranslate"><span class="pre">EventTarget.addEventListener</span></code>是推荐的指定监听函数的方法。它有如下优点：</p>
<ul class="simple">
<li>同一个事件可以添加多个监听函数。</li>
<li>能够指定在哪个阶段（捕获阶段还是冒泡阶段）触发监听函数。</li>
<li>除了 DOM 节点，其他对象（比如<code class="docutils literal notranslate"><span class="pre">window</span></code>、<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>等）也有这个接口，它等于是整个 JavaScript 统一的监听函数接口。</li>
</ul>
</div>
</div>
<div class="section" id="this">
<span id="this"></span><h2>this 的指向<a class="headerlink" href="#this" title="永久链接至标题">¶</a></h2>
<p>监听函数内部的<code class="docutils literal notranslate"><span class="pre">this</span></code>指向触发事件的那个元素节点。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;btn&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;console.log(this.id)&quot;</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>执行上面代码，点击后会输出<code class="docutils literal notranslate"><span class="pre">btn</span></code>。</p>
<p>其他两种监听函数的写法，<code class="docutils literal notranslate"><span class="pre">this</span></code>的指向也是如此。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;button id=&quot;btn&quot;&gt;点击&lt;/button&gt;</span>
<span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;btn&#39;</span><span class="p">);</span>

<span class="c1">// 写法一</span>
<span class="nx">btn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 写法二</span>
<span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="s1">&#39;click&#39;</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="kc">false</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面两种写法，点击按钮以后也是输出<code class="docutils literal notranslate"><span class="pre">btn</span></code>。</p>
</div>
<div class="section" id="">
<span id="id6"></span><h2>事件的传播<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>一个事件发生后，会在子元素和父元素之间传播（propagation）。这种传播分成三个阶段。</p>
<ul class="simple">
<li><strong>第一阶段</strong>：从<code class="docutils literal notranslate"><span class="pre">window</span></code>对象传导到目标节点（上层传到底层），称为“捕获阶段”（capture phase）。</li>
<li><strong>第二阶段</strong>：在目标节点上触发，称为“目标阶段”（target phase）。</li>
<li><strong>第三阶段</strong>：从目标节点传导回<code class="docutils literal notranslate"><span class="pre">window</span></code>对象（从底层传回上层），称为“冒泡阶段”（bubbling phase）。</li>
</ul>
<p>这种三阶段的传播模型，使得同一个事件会在多个节点上触发。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>节点之中有一个<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点。</p>
<p>如果对这两个节点，都设置<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的监听函数（每个节点的捕获阶段和监听阶段，各设置一个监听函数），共计设置四个监听函数。然后，对<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>点击，<code class="docutils literal notranslate"><span class="pre">click</span></code>事件会触发四次。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">phases</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="o">:</span> <span class="s1">&#39;capture&#39;</span><span class="p">,</span>
  <span class="mi">2</span><span class="o">:</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span>
  <span class="mi">3</span><span class="o">:</span> <span class="s1">&#39;bubble&#39;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">tagName</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">phase</span> <span class="o">=</span> <span class="nx">phases</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">eventPhase</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Tag: &#39;&quot;</span> <span class="o">+</span> <span class="nx">tag</span> <span class="o">+</span> <span class="s2">&quot;&#39;. EventPhase: &#39;&quot;</span> <span class="o">+</span> <span class="nx">phase</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 点击以后的结果</span>
<span class="c1">// Tag: &#39;DIV&#39;. EventPhase: &#39;capture&#39;</span>
<span class="c1">// Tag: &#39;P&#39;. EventPhase: &#39;target&#39;</span>
<span class="c1">// Tag: &#39;P&#39;. EventPhase: &#39;target&#39;</span>
<span class="c1">// Tag: &#39;DIV&#39;. EventPhase: &#39;bubble&#39;</span>
</pre></div>
</div>
<p>上面代码表示，<code class="docutils literal notranslate"><span class="pre">click</span></code>事件被触发了四次：<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>节点的捕获阶段和冒泡阶段各1次，<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点的目标阶段触发了2次。</p>
<ol class="simple">
<li>捕获阶段：事件从<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>向<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>传播时，触发<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件；</li>
<li>目标阶段：事件从<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>到达<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>时，触发<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件；</li>
<li>冒泡阶段：事件从<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>传回<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>时，再次触发<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件。</li>
</ol>
<p>其中，<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点有两个监听函数（<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法第三个参数的不同，会导致绑定两个监听函数），因此它们都会因为<code class="docutils literal notranslate"><span class="pre">click</span></code>事件触发一次。所以，<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>会在<code class="docutils literal notranslate"><span class="pre">target</span></code>阶段有两次输出。</p>
<p>注意，浏览器总是假定<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的目标节点，就是点击位置嵌套最深的那个节点（本例是<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>节点里面的<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点）。所以，<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点的捕获阶段和冒泡阶段，都会显示为<code class="docutils literal notranslate"><span class="pre">target</span></code>阶段。</p>
<p>事件传播的最上层对象是<code class="docutils literal notranslate"><span class="pre">window</span></code>，接着依次是<code class="docutils literal notranslate"><span class="pre">document</span></code>，<code class="docutils literal notranslate"><span class="pre">html</span></code>（<code class="docutils literal notranslate"><span class="pre">document.documentElement</span></code>）和<code class="docutils literal notranslate"><span class="pre">body</span></code>（<code class="docutils literal notranslate"><span class="pre">document.body</span></code>）。也就是说，上例的事件传播顺序，在捕获阶段依次为<code class="docutils literal notranslate"><span class="pre">window</span></code>、<code class="docutils literal notranslate"><span class="pre">document</span></code>、<code class="docutils literal notranslate"><span class="pre">html</span></code>、<code class="docutils literal notranslate"><span class="pre">body</span></code>、<code class="docutils literal notranslate"><span class="pre">div</span></code>、<code class="docutils literal notranslate"><span class="pre">p</span></code>，在冒泡阶段依次为<code class="docutils literal notranslate"><span class="pre">p</span></code>、<code class="docutils literal notranslate"><span class="pre">div</span></code>、<code class="docutils literal notranslate"><span class="pre">body</span></code>、<code class="docutils literal notranslate"><span class="pre">html</span></code>、<code class="docutils literal notranslate"><span class="pre">document</span></code>、<code class="docutils literal notranslate"><span class="pre">window</span></code>。</p>
</div>
<div class="section" id="">
<span id="id7"></span><h2>事件的代理<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>由于事件会在冒泡阶段向上传播到父节点，因此可以把子节点的监听函数定义在父节点上，由父节点的监听函数统一处理多个子元素的事件。这种方法叫做事件的代理（delegation）。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">);</span>

<span class="nx">ul</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;li&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// some code</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的监听函数定义在<code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;</span></code>节点，但是实际上，它处理的是子节点<code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code>的<code class="docutils literal notranslate"><span class="pre">click</span></code>事件。这样做的好处是，只要定义一个监听函数，就能处理多个子节点的事件，而不用在每个<code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code>节点上定义监听函数。而且以后再添加子节点，监听函数依然有效。</p>
<p>如果希望事件到某个节点为止，不再传播，可以使用事件对象的<code class="docutils literal notranslate"><span class="pre">stopPropagation</span></code>方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 事件传播到 p 元素后，就不再向下传播了</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// 事件冒泡到 p 元素后，就不再向上冒泡了</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">stopPropagation</span></code>方法分别在捕获阶段和冒泡阶段，阻止了事件的传播。</p>
<p>但是，<code class="docutils literal notranslate"><span class="pre">stopPropagation</span></code>方法只会阻止事件的传播，不会阻止该事件触发<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>节点的其他<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的监听函数。也就是说，不是彻底取消<code class="docutils literal notranslate"><span class="pre">click</span></code>事件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 会触发</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">p</span></code>元素绑定了两个<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的监听函数。<code class="docutils literal notranslate"><span class="pre">stopPropagation</span></code>方法只能阻止这个事件向其他元素传播。因此，第二个监听函数会触发。输出结果会先是1，然后是2。</p>
<p>如果想要彻底阻止这个事件的传播，不再触发后面所有<code class="docutils literal notranslate"><span class="pre">click</span></code>的监听函数，可以使用<code class="docutils literal notranslate"><span class="pre">stopImmediatePropagation</span></code>方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 不会被触发</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">stopImmediatePropagation</span></code>方法可以彻底阻止这个事件传播，使得后面绑定的所有<code class="docutils literal notranslate"><span class="pre">click</span></code>监听函数都不再触发。所以，只会输出1，不会输出2。</p>
</div>
<div class="section" id="event">
<span id="event"></span><h2>Event 对象概述<a class="headerlink" href="#event" title="永久链接至标题">¶</a></h2>
<p>事件发生以后，会产生一个事件对象，作为参数传给监听函数。浏览器原生提供一个<code class="docutils literal notranslate"><span class="pre">Event</span></code>对象，所有的事件都是这个对象的实例，或者说继承了<code class="docutils literal notranslate"><span class="pre">Event.prototype</span></code>对象。</p>
<p><code class="docutils literal notranslate"><span class="pre">Event</span></code>对象本身就是一个构造函数，可以用来生成新的实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Event</span></code>构造函数接受两个参数。第一个参数<code class="docutils literal notranslate"><span class="pre">type</span></code>是字符串，表示事件的名称；第二个参数<code class="docutils literal notranslate"><span class="pre">options</span></code>是一个对象，表示事件对象的配置。该对象主要有下面两个属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">bubbles</span></code>：布尔值，可选，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>，表示事件对象是否冒泡。</li>
<li><code class="docutils literal notranslate"><span class="pre">cancelable</span></code>：布尔值，可选，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>，表示事件是否可以被取消，即能否用<code class="docutils literal notranslate"><span class="pre">Event.preventDefault()</span></code>取消这个事件。一旦事件被取消，就好像从来没有发生过，不会触发浏览器对该事件的默认行为。</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span>
  <span class="s1">&#39;look&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;bubbles&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">&#39;cancelable&#39;</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">ev</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码新建一个<code class="docutils literal notranslate"><span class="pre">look</span></code>事件实例，然后使用<code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code>方法触发该事件。</p>
<p>注意，如果不是显式指定<code class="docutils literal notranslate"><span class="pre">bubbles</span></code>属性为<code class="docutils literal notranslate"><span class="pre">true</span></code>，生成的事件就只能在“捕获阶段”触发监听函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">tagName</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Tag: &#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">);</span> <span class="c1">// 没有任何输出</span>
<span class="p">}</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">click</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">click</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">p</span></code>元素发出一个<code class="docutils literal notranslate"><span class="pre">click</span></code>事件，该事件默认不会冒泡。<code class="docutils literal notranslate"><span class="pre">div.addEventListener</span></code>方法指定在冒泡阶段监听，因此监听函数不会触发。如果写成<code class="docutils literal notranslate"><span class="pre">div.addEventListener('click',</span> <span class="pre">callback,</span> <span class="pre">true)</span></code>，那么在“捕获阶段”可以监听到这个事件。</p>
<p>另一方面，如果这个事件在<code class="docutils literal notranslate"><span class="pre">div</span></code>元素上触发。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">click</span><span class="p">);</span>
</pre></div>
</div>
<p>那么，不管<code class="docutils literal notranslate"><span class="pre">div</span></code>元素是在冒泡阶段监听，还是在捕获阶段监听，都会触发监听函数。因为这时<code class="docutils literal notranslate"><span class="pre">div</span></code>元素是事件的目标，不存在是否冒泡的问题，<code class="docutils literal notranslate"><span class="pre">div</span></code>元素总是会接收到事件，因此导致监听函数生效。</p>
</div>
<div class="section" id="event">
<span id="id8"></span><h2>Event 对象的实例属性<a class="headerlink" href="#event" title="永久链接至标题">¶</a></h2>
<div class="section" id="event-bubbles-event-eventphase">
<span id="event-bubbles-event-eventphase"></span><h3>Event.bubbles，Event.eventPhase<a class="headerlink" href="#event-bubbles-event-eventphase" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.bubbles</span></code>属性返回一个布尔值，表示当前事件是否会冒泡。该属性为只读属性，一般用来了解 Event 实例是否可以冒泡。前面说过，除非显式声明，<code class="docutils literal notranslate"><span class="pre">Event</span></code>构造函数生成的事件，默认是不冒泡的。</p>
<p><code class="docutils literal notranslate"><span class="pre">Event.eventPhase</span></code>属性返回一个整数常量，表示事件目前所处的阶段。该属性只读。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">phase</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">eventPhase</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Event.eventPhase</span></code>的返回值有四种可能。</p>
<ul class="simple">
<li>0，事件目前没有发生。</li>
<li>1，事件目前处于捕获阶段，即处于从祖先节点向目标节点的传播过程中。</li>
<li>2，事件到达目标节点，即<code class="docutils literal notranslate"><span class="pre">Event.target</span></code>属性指向的那个节点。</li>
<li>3，事件处于冒泡阶段，即处于从目标节点向祖先节点的反向传播过程中。</li>
</ul>
</div>
<div class="section" id="event-cancelable-event-cancelbubble-event-defaultprevented">
<span id="event-cancelable-event-cancelbubble-event-defaultprevented"></span><h3>Event.cancelable，Event.cancelBubble，event.defaultPrevented<a class="headerlink" href="#event-cancelable-event-cancelbubble-event-defaultprevented" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.cancelable</span></code>属性返回一个布尔值，表示事件是否可以取消。该属性为只读属性，一般用来了解 Event 实例的特性。</p>
<p>大多数浏览器的原生事件是可以取消的。比如，取消<code class="docutils literal notranslate"><span class="pre">click</span></code>事件，点击链接将无效。但是除非显式声明，<code class="docutils literal notranslate"><span class="pre">Event</span></code>构造函数生成的事件，默认是不可以取消的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">evt</span><span class="p">.</span><span class="nx">cancelable</span>  <span class="c1">// false</span>
</pre></div>
</div>
<p>当<code class="docutils literal notranslate"><span class="pre">Event.cancelable</span></code>属性为<code class="docutils literal notranslate"><span class="pre">true</span></code>时，调用<code class="docutils literal notranslate"><span class="pre">Event.preventDefault()</span></code>就可以取消这个事件，阻止浏览器对该事件的默认行为。</p>
<p>如果事件不能取消，调用<code class="docutils literal notranslate"><span class="pre">Event.preventDefault()</span></code>会没有任何效果。所以使用这个方法之前，最好用<code class="docutils literal notranslate"><span class="pre">Event.cancelable</span></code>属性判断一下是否可以取消。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">preventEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">cancelable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;This event couldn\&#39;t be canceled.&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Event.cancelBubble</span></code>属性是一个布尔值，如果设为<code class="docutils literal notranslate"><span class="pre">true</span></code>，相当于执行<code class="docutils literal notranslate"><span class="pre">Event.stopPropagation()</span></code>，可以阻止事件的传播。</p>
<p><code class="docutils literal notranslate"><span class="pre">Event.defaultPrevented</span></code>属性返回一个布尔值，表示该事件是否调用过<code class="docutils literal notranslate"><span class="pre">Event.preventDefault</span></code>方法。该属性只读。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">defaultPrevented</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;该事件已经取消了&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="event-currenttarget-event-target">
<span id="event-currenttarget-event-target"></span><h3>Event.currentTarget，Event.target<a class="headerlink" href="#event-currenttarget-event-target" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.currentTarget</span></code>属性返回事件当前所在的节点，即正在执行的监听函数所绑定的那个节点。</p>
<p><code class="docutils literal notranslate"><span class="pre">Event.target</span></code>属性返回原始触发事件的那个节点，即事件最初发生的节点。事件传播过程中，不同节点的监听函数内部的<code class="docutils literal notranslate"><span class="pre">Event.target</span></code>与<code class="docutils literal notranslate"><span class="pre">Event.currentTarget</span></code>属性的值是不一样的，前者总是不变的，后者则是指向监听函数所在的那个节点对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML代码为</span>
<span class="c1">// &lt;p id=&quot;para&quot;&gt;Hello &lt;em&gt;World&lt;/em&gt;&lt;/p&gt;</span>
<span class="kd">function</span> <span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>  <span class="c1">// 总是 true</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>  <span class="c1">// 有可能不是 true</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">para</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">hide</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，如果在<code class="docutils literal notranslate"><span class="pre">para</span></code>节点的<code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code>子节点上面点击，则<code class="docutils literal notranslate"><span class="pre">e.target</span></code>指向<code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code>子节点，导致<code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code>子节点（即 World 部分）会不可见。如果点击 Hello  部分，则整个<code class="docutils literal notranslate"><span class="pre">para</span></code>都将不可见。</p>
</div>
<div class="section" id="event-type">
<span id="event-type"></span><h3>Event.type<a class="headerlink" href="#event-type" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.type</span></code>属性返回一个字符串，表示事件类型。事件的类型是在生成事件的时候。该属性只读。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">evt</span><span class="p">.</span><span class="nx">type</span> <span class="c1">// &quot;foo&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="event-timestamp">
<span id="event-timestamp"></span><h3>Event.timeStamp<a class="headerlink" href="#event-timestamp" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.timeStamp</span></code>属性返回一个毫秒时间戳，表示事件发生的时间。它是相对于网页加载成功开始计算的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">evt</span><span class="p">.</span><span class="nx">timeStamp</span> <span class="c1">// 3683.6999999995896</span>
</pre></div>
</div>
<p>它的返回值有可能是整数，也有可能是小数（高精度时间戳），取决于浏览器的设置。</p>
<p>下面是一个计算鼠标移动速度的例子，显示每秒移动的像素数量。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">previousX</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">previousY</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">previousT</span><span class="p">;</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span>
    <span class="nx">previousX</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span>
    <span class="nx">previousY</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span>
    <span class="nx">previousT</span> <span class="o">!==</span> <span class="kc">undefined</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deltaX</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">screenX</span> <span class="o">-</span> <span class="nx">previousX</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">deltaY</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">screenY</span> <span class="o">-</span> <span class="nx">previousY</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">deltaD</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">deltaX</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">deltaY</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

    <span class="kd">var</span> <span class="nx">deltaT</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">timeStamp</span> <span class="o">-</span> <span class="nx">previousT</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">deltaD</span> <span class="o">/</span> <span class="nx">deltaT</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">previousX</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">screenX</span><span class="p">;</span>
  <span class="nx">previousY</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">screenY</span><span class="p">;</span>
  <span class="nx">previousT</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="event-istrusted">
<span id="event-istrusted"></span><h3>Event.isTrusted<a class="headerlink" href="#event-istrusted" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.isTrusted</span></code>属性返回一个布尔值，表示该事件是否由真实的用户行为产生。比如，用户点击链接会产生一个<code class="docutils literal notranslate"><span class="pre">click</span></code>事件，该事件是用户产生的；<code class="docutils literal notranslate"><span class="pre">Event</span></code>构造函数生成的事件，则是脚本产生的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">evt</span><span class="p">.</span><span class="nx">isTrusted</span> <span class="c1">// false</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">evt</span></code>对象是脚本产生的，所以<code class="docutils literal notranslate"><span class="pre">isTrusted</span></code>属性返回<code class="docutils literal notranslate"><span class="pre">false</span></code>。</p>
</div>
<div class="section" id="event-detail">
<span id="event-detail"></span><h3>Event.detail<a class="headerlink" href="#event-detail" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.detail</span></code>属性只有浏览器的 UI （用户界面）事件才具有。该属性返回一个数值，表示事件的某种信息。具体含义与事件类型相关。比如，对于<code class="docutils literal notranslate"><span class="pre">click</span></code>和<code class="docutils literal notranslate"><span class="pre">dbclick</span></code>事件，<code class="docutils literal notranslate"><span class="pre">Event.detail</span></code>是鼠标按下的次数（<code class="docutils literal notranslate"><span class="pre">1</span></code>表示单击，<code class="docutils literal notranslate"><span class="pre">2</span></code>表示双击，<code class="docutils literal notranslate"><span class="pre">3</span></code>表示三击）；对于鼠标滚轮事件，<code class="docutils literal notranslate"><span class="pre">Event.detail</span></code>是滚轮正向滚动的距离，负值就是负向滚动的距离，返回值总是3的倍数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;p&gt;Hello&lt;/p&gt;</span>
<span class="kd">function</span> <span class="nx">giveDetails</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">selectQuery</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="nx">giveDetails</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="event">
<span id="id9"></span><h2>Event 对象的实例方法<a class="headerlink" href="#event" title="永久链接至标题">¶</a></h2>
<div class="section" id="event-preventdefault">
<span id="event-preventdefault"></span><h3>Event.preventDefault()<a class="headerlink" href="#event-preventdefault" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.preventDefault</span></code>方法取消浏览器对当前事件的默认行为。比如点击链接后，浏览器默认会跳转到另一个页面，使用这个方法以后，就不会跳转了；再比如，按一下空格键，页面向下滚动一段距离，使用这个方法以后也不会滚动了。该方法生效的前提是，事件对象的<code class="docutils literal notranslate"><span class="pre">cancelable</span></code>属性为<code class="docutils literal notranslate"><span class="pre">true</span></code>，如果为<code class="docutils literal notranslate"><span class="pre">false</span></code>，调用该方法没有任何效果。</p>
<p>注意，该方法只是取消事件对当前元素的默认影响，不会阻止事件的传播。如果要阻止传播，可以使用<code class="docutils literal notranslate"><span class="pre">stopPropagation()</span></code>或<code class="docutils literal notranslate"><span class="pre">stopImmediatePropagation()</span></code>方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;input type=&quot;checkbox&quot; id=&quot;my-checkbox&quot; /&gt;</span>
<span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my-checkbox&#39;</span><span class="p">);</span>

<span class="nx">cb</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="s1">&#39;click&#39;</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">){</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="p">},</span>
  <span class="kc">false</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，浏览器的默认行为是单击会选中单选框，取消这个行为，就导致无法选中单选框。</p>
<p>利用这个方法，可以为文本输入框设置校验条件。如果用户的输入不符合条件，就无法将字符输入文本框。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;input type=&quot;text&quot; id=&quot;my-input&quot; /&gt;</span>
<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my-input&#39;</span><span class="p">);</span>
<span class="nx">input</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="nx">checkName</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">checkName</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">&lt;</span> <span class="mi">97</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">&gt;</span> <span class="mi">122</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码为文本框的<code class="docutils literal notranslate"><span class="pre">keypress</span></code>事件设定监听函数后，将只能输入小写字母，否则输入事件的默认行为（写入文本框）将被取消，导致不能向文本框输入内容。</p>
</div>
<div class="section" id="event-stoppropagation">
<span id="event-stoppropagation"></span><h3>Event.stopPropagation()<a class="headerlink" href="#event-stoppropagation" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stopPropagation</span></code>方法阻止事件在 DOM 中继续传播，防止再触发定义在别的节点上的监听函数，但是不包括在当前节点上其他的事件监听函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">stopEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">stopEvent</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">click</span></code>事件将不会进一步冒泡到<code class="docutils literal notranslate"><span class="pre">el</span></code>节点的父节点。</p>
</div>
<div class="section" id="event-stopimmediatepropagation">
<span id="event-stopimmediatepropagation"></span><h3>Event.stopImmediatePropagation()<a class="headerlink" href="#event-stopimmediatepropagation" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.stopImmediatePropagation</span></code>方法阻止同一个事件的其他监听函数被调用，不管监听函数定义在当前节点还是其他节点。也就是说，该方法阻止事件的传播，比<code class="docutils literal notranslate"><span class="pre">Event.stopPropagation()</span></code>更彻底。</p>
<p>如果同一个节点对于同一个事件指定了多个监听函数，这些函数会根据添加的顺序依次调用。只要其中有一个监听函数调用了<code class="docutils literal notranslate"><span class="pre">Event.stopImmediatePropagation</span></code>方法，其他的监听函数就不会再执行了。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">l1</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">l2</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">l1</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">l2</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码在<code class="docutils literal notranslate"><span class="pre">el</span></code>节点上，为<code class="docutils literal notranslate"><span class="pre">click</span></code>事件添加了两个监听函数<code class="docutils literal notranslate"><span class="pre">l1</span></code>和<code class="docutils literal notranslate"><span class="pre">l2</span></code>。由于<code class="docutils literal notranslate"><span class="pre">l1</span></code>调用了<code class="docutils literal notranslate"><span class="pre">event.stopImmediatePropagation</span></code>方法，所以<code class="docutils literal notranslate"><span class="pre">l2</span></code>不会被调用。</p>
</div>
<div class="section" id="event-composedpath">
<span id="event-composedpath"></span><h3>Event.composedPath()<a class="headerlink" href="#event-composedpath" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Event.composedPath()</span></code>返回一个数组，成员是事件的最底层节点和依次冒泡经过的所有上层节点。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div&gt;</span>
<span class="c1">//   &lt;p&gt;Hello&lt;/p&gt;</span>
<span class="c1">// &lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">composedPath</span><span class="p">());</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="c1">// [p, div, body, html, document, Window]</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">click</span></code>事件的最底层节点是<code class="docutils literal notranslate"><span class="pre">p</span></code>，向上依次是<code class="docutils literal notranslate"><span class="pre">div</span></code>、<code class="docutils literal notranslate"><span class="pre">body</span></code>、<code class="docutils literal notranslate"><span class="pre">html</span></code>、<code class="docutils literal notranslate"><span class="pre">document</span></code>、<code class="docutils literal notranslate"><span class="pre">Window</span></code>。</p>
</div>
</div>
<div class="section" id="customevent">
<span id="customevent"></span><h2>CustomEvent 接口<a class="headerlink" href="#customevent" title="永久链接至标题">¶</a></h2>
<p>CustomEvent 接口用于生成自定义的事件实例。那些浏览器预定义的事件，虽然可以手动生成，但是往往不能在事件上绑定数据。如果需要在触发事件的同时，传入指定的数据，就可以使用 CustomEvent 接口生成的自定义事件对象。</p>
<p>浏览器原生提供<code class="docutils literal notranslate"><span class="pre">CustomEvent()</span></code>构造函数，用来生成 CustomEvent 事件实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CustomEvent()</span></code>构造函数接受两个参数。第一个参数是字符串，表示事件的名字，这是必须的。第二个参数是事件的配置对象，这个参数是可选的。<code class="docutils literal notranslate"><span class="pre">CustomEvent</span></code>的配置对象除了接受 Event 事件的配置属性，只有一个自己的属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">detail</span></code>：表示事件的附带数据，默认为<code class="docutils literal notranslate"><span class="pre">null</span></code>。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;detail&#39;</span><span class="o">:</span> <span class="s1">&#39;hello&#39;</span> <span class="p">});</span>

<span class="kd">function</span> <span class="nx">eventHandler</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，我们手动定义了<code class="docutils literal notranslate"><span class="pre">build</span></code>事件。该事件触发后，会被监听到，从而输出该事件实例的<code class="docutils literal notranslate"><span class="pre">detail</span></code>属性（即字符串<code class="docutils literal notranslate"><span class="pre">hello</span></code>）。</p>
<p>下面是另一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">&#39;myevent&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">detail</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span>
  <span class="p">},</span>
  <span class="nx">bubbles</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">cancelable</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;myevent&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">myEvent</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码也说明，CustomEvent 的事件实例，除了具有 Event 接口的实例属性，还具有<code class="docutils literal notranslate"><span class="pre">detail</span></code>属性。</p>
</div>
<div class="section" id="">
<span id="id10"></span><h2>参考链接<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Wilson Page, <a class="reference external" href="http://coding.smashingmagazine.com/2013/11/12/an-introduction-to-dom-events/">An Introduction To DOM Events</a></li>
<li>Mozilla Developer Network, <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Using_Firefox_1.5_caching">Using Firefox 1.5 caching</a></li>
<li>Craig Buckler, <a class="reference external" href="http://www.sitepoint.com/css3-animation-javascript-event-handlers/">How to Capture CSS3 Animation Events in JavaScript</a></li>
<li>Ray Nicholus, <a class="reference external" href="http://blog.garstasio.com/you-dont-need-jquery/events/">You Don't Need jQuery!: Events</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="event-type.html" class="btn btn-neutral float-right" title="事件种类" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="text.html" class="btn btn-neutral" title="Text 节点和 DocumentFragment 节点" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>