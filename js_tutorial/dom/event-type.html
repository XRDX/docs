

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>事件种类 &mdash; JS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="CSS操作" href="css.html" />
    <link rel="prev" title="事件模型" href="event.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html">stdlib 标准库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oop/index.html">面向对象编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">语法专题</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">DOM 模型</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="node.html">DOM 模型概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">document 对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="element.html">Element对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="attribute.html">属性的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html">Text 节点和 DocumentFragment 节点</a></li>
<li class="toctree-l2"><a class="reference internal" href="event.html">事件模型</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">事件种类</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#">鼠标事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mouseevent">MouseEvent 接口概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mouseevent">MouseEvent 接口的实例属性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-altkey-mouseevent-ctrlkey-mouseevent-metakey-mouseevent-shiftkey">MouseEvent.altKey，MouseEvent.ctrlKey，MouseEvent.metaKey，MouseEvent.shiftKey</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-button-mouseevent-buttons">MouseEvent.button，MouseEvent.buttons</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-clientx-mouseevent-clienty">MouseEvent.clientX，MouseEvent.clientY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-movementx-mouseevent-movementy">MouseEvent.movementX，MouseEvent.movementY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-screenx-mouseevent-screeny">MouseEvent.screenX，MouseEvent.screenY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-offsetx-mouseevent-offsety">MouseEvent.offsetX，MouseEvent.offsetY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-pagex-mouseevent-pagey">MouseEvent.pageX，MouseEvent.pageY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-relatedtarget">MouseEvent.relatedTarget</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mouseevent">MouseEvent 接口的实例方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mouseevent-getmodifierstate">MouseEvent.getModifierState()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wheelevent">WheelEvent 接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">实例属性</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">键盘事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keyboardevent">KeyboardEvent 接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keyboardevent">KeyboardEvent 的实例属性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-altkey-keyboardevent-metakey-ctrlkey-keyboardevent-metakey-keyboardevent-shiftkey">KeyboardEvent.altKey，KeyboardEvent.metaKey.ctrlKey，KeyboardEvent.metaKey，KeyboardEvent.shiftKey</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-code">KeyboardEvent.code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-key">KeyboardEvent.key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-location">KeyboardEvent.location</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-repeat">KeyboardEvent.repeat</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#keyboardevent">KeyboardEvent 的实例方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#keyboardevent-getmodifierstate">KeyboardEvent.getModifierState()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">进度事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#progressevent">ProgressEvent 接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">拖拉事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dragevent">DragEvent 接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datatransfer">DataTransfer 接口概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datatransfer">DataTransfer 的实例属性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-dropeffect">DataTransfer.dropEffect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-effectallowed">DataTransfer.effectAllowed</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-files">DataTransfer.files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-types">DataTransfer.types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-items">DataTransfer.items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#datatransfer">DataTransfer 的实例方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-setdata">DataTransfer.setData()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-getdata">DataTransfer.getData()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-cleardata">DataTransfer.clearData()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datatransfer-setdragimage">DataTransfer.setDragImage()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">触摸操作概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#touch">Touch 接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#touch">Touch 接口概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#touch">Touch 接口的实例属性</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#touchlist">TouchList 接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#touchevent">TouchEvent 接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">实例属性</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">触摸事件的种类</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">表单事件的种类</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#input">input 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select">select 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change">Change 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invalid">invalid 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset-submit">reset 事件，submit 事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">资源事件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#beforeunload">beforeunload 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unload">unload 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load">load 事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#session">session 历史事件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pageshow-pagehide">pageshow 事件，pagehide 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#popstate">popstate 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hashchange">hashchange 事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">网页状态事件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#domcontentloaded">DOMContentLoaded 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#readystatechange">readystatechange 事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">窗口事件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scroll">scroll 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resize">resize 事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fullscreenchange-fullscreenerror">fullscreenchange 事件，fullscreenerror 事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">剪贴板事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">焦点事件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="css.html">CSS操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="image.html">Image对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="mutationobserver.html">Mutation Observer API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bom/index.html">BOM 浏览器环境</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">DOM 模型</a> &raquo;</li>
        
      <li>事件种类</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>事件种类<a class="headerlink" href="#" title="永久链接至标题">¶</a></h1>
<p>浏览器支持大量的事件，本章介绍其中一些主要的事件。</p>
<div class="section" id="">
<span id="id2"></span><h2>鼠标事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>鼠标事件指与鼠标相关的事件，继承了<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>接口。具体的事件主要有以下一些。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">click</span></code>：按下鼠标（通常是按下主按钮）时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">dblclick</span></code>：在同一个元素上双击鼠标时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">mousedown</span></code>：按下鼠标键时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">mouseup</span></code>：释放按下的鼠标键时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">mousemove</span></code>：当鼠标在一个节点内部移动时触发。当鼠标持续移动时，该事件会连续触发。为了避免性能问题，建议对该事件的监听函数做一些限定，比如限定一段时间内只能运行一次。</li>
<li><code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>：鼠标进入一个节点时触发，进入子节点不会触发这个事件（详见后文）。</li>
<li><code class="docutils literal notranslate"><span class="pre">mouseover</span></code>：鼠标进入一个节点时触发，进入子节点会再一次触发这个事件（详见后文）。</li>
<li><code class="docutils literal notranslate"><span class="pre">mouseout</span></code>：鼠标离开一个节点时触发，离开父节点也会触发这个事件（详见后文）。</li>
<li><code class="docutils literal notranslate"><span class="pre">mouseleave</span></code>：鼠标离开一个节点时触发，离开父节点不会触发这个事件（详见后文）。</li>
<li><code class="docutils literal notranslate"><span class="pre">contextmenu</span></code>：按下鼠标右键时（上下文菜单出现前）触发，或者按下“上下文菜单键”时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">wheel</span></code>：滚动鼠标的滚轮时触发，该事件继承的是<code class="docutils literal notranslate"><span class="pre">WheelEvent</span></code>接口。</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">click</span></code>事件指的是，用户在同一个位置先完成<code class="docutils literal notranslate"><span class="pre">mousedown</span></code>动作，再完成<code class="docutils literal notranslate"><span class="pre">mouseup</span></code>动作。因此，触发顺序是，<code class="docutils literal notranslate"><span class="pre">mousedown</span></code>首先触发，<code class="docutils literal notranslate"><span class="pre">mouseup</span></code>接着触发，<code class="docutils literal notranslate"><span class="pre">click</span></code>最后触发。</p>
<p><code class="docutils literal notranslate"><span class="pre">dblclick</span></code>事件则会在<code class="docutils literal notranslate"><span class="pre">mousedown</span></code>、<code class="docutils literal notranslate"><span class="pre">mouseup</span></code>、<code class="docutils literal notranslate"><span class="pre">click</span></code>之后触发。</p>
<p><code class="docutils literal notranslate"><span class="pre">mouseover</span></code>事件和<code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>事件，都是鼠标进入一个节点时触发。两者的区别是，<code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>事件只触发一次，而只要鼠标在节点内部移动，<code class="docutils literal notranslate"><span class="pre">mouseover</span></code>事件会在子节点上触发多次。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm"> &lt;ul&gt;</span>
<span class="cm">   &lt;li&gt;item 1&lt;/li&gt;</span>
<span class="cm">   &lt;li&gt;item 2&lt;/li&gt;</span>
<span class="cm">  &lt;li&gt;item 3&lt;/li&gt;</span>
<span class="cm"> &lt;/ul&gt;</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">);</span>

<span class="c1">// 进入 ul 节点以后，mouseenter 事件只会触发一次</span>
<span class="c1">// 以后只要鼠标在节点内移动，都不会再触发这个事件</span>
<span class="c1">// event.target 是 ul 节点</span>
<span class="nx">ul</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// 进入 ul 节点以后，只要在子节点上移动，mouseover 事件会触发多次</span>
<span class="c1">// event.target 是 li 节点</span>
<span class="nx">ul</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，在父节点内部进入子节点，不会触发<code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>事件，但是会触发<code class="docutils literal notranslate"><span class="pre">mouseover</span></code>事件。</p>
<p><code class="docutils literal notranslate"><span class="pre">mouseout</span></code>事件和<code class="docutils literal notranslate"><span class="pre">mouseleave</span></code>事件，都是鼠标离开一个节点时触发。两者的区别是，在父元素内部离开一个子元素时，<code class="docutils literal notranslate"><span class="pre">mouseleave</span></code>事件不会触发，而<code class="docutils literal notranslate"><span class="pre">mouseout</span></code>事件会触发。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm"> &lt;ul&gt;</span>
<span class="cm">   &lt;li&gt;item 1&lt;/li&gt;</span>
<span class="cm">   &lt;li&gt;item 2&lt;/li&gt;</span>
<span class="cm">  &lt;li&gt;item 3&lt;/li&gt;</span>
<span class="cm"> &lt;/ul&gt;</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">);</span>

<span class="c1">// 先进入 ul 节点，然后在节点内部移动，不会触发 mouseleave 事件</span>
<span class="c1">// 只有离开 ul 节点时，触发一次 mouseleave</span>
<span class="c1">// event.target 是 ul 节点</span>
<span class="nx">ul</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseleave&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// 先进入 ul 节点，然后在节点内部移动，mouseout 事件会触发多次</span>
<span class="c1">// event.target 是 li 节点</span>
<span class="nx">ul</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，在父节点内部离开子节点，不会触发<code class="docutils literal notranslate"><span class="pre">mouseleave</span></code>事件，但是会触发<code class="docutils literal notranslate"><span class="pre">mouseout</span></code>事件。</p>
</div>
<div class="section" id="mouseevent">
<span id="mouseevent"></span><h2>MouseEvent 接口概述<a class="headerlink" href="#mouseevent" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>接口代表了鼠标相关的事件，单击（click）、双击（dblclick）、松开鼠标键（mouseup）、按下鼠标键（mousedown）等动作，所产生的事件对象都是<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>实例。此外，滚轮事件和拖拉事件也是<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>实例。</p>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>接口继承了<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口，所以拥有<code class="docutils literal notranslate"><span class="pre">Event</span></code>的所有属性和方法。它还有自己的属性和方法。</p>
<p>浏览器原生提供一个<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>构造函数，用于新建一个<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MouseEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>构造函数接受两个参数。第一个参数是字符串，表示事件名称；第二个参数是一个事件配置对象，该参数可选。除了<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口的实例配置属性，该对象可以配置以下属性，所有属性都是可选的。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">screenX</span></code>：数值，鼠标相对于屏幕的水平位置（单位像素），默认值为0，设置该属性不会移动鼠标。</li>
<li><code class="docutils literal notranslate"><span class="pre">screenY</span></code>：数值，鼠标相对于屏幕的垂直位置（单位像素），其他与<code class="docutils literal notranslate"><span class="pre">screenX</span></code>相同。</li>
<li><code class="docutils literal notranslate"><span class="pre">clientX</span></code>：数值，鼠标相对于程序窗口的水平位置（单位像素），默认值为0，设置该属性不会移动鼠标。</li>
<li><code class="docutils literal notranslate"><span class="pre">clientY</span></code>：数值，鼠标相对于程序窗口的垂直位置（单位像素），其他与<code class="docutils literal notranslate"><span class="pre">clientX</span></code>相同。</li>
<li><code class="docutils literal notranslate"><span class="pre">ctrlKey</span></code>：布尔值，是否同时按下了 Ctrl 键，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">shiftKey</span></code>：布尔值，是否同时按下了 Shift 键，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">altKey</span></code>：布尔值，是否同时按下 Alt 键，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">metaKey</span></code>：布尔值，是否同时按下 Meta 键，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">button</span></code>：数值，表示按下了哪一个鼠标按键，默认值为<code class="docutils literal notranslate"><span class="pre">0</span></code>，表示按下主键（通常是鼠标的左键）或者当前事件没有定义这个属性；<code class="docutils literal notranslate"><span class="pre">1</span></code>表示按下辅助键（通常是鼠标的中间键），<code class="docutils literal notranslate"><span class="pre">2</span></code>表示按下次要键（通常是鼠标的右键）。</li>
<li><code class="docutils literal notranslate"><span class="pre">buttons</span></code>：数值，表示按下了鼠标的哪些键，是一个三个比特位的二进制值，默认为<code class="docutils literal notranslate"><span class="pre">0</span></code>（没有按下任何键）。<code class="docutils literal notranslate"><span class="pre">1</span></code>（二进制<code class="docutils literal notranslate"><span class="pre">001</span></code>）表示按下主键（通常是左键），<code class="docutils literal notranslate"><span class="pre">2</span></code>（二进制<code class="docutils literal notranslate"><span class="pre">010</span></code>）表示按下次要键（通常是右键），<code class="docutils literal notranslate"><span class="pre">4</span></code>（二进制<code class="docutils literal notranslate"><span class="pre">100</span></code>）表示按下辅助键（通常是中间键）。因此，如果返回<code class="docutils literal notranslate"><span class="pre">3</span></code>（二进制<code class="docutils literal notranslate"><span class="pre">011</span></code>）就表示同时按下了左键和右键。</li>
<li><code class="docutils literal notranslate"><span class="pre">relatedTarget</span></code>：节点对象，表示事件的相关节点，默认为<code class="docutils literal notranslate"><span class="pre">null</span></code>。<code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>和<code class="docutils literal notranslate"><span class="pre">mouseover</span></code>事件时，表示鼠标刚刚离开的那个元素节点；<code class="docutils literal notranslate"><span class="pre">mouseout</span></code>和<code class="docutils literal notranslate"><span class="pre">mouseleave</span></code>事件时，表示鼠标正在进入的那个元素节点。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">simulateClick</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MouseEvent</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;bubbles&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">&#39;cancelable&#39;</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;checkbox&#39;</span><span class="p">);</span>
  <span class="nx">cb</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码生成一个鼠标点击事件，并触发该事件。</p>
</div>
<div class="section" id="mouseevent">
<span id="id3"></span><h2>MouseEvent 接口的实例属性<a class="headerlink" href="#mouseevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="mouseevent-altkey-mouseevent-ctrlkey-mouseevent-metakey-mouseevent-shiftkey">
<span id="mouseevent-altkey-mouseevent-ctrlkey-mouseevent-metakey-mouseevent-shiftkey"></span><h3>MouseEvent.altKey，MouseEvent.ctrlKey，MouseEvent.metaKey，MouseEvent.shiftKey<a class="headerlink" href="#mouseevent-altkey-mouseevent-ctrlkey-mouseevent-metakey-mouseevent-shiftkey" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.altKey</span></code>、<code class="docutils literal notranslate"><span class="pre">MouseEvent.ctrlKey</span></code>、<code class="docutils literal notranslate"><span class="pre">MouseEvent.metaKey</span></code>、<code class="docutils literal notranslate"><span class="pre">MouseEvent.shiftKey</span></code>这四个属性都返回一个布尔值，表示事件发生时，是否按下对应的键。它们都是只读属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">altKey</span></code>属性：Alt 键</li>
<li><code class="docutils literal notranslate"><span class="pre">ctrlKey</span></code>属性：Ctrl 键</li>
<li><code class="docutils literal notranslate"><span class="pre">metaKey</span></code>属性：Meta 键（Mac 键盘是一个四瓣的小花，Windows 键盘是 Windows 键）</li>
<li><code class="docutils literal notranslate"><span class="pre">shiftKey</span></code>属性：Shift 键</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;body onclick=&quot;showKey(event)&quot;&gt;</span>
<span class="kd">function</span> <span class="nx">showKey</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ALT key pressed: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CTRL key pressed: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;META key pressed: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;SHIFT key pressed: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码中，点击网页会输出是否同时按下对应的键。</p>
</div>
<div class="section" id="mouseevent-button-mouseevent-buttons">
<span id="mouseevent-button-mouseevent-buttons"></span><h3>MouseEvent.button，MouseEvent.buttons<a class="headerlink" href="#mouseevent-button-mouseevent-buttons" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.button</span></code>属性返回一个数值，表示事件发生时按下了鼠标的哪个键。该属性只读。</p>
<ul class="simple">
<li>0：按下主键（通常是左键），或者该事件没有初始化这个属性（比如<code class="docutils literal notranslate"><span class="pre">mousemove</span></code>事件）。</li>
<li>1：按下辅助键（通常是中键或者滚轮键）。</li>
<li>2：按下次键（通常是右键）。</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;button onmouseup=&quot;whichButton(event)&quot;&gt;点击&lt;/button&gt;</span>
<span class="kd">var</span> <span class="nx">whichButton</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Left button clicked.&#39;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Middle button clicked.&#39;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Right button clicked.&#39;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Unexpected code: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.buttons</span></code>属性返回一个三个比特位的值，表示同时按下了哪些键。它用来处理同时按下多个鼠标键的情况。该属性只读。</p>
<ul class="simple">
<li>1：二进制为<code class="docutils literal notranslate"><span class="pre">001</span></code>（十进制的1），表示按下左键。</li>
<li>2：二进制为<code class="docutils literal notranslate"><span class="pre">010</span></code>（十进制的2），表示按下右键。</li>
<li>4：二进制为<code class="docutils literal notranslate"><span class="pre">100</span></code>（十进制的4），表示按下中键或滚轮键。</li>
</ul>
<p>同时按下多个键的时候，每个按下的键对应的比特位都会有值。比如，同时按下左键和右键，会返回3（二进制为011）。</p>
</div>
<div class="section" id="mouseevent-clientx-mouseevent-clienty">
<span id="mouseevent-clientx-mouseevent-clienty"></span><h3>MouseEvent.clientX，MouseEvent.clientY<a class="headerlink" href="#mouseevent-clientx-mouseevent-clienty" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.clientX</span></code>属性返回鼠标位置相对于浏览器窗口左上角的水平坐标（单位像素），<code class="docutils literal notranslate"><span class="pre">MouseEvent.clientY</span></code>属性返回垂直坐标。这两个属性都是只读属性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;body onmousedown=&quot;showCoords(event)&quot;&gt;</span>
<span class="kd">function</span> <span class="nx">showCoords</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s1">&#39;clientX value: &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;clientY value: &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这两个属性还分别有一个别名<code class="docutils literal notranslate"><span class="pre">MouseEvent.x</span></code>和<code class="docutils literal notranslate"><span class="pre">MouseEvent.y</span></code>。</p>
</div>
<div class="section" id="mouseevent-movementx-mouseevent-movementy">
<span id="mouseevent-movementx-mouseevent-movementy"></span><h3>MouseEvent.movementX，MouseEvent.movementY<a class="headerlink" href="#mouseevent-movementx-mouseevent-movementy" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.movementX</span></code>属性返回当前位置与上一个<code class="docutils literal notranslate"><span class="pre">mousemove</span></code>事件之间的水平距离（单位像素）。数值上，它等于下面的计算公式。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">currentEvent</span><span class="p">.</span><span class="nx">movementX</span> <span class="o">=</span> <span class="nx">currentEvent</span><span class="p">.</span><span class="nx">screenX</span> <span class="o">-</span> <span class="nx">previousEvent</span><span class="p">.</span><span class="nx">screenX</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.movementY</span></code>属性返回当前位置与上一个<code class="docutils literal notranslate"><span class="pre">mousemove</span></code>事件之间的垂直距离（单位像素）。数值上，它等于下面的计算公式。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>currentEvent.movementY = currentEvent.screenY - previousEvent.screenY。
</pre></div>
</div>
<p>这两个属性都是只读属性。</p>
</div>
<div class="section" id="mouseevent-screenx-mouseevent-screeny">
<span id="mouseevent-screenx-mouseevent-screeny"></span><h3>MouseEvent.screenX，MouseEvent.screenY<a class="headerlink" href="#mouseevent-screenx-mouseevent-screeny" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.screenX</span></code>属性返回鼠标位置相对于屏幕左上角的水平坐标（单位像素），<code class="docutils literal notranslate"><span class="pre">MouseEvent.screenY</span></code>属性返回垂直坐标。这两个属性都是只读属性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;body onmousedown=&quot;showCoords(event)&quot;&gt;</span>
<span class="kd">function</span> <span class="nx">showCoords</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s1">&#39;screenX value: &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">screenX</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span>
    <span class="s1">&#39;screenY value: &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">screenY</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="mouseevent-offsetx-mouseevent-offsety">
<span id="mouseevent-offsetx-mouseevent-offsety"></span><h3>MouseEvent.offsetX，MouseEvent.offsetY<a class="headerlink" href="#mouseevent-offsetx-mouseevent-offsety" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.offsetX</span></code>属性返回鼠标位置与目标节点左侧的<code class="docutils literal notranslate"><span class="pre">padding</span></code>边缘的水平距离（单位像素），<code class="docutils literal notranslate"><span class="pre">MouseEvent.offsetY</span></code>属性返回与目标节点上方的<code class="docutils literal notranslate"><span class="pre">padding</span></code>边缘的垂直距离。这两个属性都是只读属性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm">  &lt;style&gt;</span>
<span class="cm">    p {</span>
<span class="cm">      width: 100px;</span>
<span class="cm">      height: 100px;</span>
<span class="cm">      padding: 100px;</span>
<span class="cm">    }</span>
<span class="cm">  &lt;/style&gt;</span>
<span class="cm">  &lt;p&gt;Hello&lt;/p&gt;</span>
<span class="cm">*/</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="s1">&#39;click&#39;</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="kc">false</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，鼠标如果在<code class="docutils literal notranslate"><span class="pre">p</span></code>元素的中心位置点击，会返回<code class="docutils literal notranslate"><span class="pre">150</span> <span class="pre">150</span></code>。因此中心位置距离左侧和上方的<code class="docutils literal notranslate"><span class="pre">padding</span></code>边缘，等于<code class="docutils literal notranslate"><span class="pre">padding</span></code>的宽度（100像素）加上元素内容区域一半的宽度（50像素）。</p>
</div>
<div class="section" id="mouseevent-pagex-mouseevent-pagey">
<span id="mouseevent-pagex-mouseevent-pagey"></span><h3>MouseEvent.pageX，MouseEvent.pageY<a class="headerlink" href="#mouseevent-pagex-mouseevent-pagey" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.pageX</span></code>属性返回鼠标位置与文档左侧边缘的距离（单位像素），<code class="docutils literal notranslate"><span class="pre">MouseEvent.pageY</span></code>属性返回与文档上侧边缘的距离（单位像素）。它们的返回值都包括文档不可见的部分。这两个属性都是只读。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm">  &lt;style&gt;</span>
<span class="cm">    body {</span>
<span class="cm">      height: 2000px;</span>
<span class="cm">    }</span>
<span class="cm">  &lt;/style&gt;</span>
<span class="cm">*/</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="s1">&#39;click&#39;</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="kc">false</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，页面高度为2000像素，会产生垂直滚动条。滚动到页面底部，点击鼠标输出的<code class="docutils literal notranslate"><span class="pre">pageY</span></code>值会接近2000。</p>
</div>
<div class="section" id="mouseevent-relatedtarget">
<span id="mouseevent-relatedtarget"></span><h3>MouseEvent.relatedTarget<a class="headerlink" href="#mouseevent-relatedtarget" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.relatedTarget</span></code>属性返回事件的相关节点。对于那些没有相关节点的事件，该属性返回<code class="docutils literal notranslate"><span class="pre">null</span></code>。该属性只读。</p>
<p>下表列出不同事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性值和<code class="docutils literal notranslate"><span class="pre">relatedTarget</span></code>属性值义。</p>
<p>|事件名称 |target 属性 |relatedTarget 属性 |
|---------|-----------|------------------|
|focusin |接受焦点的节点 |丧失焦点的节点 |
|focusout |丧失焦点的节点 |接受焦点的节点 |
|mouseenter |将要进入的节点 |将要离开的节点 |
|mouseleave |将要离开的节点 |将要进入的节点 |
|mouseout |将要离开的节点 |将要进入的节点 |
|mouseover |将要进入的节点 |将要离开的节点 |
|dragenter |将要进入的节点 |将要离开的节点 |
|dragexit |将要离开的节点 |将要进入的节点 |</p>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  HTML 代码如下</span>
<span class="cm">  &lt;div id=&quot;outer&quot; style=&quot;height:50px;width:50px;border-width:1px solid black;&quot;&gt;</span>
<span class="cm">    &lt;div id=&quot;inner&quot; style=&quot;height:25px;width:25px;border:1px solid black;&quot;&gt;&lt;/div&gt;</span>
<span class="cm">  &lt;/div&gt;</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">inner</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;inner&#39;</span><span class="p">);</span>
<span class="nx">inner</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;进入&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; 离开&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">inner</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;进入&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; 离开&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">inner</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;离开&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; 进入&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">inner</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mouseleave&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;离开&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; 进入&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 鼠标从 outer 进入inner，输出</span>
<span class="c1">// 进入inner 离开outer</span>
<span class="c1">// 进入inner 离开outer</span>

<span class="c1">// 鼠标从 inner进入 outer，输出</span>
<span class="c1">// 离开inner 进入outer</span>
<span class="c1">// 离开inner 进入outer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mouseevent">
<span id="id4"></span><h2>MouseEvent 接口的实例方法<a class="headerlink" href="#mouseevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="mouseevent-getmodifierstate">
<span id="mouseevent-getmodifierstate"></span><h3>MouseEvent.getModifierState()<a class="headerlink" href="#mouseevent-getmodifierstate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MouseEvent.getModifierState</span></code>方法返回一个布尔值，表示有没有按下特定的功能键。它的参数是一个表示<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/getModifierState#Modifier_keys_on_Gecko">功能键</a>的字符串。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">getModifierState</span><span class="p">(</span><span class="s1">&#39;CapsLock&#39;</span><span class="p">));</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面的代码可以了解用户是否按下了大写键。</p>
</div>
</div>
<div class="section" id="wheelevent">
<span id="wheelevent"></span><h2>WheelEvent 接口<a class="headerlink" href="#wheelevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="">
<span id="id5"></span><h3>概述<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>WheelEvent 接口继承了 MouseEvent 实例，代表鼠标滚轮事件的实例对象。目前，鼠标滚轮相关的事件只有一个<code class="docutils literal notranslate"><span class="pre">wheel</span></code>事件，用户滚动鼠标的滚轮，就生成这个事件的实例。</p>
<p>浏览器原生提供<code class="docutils literal notranslate"><span class="pre">WheelEvent()</span></code>构造函数，用来生成<code class="docutils literal notranslate"><span class="pre">WheelEvent</span></code>实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">wheelEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WheelEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WheelEvent()</span></code>构造函数可以接受两个参数，第一个是字符串，表示事件类型，对于滚轮事件来说，这个值目前只能是<code class="docutils literal notranslate"><span class="pre">wheel</span></code>。第二个参数是事件的配置对象。该对象的属性除了<code class="docutils literal notranslate"><span class="pre">Event</span></code>、<code class="docutils literal notranslate"><span class="pre">UIEvent</span></code>的配置属性以外，还可以接受以下几个属性，所有属性都是可选的。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">deltaX</span></code>：数值，表示滚轮的水平滚动量，默认值是 0.0。</li>
<li><code class="docutils literal notranslate"><span class="pre">deltaY</span></code>：数值，表示滚轮的垂直滚动量，默认值是 0.0。</li>
<li><code class="docutils literal notranslate"><span class="pre">deltaZ</span></code>：数值，表示滚轮的 Z 轴滚动量，默认值是 0.0。</li>
<li><code class="docutils literal notranslate"><span class="pre">deltaMode</span></code>：数值，表示相关的滚动事件的单位，适用于上面三个属性。<code class="docutils literal notranslate"><span class="pre">0</span></code>表示滚动单位为像素，<code class="docutils literal notranslate"><span class="pre">1</span></code>表示单位为行，<code class="docutils literal notranslate"><span class="pre">2</span></code>表示单位为页，默认为<code class="docutils literal notranslate"><span class="pre">0</span></code>。</li>
</ul>
</div>
<div class="section" id="">
<span id="id6"></span><h3>实例属性<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">WheelEvent</span></code>事件实例除了具有<code class="docutils literal notranslate"><span class="pre">Event</span></code>和<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>的实例属性和实例方法，还有一些自己的实例属性，但是没有自己的实例方法。</p>
<p>下面的属性都是只读属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">WheelEvent.deltaX</span></code>：数值，表示滚轮的水平滚动量。</li>
<li><code class="docutils literal notranslate"><span class="pre">WheelEvent.deltaY</span></code>：数值，表示滚轮的垂直滚动量。</li>
<li><code class="docutils literal notranslate"><span class="pre">WheelEvent.deltaZ</span></code>：数值，表示滚轮的 Z 轴滚动量。</li>
<li><code class="docutils literal notranslate"><span class="pre">WheelEvent.deltaMode</span></code>：数值，表示上面三个属性的单位，<code class="docutils literal notranslate"><span class="pre">0</span></code>是像素，<code class="docutils literal notranslate"><span class="pre">1</span></code>是行，<code class="docutils literal notranslate"><span class="pre">2</span></code>是页。</li>
</ul>
</div>
</div>
<div class="section" id="">
<span id="id7"></span><h2>键盘事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>键盘事件由用户击打键盘触发，主要有<code class="docutils literal notranslate"><span class="pre">keydown</span></code>、<code class="docutils literal notranslate"><span class="pre">keypress</span></code>、<code class="docutils literal notranslate"><span class="pre">keyup</span></code>三个事件，它们都继承了<code class="docutils literal notranslate"><span class="pre">KeyboardEvent</span></code>接口。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">keydown</span></code>：按下键盘时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">keypress</span></code>：按下有值的键时触发，即按下 Ctrl、Alt、Shift、Meta 这样无值的键，这个事件不会触发。对于有值的键，按下时先触发<code class="docutils literal notranslate"><span class="pre">keydown</span></code>事件，再触发这个事件。</li>
<li><code class="docutils literal notranslate"><span class="pre">keyup</span></code>：松开键盘时触发该事件。</li>
</ul>
<p>如果用户一直按键不松开，就会连续触发键盘事件，触发的顺序如下。</p>
<ol class="simple">
<li>keydown</li>
<li>keypress</li>
<li>keydown</li>
<li>keypress</li>
<li>...（重复以上过程）</li>
<li>keyup</li>
</ol>
</div>
<div class="section" id="keyboardevent">
<span id="keyboardevent"></span><h2>KeyboardEvent 接口<a class="headerlink" href="#keyboardevent" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent</span></code>接口用来描述用户与键盘的互动。这个接口继承了<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口，并且定义了自己的实例属性和实例方法。</p>
<p>浏览器原生提供<code class="docutils literal notranslate"><span class="pre">KeyboardEvent</span></code>构造函数，用来新建键盘事件的实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">KeyboardEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent</span></code>构造函数接受两个参数。第一个参数是字符串，表示事件类型；第二个参数是一个事件配置对象，该参数可选。除了<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口提供的属性，还可以配置以下字段，它们都是可选。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">key</span></code>：字符串，当前按下的键，默认为空字符串。</li>
<li><code class="docutils literal notranslate"><span class="pre">code</span></code>：字符串，表示当前按下的键的字符串形式，默认为空字符串。</li>
<li><code class="docutils literal notranslate"><span class="pre">location</span></code>：整数，当前按下的键的位置，默认为<code class="docutils literal notranslate"><span class="pre">0</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">ctrlKey</span></code>：布尔值，是否按下 Ctrl 键，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">shiftKey</span></code>：布尔值，是否按下 Shift 键，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">altKey</span></code>：布尔值，是否按下 Alt 键，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">metaKey</span></code>：布尔值，是否按下 Meta 键，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">repeat</span></code>：布尔值，是否重复按键，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
</ul>
</div>
<div class="section" id="keyboardevent">
<span id="id8"></span><h2>KeyboardEvent 的实例属性<a class="headerlink" href="#keyboardevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="keyboardevent-altkey-keyboardevent-metakey-ctrlkey-keyboardevent-metakey-keyboardevent-shiftkey">
<span id="keyboardevent-altkey-keyboardevent-metakey-ctrlkey-keyboardevent-metakey-keyboardevent-shiftkey"></span><h3>KeyboardEvent.altKey，KeyboardEvent.metaKey.ctrlKey，KeyboardEvent.metaKey，KeyboardEvent.shiftKey<a class="headerlink" href="#keyboardevent-altkey-keyboardevent-metakey-ctrlkey-keyboardevent-metakey-keyboardevent-shiftkey" title="永久链接至标题">¶</a></h3>
<p>以下属性都是只读属性，返回一个布尔值，表示是否按下对应的键。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.altKey</span></code>：是否按下 Alt 键</li>
<li><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.ctrlKey</span></code>：是否按下 Ctrl 键</li>
<li><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.metaKey</span></code>：是否按下 meta 键（Mac 系统是一个四瓣的小花，Windows 系统是 windows 键）</li>
<li><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.shiftKey</span></code>：是否按下 Shift 键</li>
</ul>
<p>下面是一个示例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">showChar</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ALT: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;CTRL: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Meta: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Meta: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">showChar</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="keyboardevent-code">
<span id="keyboardevent-code"></span><h3>KeyboardEvent.code<a class="headerlink" href="#keyboardevent-code" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.code</span></code>属性返回一个字符串，表示当前按下的键的字符串形式。该属性只读。</p>
<p>下面是一些常用键的字符串形式，其他键请查<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code#Code_values">文档</a>。</p>
<ul class="simple">
<li>数字键0 - 9：返回<code class="docutils literal notranslate"><span class="pre">digital0</span></code> - <code class="docutils literal notranslate"><span class="pre">digital9</span></code></li>
<li>字母键A - z：返回<code class="docutils literal notranslate"><span class="pre">KeyA</span></code> - <code class="docutils literal notranslate"><span class="pre">KeyZ</span></code></li>
<li>功能键F1 - F12：返回 <code class="docutils literal notranslate"><span class="pre">F1</span></code> - <code class="docutils literal notranslate"><span class="pre">F12</span></code></li>
<li>方向键：返回<code class="docutils literal notranslate"><span class="pre">ArrowDown</span></code>、<code class="docutils literal notranslate"><span class="pre">ArrowUp</span></code>、<code class="docutils literal notranslate"><span class="pre">ArrowLeft</span></code>、<code class="docutils literal notranslate"><span class="pre">ArrowRight</span></code></li>
<li>Alt 键：返回<code class="docutils literal notranslate"><span class="pre">AltLeft</span></code>或<code class="docutils literal notranslate"><span class="pre">AltRight</span></code></li>
<li>Shift 键：返回<code class="docutils literal notranslate"><span class="pre">ShiftLeft</span></code>或<code class="docutils literal notranslate"><span class="pre">ShiftRight</span></code></li>
<li>Ctrl 键：返回<code class="docutils literal notranslate"><span class="pre">ControLeft</span></code>或<code class="docutils literal notranslate"><span class="pre">ControlRight</span></code></li>
</ul>
</div>
<div class="section" id="keyboardevent-key">
<span id="keyboardevent-key"></span><h3>KeyboardEvent.key<a class="headerlink" href="#keyboardevent-key" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.key</span></code>属性返回一个字符串，表示按下的键名。该属性只读。</p>
<p>如果按下的键代表可打印字符，则返回这个字符，比如数字、字母。</p>
<p>如果按下的键代表不可打印的特殊字符，则返回预定义的键值，比如 Backspace，Tab，Enter，Shift，Control，Alt，CapsLock，Esc，Spacebar，PageUp，PageDown，End，Home，Left，Right，Up，Down，PrintScreen，Insert，Del，Win，F1～F12，NumLock，Scroll 等。</p>
<p>如果同时按下一个控制键和一个符号键，则返回符号键的键名。比如，按下 Ctrl + a，则返回<code class="docutils literal notranslate"><span class="pre">a</span></code>；按下 Shift + a，则返回大写的<code class="docutils literal notranslate"><span class="pre">A</span></code>。</p>
<p>如果无法识别键名，返回字符串<code class="docutils literal notranslate"><span class="pre">Unidentified</span></code>。</p>
</div>
<div class="section" id="keyboardevent-location">
<span id="keyboardevent-location"></span><h3>KeyboardEvent.location<a class="headerlink" href="#keyboardevent-location" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.location</span></code>属性返回一个整数，表示按下的键处在键盘的哪一个区域。它可能取以下值。</p>
<ul class="simple">
<li>0：处在键盘的主区域，或者无法判断处于哪一个区域。</li>
<li>1：处在键盘的左侧，只适用那些有两个位置的键（比如 Ctrl 和 Shift 键）。</li>
<li>2：处在键盘的右侧，只适用那些有两个位置的键（比如 Ctrl 和 Shift 键）。</li>
<li>3：处在数字小键盘。</li>
</ul>
</div>
<div class="section" id="keyboardevent-repeat">
<span id="keyboardevent-repeat"></span><h3>KeyboardEvent.repeat<a class="headerlink" href="#keyboardevent-repeat" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.repeat</span></code>返回一个布尔值，代表该键是否被按着不放，以便判断是否重复这个键，即浏览器会持续触发<code class="docutils literal notranslate"><span class="pre">keydown</span></code>和<code class="docutils literal notranslate"><span class="pre">keypress</span></code>事件，直到用户松开手为止。</p>
</div>
</div>
<div class="section" id="keyboardevent">
<span id="id9"></span><h2>KeyboardEvent 的实例方法<a class="headerlink" href="#keyboardevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="keyboardevent-getmodifierstate">
<span id="keyboardevent-getmodifierstate"></span><h3>KeyboardEvent.getModifierState()<a class="headerlink" href="#keyboardevent-getmodifierstate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">KeyboardEvent.getModifierState()</span></code>方法返回一个布尔值，表示是否按下或激活指定的功能键。它的常用参数如下。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Alt</span></code>：Alt 键</li>
<li><code class="docutils literal notranslate"><span class="pre">CapsLock</span></code>：大写锁定键</li>
<li><code class="docutils literal notranslate"><span class="pre">Control</span></code>：Ctrl 键</li>
<li><code class="docutils literal notranslate"><span class="pre">Meta</span></code>：Meta 键</li>
<li><code class="docutils literal notranslate"><span class="pre">NumLock</span></code>：数字键盘开关键</li>
<li><code class="docutils literal notranslate"><span class="pre">Shift</span></code>：Shift 键</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">getModifierState</span><span class="p">(</span><span class="s1">&#39;Control&#39;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">getModifierState</span><span class="p">(</span><span class="s1">&#39;Alt&#39;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">getModifierState</span><span class="p">(</span><span class="s1">&#39;Meta&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码表示，只要<code class="docutils literal notranslate"><span class="pre">Control</span></code>、<code class="docutils literal notranslate"><span class="pre">Alt</span></code>、<code class="docutils literal notranslate"><span class="pre">Meta</span></code>里面，同时按下任意两个或两个以上的键就返回。</p>
</div>
</div>
<div class="section" id="">
<span id="id10"></span><h2>进度事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>进度事件用来描述资源加载的进度，主要由 AJAX 请求、<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;link&gt;</span></code>等外部资源的加载触发，继承了<code class="docutils literal notranslate"><span class="pre">ProgressEvent</span></code>接口。它主要包含以下几种事件。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">abort</span></code>：外部资源中止加载时（比如用户取消）触发。如果发生错误导致中止，不会触发该事件。</li>
<li><code class="docutils literal notranslate"><span class="pre">error</span></code>：由于错误导致外部资源无法加载时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">load</span></code>：外部资源加载成功时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">loadstart</span></code>：外部资源开始加载时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">loadend</span></code>：外部资源停止加载时触发，发生顺序排在<code class="docutils literal notranslate"><span class="pre">error</span></code>、<code class="docutils literal notranslate"><span class="pre">abort</span></code>、<code class="docutils literal notranslate"><span class="pre">load</span></code>等事件的后面。</li>
<li><code class="docutils literal notranslate"><span class="pre">progress</span></code>：外部资源加载过程中不断触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">timeout</span></code>：加载超时时触发。</li>
</ul>
<p>注意，除了资源下载，文件上传也存在这些事件。</p>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">image</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;finished&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">image</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码在图片元素加载完成后，为图片元素添加一个<code class="docutils literal notranslate"><span class="pre">finished</span></code>的 Class。如果加载失败，就把图片元素的样式设置为不显示。</p>
<p>有时候，图片加载会在脚本运行之前就完成，尤其是当脚本放置在网页底部的时候，因此有可能<code class="docutils literal notranslate"><span class="pre">load</span></code>和<code class="docutils literal notranslate"><span class="pre">error</span></code>事件的监听函数根本不会执行。所以，比较可靠的方式，是用<code class="docutils literal notranslate"><span class="pre">complete</span></code>属性先判断一下是否加载完成。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">loaded</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">loaded</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">loaded</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>由于 DOM 的元素节点没有提供是否加载错误的属性，所以<code class="docutils literal notranslate"><span class="pre">error</span></code>事件的监听函数最好放在<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>元素的 HTML 代码中，这样才能保证发生加载错误时百分之百会执行。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/wrong/url&quot;</span> <span class="na">onerror</span><span class="o">=</span><span class="s">&quot;this.style.display=&#39;none&#39;;&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">loadend</span></code>事件的监听函数，可以用来取代<code class="docutils literal notranslate"><span class="pre">abort</span></code>事件、<code class="docutils literal notranslate"><span class="pre">load</span></code>事件、<code class="docutils literal notranslate"><span class="pre">error</span></code>事件的监听函数，因为它总是在这些事件之后发生。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;loadend&#39;</span><span class="p">,</span> <span class="nx">loadEnd</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">loadEnd</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;传输结束，成功失败未知&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">loadend</span></code>事件本身不提供关于进度结束的原因，但可以用它来做所有加载结束场景都需要做的一些操作。</p>
<p>另外，<code class="docutils literal notranslate"><span class="pre">error</span></code>事件有一个特殊的性质，就是不会冒泡。所以，子元素的<code class="docutils literal notranslate"><span class="pre">error</span></code>事件，不会触发父元素的<code class="docutils literal notranslate"><span class="pre">error</span></code>事件监听函数。</p>
</div>
<div class="section" id="progressevent">
<span id="progressevent"></span><h2>ProgressEvent 接口<a class="headerlink" href="#progressevent" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ProgressEvent</span></code>接口主要用来描述外部资源加载的进度，比如 AJAX 加载、<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;link&gt;</span></code>等外部资源加载。进度相关的事件都继承了这个接口。</p>
<p>浏览器原生提供了<code class="docutils literal notranslate"><span class="pre">ProgressEvent()</span></code>构造函数，用来生成事件实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">ProgressEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ProgressEvent()</span></code>构造函数接受两个参数。第一个参数是字符串，表示事件的类型，这个参数是必须的。第二个参数是一个配置对象，表示事件的属性，该参数可选。配置对象除了可以使用<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口的配置属性，还可以使用下面的属性，所有这些属性都是可选的。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">lengthComputable</span></code>：布尔值，表示加载的总量是否可以计算，默认是<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">loaded</span></code>：整数，表示已经加载的量，默认是<code class="docutils literal notranslate"><span class="pre">0</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">total</span></code>：整数，表示需要加载的总量，默认是<code class="docutils literal notranslate"><span class="pre">0</span></code>。</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ProgressEvent</span></code>具有对应的实例属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ProgressEvent.lengthComputable</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ProgressEvent.loaded</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ProgressEvent.total</span></code></li>
</ul>
<p>如果<code class="docutils literal notranslate"><span class="pre">ProgressEvent.lengthComputable</span></code>为<code class="docutils literal notranslate"><span class="pre">false</span></code>，<code class="docutils literal notranslate"><span class="pre">ProgressEvent.total</span></code>实际上是没有意义的。</p>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProgressEvent</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">lengthComputable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">loaded</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="nx">total</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;已经加载：&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
<span class="c1">// 已经加载：30%</span>
</pre></div>
</div>
<p>上面代码先构造一个<code class="docutils literal notranslate"><span class="pre">load</span></code>事件，抛出后被监听函数捕捉到。</p>
<p>下面是一个实际的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">updateProgress</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;不能计算进度&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferComplete</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;传输结束&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferFailed</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;传输过程中发生错误&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferCanceled</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;用户取消了传输&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面是下载过程的进度事件，还存在上传过程的进度事件。这时所有监听函数都要放在<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest.upload</span></code>对象上面。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id11"></span><h2>拖拉事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>拖拉（drag）指的是，用户在某个对象上按下鼠标键不放，拖动它到另一个位置，然后释放鼠标键，将该对象放在那里。</p>
<p>拖拉的对象有好几种，包括元素节点、图片、链接、选中的文字等等。在网页中，除了元素节点默认不可以拖拉，其他（图片、链接、选中的文字）都是可以直接拖拉的。为了让元素节点可拖拉，可以将该节点的<code class="docutils literal notranslate"><span class="pre">draggable</span></code>属性设为<code class="docutils literal notranslate"><span class="pre">true</span></code>。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">draggable</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
  此区域可拖拉
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">draggable</span></code>属性可用于任何元素节点，但是图片（<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>）和链接（<code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code>）不加这个属性，就可以拖拉。对于它们，用到这个属性的时候，往往是将其设为<code class="docutils literal notranslate"><span class="pre">false</span></code>，防止拖拉这两种元素。</p>
<p>注意，一旦某个元素节点的<code class="docutils literal notranslate"><span class="pre">draggable</span></code>属性设为<code class="docutils literal notranslate"><span class="pre">true</span></code>，就无法再用鼠标选中该节点内部的文字或子节点了。</p>
<p>当元素节点或选中的文本被拖拉时，就会持续触发拖拉事件，包括以下一些事件。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">drag</span></code>：拖拉过程中，在被拖拉的节点上持续触发（相隔几百毫秒）。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragstart</span></code>：用户开始拖拉时，在被拖拉的节点上触发，该事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性是被拖拉的节点。通常应该在这个事件的监听函数中，指定拖拉的数据。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragend</span></code>：拖拉结束时（释放鼠标键或按下 ESC 键）在被拖拉的节点上触发，该事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性是被拖拉的节点。它与<code class="docutils literal notranslate"><span class="pre">dragstart</span></code>事件，在同一个节点上触发。不管拖拉是否跨窗口，或者中途被取消，<code class="docutils literal notranslate"><span class="pre">dragend</span></code>事件总是会触发的。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragenter</span></code>：拖拉进入当前节点时，在当前节点上触发一次，该事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性是当前节点。通常应该在这个事件的监听函数中，指定是否允许在当前节点放下（drop）拖拉的数据。如果当前节点没有该事件的监听函数，或者监听函数不执行任何操作，就意味着不允许在当前节点放下数据。在视觉上显示拖拉进入当前节点，也是在这个事件的监听函数中设置。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragover</span></code>：拖拉到当前节点上方时，在当前节点上持续触发（相隔几百毫秒），该事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性是当前节点。该事件与<code class="docutils literal notranslate"><span class="pre">dragenter</span></code>事件的区别是，<code class="docutils literal notranslate"><span class="pre">dragenter</span></code>事件在进入该节点时触发，然后只要没有离开这个节点，<code class="docutils literal notranslate"><span class="pre">dragover</span></code>事件会持续触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragleave</span></code>：拖拉操作离开当前节点范围时，在当前节点上触发，该事件的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性是当前节点。如果要在视觉上显示拖拉离开操作当前节点，就在这个事件的监听函数中设置。</li>
<li><code class="docutils literal notranslate"><span class="pre">drop</span></code>：被拖拉的节点或选中的文本，释放到目标节点时，在目标节点上触发。注意，如果当前节点不允许<code class="docutils literal notranslate"><span class="pre">drop</span></code>，即使在该节点上方松开鼠标键，也不会触发该事件。如果用户按下 ESC 键，取消这个操作，也不会触发该事件。该事件的监听函数负责取出拖拉数据，并进行相关处理。</li>
</ul>
<p>下面的例子展示，如何动态改变被拖动节点的背景色。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragend&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">div</span></code>节点被拖动时，背景色会变为红色，拖动结束，又变回绿色。</p>
<p>下面是一个例子，展示如何实现将一个节点从当前父节点，拖拉到另一个父节点中。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm"> &lt;div class=&quot;dropzone&quot;&gt;</span>
<span class="cm">   &lt;div id=&quot;draggable&quot; draggable=&quot;true&quot;&gt;</span>
<span class="cm">     该节点可拖拉</span>
<span class="cm">   &lt;/div&gt;</span>
<span class="cm"> &lt;/div&gt;</span>
<span class="cm"> &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</span>
<span class="cm"> &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</span>
<span class="cm"> &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</span>
<span class="cm">*/</span>

<span class="c1">// 被拖拉节点</span>
<span class="kd">var</span> <span class="nx">dragged</span><span class="p">;</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 保存被拖拉节点</span>
  <span class="nx">dragged</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
  <span class="c1">// 被拖拉节点的背景色变透明</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragend&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 被拖拉节点的背景色恢复正常</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 防止拖拉效果被重置，允许被拖拉的节点放入目标节点</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragenter&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 目标节点的背景色变紫色</span>
  <span class="c1">// 由于该事件会冒泡，所以要过滤节点</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">&#39;dropzone&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragleave&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 目标节点的背景色恢复原样</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">&#39;dropzone&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 防止事件默认行为（比如某些元素节点上可以打开链接），</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">&#39;dropzone&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 恢复目标节点背景色</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="c1">// 将被拖拉节点插入目标节点</span>
    <span class="nx">dragged</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">dragged</span><span class="p">);</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">dragged</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>关于拖拉事件，有以下几个注意点。</p>
<ul class="simple">
<li>拖拉过程只触发以上这些拖拉事件，尽管鼠标在移动，但是鼠标事件不会触发。</li>
<li>将文件从操作系统拖拉进浏览器，不会触发<code class="docutils literal notranslate"><span class="pre">dragstart</span></code>和<code class="docutils literal notranslate"><span class="pre">dragend</span></code>事件。</li>
<li><code class="docutils literal notranslate"><span class="pre">dragenter</span></code>和<code class="docutils literal notranslate"><span class="pre">dragover</span></code>事件的监听函数，用来取出拖拉的数据（即允许放下被拖拉的元素）。由于网页的大部分区域不适合作为放下拖拉元素的目标节点，所以这两个事件的默认设置为当前节点不允许接受被拖拉的元素。如果想要在目标节点上放下的数据，首先必须阻止这两个事件的默认行为。</li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">ondragover</span><span class="o">=</span><span class="s">&quot;return false&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ondragover</span><span class="o">=</span><span class="s">&quot;event.preventDefault()&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，如果不取消拖拉事件或者阻止默认行为，就不能在<code class="docutils literal notranslate"><span class="pre">div</span></code>节点上放下被拖拉的节点。</p>
</div>
<div class="section" id="dragevent">
<span id="dragevent"></span><h2>DragEvent 接口<a class="headerlink" href="#dragevent" title="永久链接至标题">¶</a></h2>
<p>拖拉事件都继承了<code class="docutils literal notranslate"><span class="pre">DragEvent</span></code>接口，这个接口又继承了<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>接口和<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口。</p>
<p>浏览器原生提供一个<code class="docutils literal notranslate"><span class="pre">DragEvent()</span></code>构造函数，用来生成拖拉事件的实例对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">DragEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DragEvent()</span></code>构造函数接受两个参数，第一个参数是字符串，表示事件的类型，该参数必须；第二个参数是事件的配置对象，用来设置事件的属性，该参数可选。配置对象除了接受<code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code>接口和<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口的配置属性，还可以设置<code class="docutils literal notranslate"><span class="pre">dataTransfer</span></code>属性要么是<code class="docutils literal notranslate"><span class="pre">null</span></code>，要么是一个<code class="docutils literal notranslate"><span class="pre">DataTransfer</span></code>接口的实例。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer</span></code>的实例对象用来读写拖拉事件中传输的数据，详见下文《DataTransfer 接口》的部分。</p>
</div>
<div class="section" id="datatransfer">
<span id="datatransfer"></span><h2>DataTransfer 接口概述<a class="headerlink" href="#datatransfer" title="永久链接至标题">¶</a></h2>
<p>所有拖拉事件的实例都有一个<code class="docutils literal notranslate"><span class="pre">DragEvent.dataTransfer</span></code>属性，用来读写需要传递的数据。这个属性的值是一个<code class="docutils literal notranslate"><span class="pre">DataTransfer</span></code>接口的实例。</p>
<p>浏览器原生提供一个<code class="docutils literal notranslate"><span class="pre">DataTransfer()</span></code>构造函数，用来生成<code class="docutils literal notranslate"><span class="pre">DataTransfer</span></code>实例对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">dataTrans</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataTransfer</span><span class="p">();</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer()</span></code>构造函数不接受参数。</p>
<p>拖拉的数据分成两方面：数据的种类（又称格式）和数据的值。数据的种类是一个 MIME 字符串（比如<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>、<code class="docutils literal notranslate"><span class="pre">image/jpeg</span></code>），数据的值是一个字符串。一般来说，如果拖拉一段文本，则数据默认就是那段文本；如果拖拉一个链接，则数据默认就是链接的 URL。</p>
<p>拖拉事件开始时，开发者可以提供数据类型和数据值。拖拉过程中，开发者通过<code class="docutils literal notranslate"><span class="pre">dragenter</span></code>和<code class="docutils literal notranslate"><span class="pre">dragover</span></code>事件的监听函数，检查数据类型，以确定是否允许放下（drop）被拖拉的对象。比如，在只允许放下链接的区域，检查拖拉的数据类型是否为<code class="docutils literal notranslate"><span class="pre">text/uri-list</span></code>。</p>
<p>发生<code class="docutils literal notranslate"><span class="pre">drop</span></code>事件时，监听函数取出拖拉的数据，对其进行处理。</p>
</div>
<div class="section" id="datatransfer">
<span id="id12"></span><h2>DataTransfer 的实例属性<a class="headerlink" href="#datatransfer" title="永久链接至标题">¶</a></h2>
<div class="section" id="datatransfer-dropeffect">
<span id="datatransfer-dropeffect"></span><h3>DataTransfer.dropEffect<a class="headerlink" href="#datatransfer-dropeffect" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.dropEffect</span></code>属性用来设置放下（drop）被拖拉节点时的效果，会影响到拖拉经过相关区域时鼠标的形状。它可能取下面的值。</p>
<ul class="simple">
<li>copy：复制被拖拉的节点</li>
<li>move：移动被拖拉的节点</li>
<li>link：创建指向被拖拉的节点的链接</li>
<li>none：无法放下被拖拉的节点</li>
</ul>
<p>除了上面这些值，设置其他的值都是无效的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">target</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s1">&#39;copy&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，被拖拉元素一旦<code class="docutils literal notranslate"><span class="pre">drop</span></code>，接受的区域会复制该节点。</p>
<p><code class="docutils literal notranslate"><span class="pre">dropEffect</span></code>属性一般在<code class="docutils literal notranslate"><span class="pre">dragenter</span></code>和<code class="docutils literal notranslate"><span class="pre">dragover</span></code>事件的监听函数中设置，对于<code class="docutils literal notranslate"><span class="pre">dragstart</span></code>、<code class="docutils literal notranslate"><span class="pre">drag</span></code>、<code class="docutils literal notranslate"><span class="pre">dragleave</span></code>这三个事件，该属性不起作用。因为该属性只对接受被拖拉的节点的区域有效，对被拖拉的节点本身是无效的。进入目标区域后，拖拉行为会初始化成设定的效果。</p>
</div>
<div class="section" id="datatransfer-effectallowed">
<span id="datatransfer-effectallowed"></span><h3>DataTransfer.effectAllowed<a class="headerlink" href="#datatransfer-effectallowed" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.effectAllowed</span></code>属性设置本次拖拉中允许的效果。它可能取下面的值。</p>
<ul class="simple">
<li>copy：复制被拖拉的节点</li>
<li>move：移动被拖拉的节点</li>
<li>link：创建指向被拖拉节点的链接</li>
<li>copyLink：允许<code class="docutils literal notranslate"><span class="pre">copy</span></code>或<code class="docutils literal notranslate"><span class="pre">link</span></code></li>
<li>copyMove：允许<code class="docutils literal notranslate"><span class="pre">copy</span></code>或<code class="docutils literal notranslate"><span class="pre">move</span></code></li>
<li>linkMove：允许<code class="docutils literal notranslate"><span class="pre">link</span></code>或<code class="docutils literal notranslate"><span class="pre">move</span></code></li>
<li>all：允许所有效果</li>
<li>none：无法放下被拖拉的节点</li>
<li>uninitialized：默认值，等同于<code class="docutils literal notranslate"><span class="pre">all</span></code></li>
</ul>
<p>如果某种效果是不允许的，用户就无法在目标节点中达成这种效果。</p>
<p>这个属性与<code class="docutils literal notranslate"><span class="pre">dropEffect</span></code>属性是同一件事的两个方面。前者设置被拖拉的节点允许的效果，后者设置接受拖拉的区域的效果，它们往往配合使用。</p>
<p><code class="docutils literal notranslate"><span class="pre">dragstart</span></code>事件的监听函数，可以用来设置这个属性。其他事件的监听函数里面设置这个属性是无效的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s1">&#39;move&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">target</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ev</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s1">&#39;move&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>只要<code class="docutils literal notranslate"><span class="pre">dropEffect</span></code>属性和<code class="docutils literal notranslate"><span class="pre">effectAllowed</span></code>属性之中，有一个为<code class="docutils literal notranslate"><span class="pre">none</span></code>，就无法在目标节点上完成<code class="docutils literal notranslate"><span class="pre">drop</span></code>操作。</p>
</div>
<div class="section" id="datatransfer-files">
<span id="datatransfer-files"></span><h3>DataTransfer.files<a class="headerlink" href="#datatransfer-files" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.files</span></code>属性是一个 FileList 对象，包含一组本地文件，可以用来在拖拉操作中传送。如果本次拖拉不涉及文件，则该属性为空的 FileList 对象。</p>
<p>下面就是一个接收拖拉文件的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id=&quot;output&quot; style=&quot;min-height: 200px;border: 1px solid black;&quot;&gt;</span>
<span class="c1">//   文件拖拉到这里</span>
<span class="c1">// &lt;/div&gt;</span>

<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;dragenter&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;dragover&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">+=</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">size</span> <span class="o">+</span> <span class="s1">&#39;字节\n&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，通过<code class="docutils literal notranslate"><span class="pre">dataTransfer.files</span></code>属性读取被拖拉的文件的信息。如果想要读取文件内容，就要使用<code class="docutils literal notranslate"><span class="pre">FileReader</span></code>对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">fileList</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">fileList</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">onloadend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">FileReader</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;File: &#39;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;\n\n&#39;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsBinaryString</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="datatransfer-types">
<span id="datatransfer-types"></span><h3>DataTransfer.types<a class="headerlink" href="#datatransfer-types" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.types</span></code>属性是一个只读的数组，每个成员是一个字符串，里面是拖拉的数据格式（通常是 MIME 值）。比如，如果拖拉的是文字，对应的成员就是<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>。</p>
<p>下面是一个例子，通过检查<code class="docutils literal notranslate"><span class="pre">dataTransfer</span></code>属性的类型，决定是否允许在当前节点执行<code class="docutils literal notranslate"><span class="pre">drop</span></code>操作。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">value</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doDragOver</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">isLink</span> <span class="o">=</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">types</span><span class="p">,</span> <span class="s1">&#39;text/uri-list&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isLink</span><span class="p">)</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码中，只有当被拖拉的节点是一个链接时，才允许在当前节点放下。</p>
</div>
<div class="section" id="datatransfer-items">
<span id="datatransfer-items"></span><h3>DataTransfer.items<a class="headerlink" href="#datatransfer-items" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.items</span></code>属性返回一个类似数组的只读对象（DataTransferItemList 实例），每个成员就是本次拖拉的一个对象（DataTransferItem 实例）。如果本次拖拉不包含对象，则返回一个空对象。</p>
<p>DataTransferItemList 实例具有以下的属性和方法。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">length</span></code>：返回成员的数量</li>
<li><code class="docutils literal notranslate"><span class="pre">add(data,</span> <span class="pre">type)</span></code>：增加一个指定内容和类型（比如<code class="docutils literal notranslate"><span class="pre">text/html</span></code>和<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>）的字符串作为成员</li>
<li><code class="docutils literal notranslate"><span class="pre">add(file)</span></code>：<code class="docutils literal notranslate"><span class="pre">add</span></code>方法的另一种用法，增加一个文件作为成员</li>
<li><code class="docutils literal notranslate"><span class="pre">remove(index)</span></code>：移除指定位置的成员</li>
<li><code class="docutils literal notranslate"><span class="pre">clear()</span></code>：移除所有的成员</li>
</ul>
<p>DataTransferItem 实例具有以下的属性和方法。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">kind</span></code>：返回成员的种类（<code class="docutils literal notranslate"><span class="pre">string</span></code>还是<code class="docutils literal notranslate"><span class="pre">file</span></code>）。</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>：返回成员的类型（通常是 MIME 值）。</li>
<li><code class="docutils literal notranslate"><span class="pre">getAsFile()</span></code>：如果被拖拉是文件，返回该文件，否则返回<code class="docutils literal notranslate"><span class="pre">null</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">getAsString(callback)</span></code>：如果被拖拉的是字符串，将该字符传入指定的回调函数处理。该方法是异步的，所以需要传入回调函数。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">items</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">kind</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="datatransfer">
<span id="id13"></span><h2>DataTransfer 的实例方法<a class="headerlink" href="#datatransfer" title="永久链接至标题">¶</a></h2>
<div class="section" id="datatransfer-setdata">
<span id="datatransfer-setdata"></span><h3>DataTransfer.setData()<a class="headerlink" href="#datatransfer-setdata" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.setData()</span></code>方法用来设置拖拉事件所带有的数据。该方法没有返回值。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;Text to drag&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码为当前的拖拉事件加入纯文本数据。</p>
<p>该方法接受两个参数，都是字符串。第一个参数表示数据类型（比如<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>），第二个参数是具体数据。如果指定类型的数据在<code class="docutils literal notranslate"><span class="pre">dataTransfer</span></code>属性不存在，那么这些数据将被加入，否则原有的数据将被新数据替换。</p>
<p>如果是拖拉文本框或者拖拉选中的文本，会默认将对应的文本数据，添加到<code class="docutils literal notranslate"><span class="pre">dataTransfer</span></code>属性，不用手动指定。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">draggable</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
  aaa
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，拖拉这个<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>元素会自动带上文本数据<code class="docutils literal notranslate"><span class="pre">aaa</span></code>。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">setData</span></code>方法，可以替换到原有数据。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span>
  <span class="na">draggable</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
  <span class="na">ondragstart</span><span class="o">=</span><span class="s">&quot;event.dataTransfer.setData(&#39;text/plain&#39;, &#39;bbb&#39;)&quot;</span>
<span class="p">&gt;</span>
  aaa
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，拖拉数据实际上是<code class="docutils literal notranslate"><span class="pre">bbb</span></code>，而不是<code class="docutils literal notranslate"><span class="pre">aaa</span></code>。</p>
<p>下面是添加其他类型的数据。由于<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>是最普遍支持的格式，为了保证兼容性，建议最后总是保存一份纯文本格式的数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">dt</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">;</span>

<span class="c1">// 添加链接</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com&#39;</span><span class="p">);</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com&#39;</span><span class="p">);</span>

<span class="c1">// 添加 HTML 代码</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&#39;</span><span class="p">);</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&#39;</span><span class="p">);</span>

<span class="c1">// 添加图像的 URL</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">,</span> <span class="nx">imageurl</span><span class="p">);</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="nx">imageurl</span><span class="p">);</span>
</pre></div>
</div>
<p>可以一次提供多种格式的数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">dt</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">;</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;application/x-bookmark&#39;</span><span class="p">,</span> <span class="nx">bookmarkString</span><span class="p">);</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com&#39;</span><span class="p">);</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，通过在同一个事件上面，存放三种类型的数据，使得拖拉事件可以在不同的对象上面，<code class="docutils literal notranslate"><span class="pre">drop</span></code>不同的值。注意，第一种格式是一个自定义格式，浏览器默认无法读取，这意味着，只有某个部署了特定代码的节点，才可能<code class="docutils literal notranslate"><span class="pre">drop</span></code>（读取到）这个数据。</p>
</div>
<div class="section" id="datatransfer-getdata">
<span id="datatransfer-getdata"></span><h3>DataTransfer.getData()<a class="headerlink" href="#datatransfer-getdata" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.getData()</span></code>方法接受一个字符串（表示数据类型）作为参数，返回事件所带的指定类型的数据（通常是用<code class="docutils literal notranslate"><span class="pre">setData</span></code>方法添加的数据）。如果指定类型的数据不存在，则返回空字符串。通常只有<code class="docutils literal notranslate"><span class="pre">drop</span></code>事件触发后，才能取出数据。</p>
<p>下面是一个<code class="docutils literal notranslate"><span class="pre">drop</span></code>事件的监听函数，用来取出指定类型的数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">onDrop</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码取出拖拉事件的文本数据，将其替换成当前节点的文本内容。注意，这时还必须取消浏览器的默认行为，因为假如用户拖拉的是一个链接，浏览器默认会在当前窗口打开这个链接。</p>
<p><code class="docutils literal notranslate"><span class="pre">getData</span></code>方法返回的是一个字符串，如果其中包含多项数据，就必须手动解析。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">doDrop</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">line</span> <span class="k">of</span> <span class="nx">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">line</span><span class="p">;</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">line</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">getData</span></code>方法返回的是一组链接，就必须自行解析。</p>
<p>类型值指定为<code class="docutils literal notranslate"><span class="pre">URL</span></code>，可以取出第一个有效链接。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s1">&#39;URL&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>下面的例子是从多种类型的数据里面取出数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">doDrop</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">types</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">supportedTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">];</span>
  <span class="nx">types</span> <span class="o">=</span> <span class="nx">supportedTypes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="datatransfer-cleardata">
<span id="datatransfer-cleardata"></span><h3>DataTransfer.clearData()<a class="headerlink" href="#datatransfer-cleardata" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.clearData()</span></code>方法接受一个字符串（表示数据类型）作为参数，删除事件所带的指定类型的数据。如果没有指定类型，则删除所有数据。如果指定类型不存在，则调用该方法不会产生任何效果。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">clearData</span><span class="p">(</span><span class="s1">&#39;text/uri-list&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码清除事件所带的<code class="docutils literal notranslate"><span class="pre">text/uri-list</span></code>类型的数据。</p>
<p>该方法不会移除拖拉的文件，因此调用该方法后，<code class="docutils literal notranslate"><span class="pre">DataTransfer.types</span></code>属性可能依然会返回<code class="docutils literal notranslate"><span class="pre">Files</span></code>类型（前提是存在文件拖拉）。</p>
<p>注意，该方法只能在<code class="docutils literal notranslate"><span class="pre">dragstart</span></code>事件的监听函数之中使用，因为这是拖拉操作的数据唯一可写的时机。</p>
</div>
<div class="section" id="datatransfer-setdragimage">
<span id="datatransfer-setdragimage"></span><h3>DataTransfer.setDragImage()<a class="headerlink" href="#datatransfer-setdragimage" title="永久链接至标题">¶</a></h3>
<p>拖动过程中（<code class="docutils literal notranslate"><span class="pre">dragstart</span></code>事件触发后），浏览器会显示一张图片跟随鼠标一起移动，表示被拖动的节点。这张图片是自动创造的，通常显示为被拖动节点的外观，不需要自己动手设置。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataTransfer.setDragImage()</span></code>方法可以自定义这张图片。它接受三个参数。第一个是<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>节点或者<code class="docutils literal notranslate"><span class="pre">&lt;canvas&gt;</span></code>节点，如果省略或为<code class="docutils literal notranslate"><span class="pre">null</span></code>，则使用被拖动的节点的外观；第二个和第三个参数为鼠标相对于该图片左上角的横坐标和右坐标。</p>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* HTML 代码如下</span>
<span class="cm"> &lt;div id=&quot;drag-with-image&quot; class=&quot;dragdemo&quot; draggable=&quot;true&quot;&gt;</span>
<span class="cm">   drag me</span>
<span class="cm"> &lt;/div&gt;</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;drag-with-image&#39;</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dragstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
  <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;http://path/to/img&#39;</span><span class="p">;</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setDragImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id14"></span><h2>触摸操作概述<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>浏览器的触摸 API 由三个部分组成。</p>
<ul class="simple">
<li>Touch：一个触摸点</li>
<li>TouchList：多个触摸点的集合</li>
<li>TouchEvent：触摸引发的事件实例</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Touch</span></code>接口的实例对象用来触摸点（一根手指或者一根触摸笔），包括位置、大小、形状、压力、目标元素等属性。有时，触摸动作由多个触摸点（多根手指）组成，多个触摸点的集合由<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>接口的实例对象表示。<code class="docutils literal notranslate"><span class="pre">TouchEvent</span></code>接口的实例对象代表由触摸引发的事件，只有触摸屏才会引发这一类事件。</p>
<p>很多时候，触摸事件和鼠标事件同时触发，即使这个时候并没有用到鼠标。这是为了让那些只定义鼠标事件、没有定义触摸事件的代码，在触摸屏的情况下仍然能用。如果想避免这种情况，可以用<code class="docutils literal notranslate"><span class="pre">event.preventDefault</span></code>方法阻止发出鼠标事件。</p>
</div>
<div class="section" id="touch">
<span id="touch"></span><h2>Touch 接口<a class="headerlink" href="#touch" title="永久链接至标题">¶</a></h2>
<div class="section" id="touch">
<span id="id15"></span><h3>Touch 接口概述<a class="headerlink" href="#touch" title="永久链接至标题">¶</a></h3>
<p>Touch 接口代表单个触摸点。触摸点可能是一根手指，也可能是一根触摸笔。</p>
<p>浏览器原生提供<code class="docutils literal notranslate"><span class="pre">Touch</span></code>构造函数，用来生成<code class="docutils literal notranslate"><span class="pre">Touch</span></code>实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">touch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Touch</span><span class="p">(</span><span class="nx">touchOptions</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Touch</span></code>构造函数接受一个配置对象作为参数，它有以下属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">identifier</span></code>：必需，类型为整数，表示触摸点的唯一 ID。</li>
<li><code class="docutils literal notranslate"><span class="pre">target</span></code>：必需，类型为元素节点，表示触摸点开始时所在的网页元素。</li>
<li><code class="docutils literal notranslate"><span class="pre">clientX</span></code>：可选，类型为数值，表示触摸点相对于浏览器窗口左上角的水平距离，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">clientY</span></code>：可选，类型为数值，表示触摸点相对于浏览器窗口左上角的垂直距离，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">screenX</span></code>：可选，类型为数值，表示触摸点相对于屏幕左上角的水平距离，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">screenY</span></code>：可选，类型为数值，表示触摸点相对于屏幕左上角的垂直距离，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">pageX</span></code>：可选，类型为数值，表示触摸点相对于网页左上角的水平位置（即包括页面的滚动距离），默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">pageY</span></code>：可选，类型为数值，表示触摸点相对于网页左上角的垂直位置（即包括页面的滚动距离），默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">radiusX</span></code>：可选，类型为数值，表示触摸点周围受到影响的椭圆范围的 X 轴半径，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">radiusY</span></code>：可选：类型为数值，表示触摸点周围受到影响的椭圆范围的 Y 轴半径，默认为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">rotationAngle</span></code>：可选，类型为数值，表示触摸区域的椭圆的旋转角度，单位为度数，在0到90度之间，默认值为0。</li>
<li><code class="docutils literal notranslate"><span class="pre">force</span></code>：可选，类型为数值，范围在<code class="docutils literal notranslate"><span class="pre">0</span></code>到<code class="docutils literal notranslate"><span class="pre">1</span></code>之间，表示触摸压力。<code class="docutils literal notranslate"><span class="pre">0</span></code>代表没有压力，<code class="docutils literal notranslate"><span class="pre">1</span></code>代表硬件所能识别的最大压力，默认为<code class="docutils literal notranslate"><span class="pre">0</span></code>。</li>
</ul>
</div>
<div class="section" id="touch">
<span id="id16"></span><h3>Touch 接口的实例属性<a class="headerlink" href="#touch" title="永久链接至标题">¶</a></h3>
<p><strong>（1）Touch.identifier</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.identifier</span></code>属性返回一个整数，表示触摸点的唯一 ID。这个值在整个触摸过程保持不变，直到触摸事件结束。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">someElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">identifier</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>（2）Touch.screenX，Touch.screenY，Touch.clientX，Touch.clientY，pageX，pageY</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.screenX</span></code>属性和<code class="docutils literal notranslate"><span class="pre">Touch.screenY</span></code>属性，分别表示触摸点相对于屏幕左上角的横坐标和纵坐标，与页面是否滚动无关。</p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.clientX</span></code>属性和<code class="docutils literal notranslate"><span class="pre">Touch.clientY</span></code>属性，分别表示触摸点相对于浏览器视口左上角的横坐标和纵坐标，与页面是否滚动无关。</p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.pageX</span></code>属性和<code class="docutils literal notranslate"><span class="pre">Touch.pageY</span></code>属性，分别表示触摸点相对于当前页面左上角的横坐标和纵坐标，包含了页面滚动带来的位移。</p>
<p><strong>（3）Touch.radiusX，Touch.radiusY，Touch.rotationAngle</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.radiusX</span></code>属性和<code class="docutils literal notranslate"><span class="pre">Touch.radiusY</span></code>属性，分别返回触摸点周围受到影响的椭圆范围的 X 轴半径和 Y 轴半径，单位为像素。乘以 2 就可以得到触摸范围的宽度和高度。</p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.rotationAngle</span></code>属性表示触摸区域的椭圆的旋转角度，单位为度数，在<code class="docutils literal notranslate"><span class="pre">0</span></code>到<code class="docutils literal notranslate"><span class="pre">90</span></code>度之间。</p>
<p>上面这三个属性共同定义了用户与屏幕接触的区域，对于描述手指这一类非精确的触摸，很有帮助。指尖接触屏幕，触摸范围会形成一个椭圆，这三个属性就用来描述这个椭圆区域。</p>
<p>下面是一个示例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="nx">rotate</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="nx">rotate</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="nx">rotate</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">rotate</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">touch</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

  <span class="nx">src</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">radiusX</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
  <span class="nx">src</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">radiusY</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
  <span class="nx">src</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s1">&#39;rotate(&#39;</span> <span class="o">+</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">rotationAngle</span> <span class="o">+</span> <span class="s1">&#39;deg)&#39;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><strong>（4）Touch.force</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.force</span></code>属性返回一个<code class="docutils literal notranslate"><span class="pre">0</span></code>到<code class="docutils literal notranslate"><span class="pre">1</span></code>之间的数值，表示触摸压力。<code class="docutils literal notranslate"><span class="pre">0</span></code>代表没有压力，<code class="docutils literal notranslate"><span class="pre">1</span></code>代表硬件所能识别的最大压力。</p>
<p><strong>（5）Touch.target</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Touch.target</span></code>属性返回一个元素节点，代表触摸发生时所在的那个元素节点。即使触摸点已经离开了这个节点，该属性依然不变。</p>
</div>
</div>
<div class="section" id="touchlist">
<span id="touchlist"></span><h2>TouchList 接口<a class="headerlink" href="#touchlist" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TouchList</span></code>接口表示一组触摸点的集合。它的实例是一个类似数组的对象，成员是<code class="docutils literal notranslate"><span class="pre">Touch</span></code>的实例对象，表示所有触摸点。用户用三根手指触摸，产生的<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例就会包含三个成员，每根手指的触摸点对应一个<code class="docutils literal notranslate"><span class="pre">Touch</span></code>实例对象。</p>
<p>它的实例主要通过触摸事件的<code class="docutils literal notranslate"><span class="pre">TouchEvent.touches</span></code>、<code class="docutils literal notranslate"><span class="pre">TouchEvent.changedTouches</span></code>、<code class="docutils literal notranslate"><span class="pre">TouchEvent.targetTouches</span></code>这几个属性获取。</p>
<p>它的实例属性和实例方法只有两个。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">TouchList.length</span></code>：数值，表示成员数量（即触摸点的数量）。</li>
<li><code class="docutils literal notranslate"><span class="pre">TouchList.item()</span></code>：返回指定位置的成员，它的参数是该成员的位置编号（从零开始）。</li>
</ul>
</div>
<div class="section" id="touchevent">
<span id="touchevent"></span><h2>TouchEvent 接口<a class="headerlink" href="#touchevent" title="永久链接至标题">¶</a></h2>
<div class="section" id="">
<span id="id17"></span><h3>概述<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>TouchEvent 接口继承了 Event 接口，表示由触摸引发的事件实例，通常来自触摸屏或轨迹板。除了被继承的属性以外，它还有一些自己的属性。</p>
<p>浏览器原生提供<code class="docutils literal notranslate"><span class="pre">TouchEvent()</span></code>构造函数，用来生成触摸事件的实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">TouchEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TouchEvent()</span></code>构造函数可以接受两个参数，第一个参数是字符串，表示事件类型；第二个参数是事件的配置对象，该参数是可选的，对象的所有属性也是可选的。除了<code class="docutils literal notranslate"><span class="pre">Event</span></code>接口的配置属性，该接口还有一些自己的配置属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">touches</span></code>：<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，代表所有的当前处于活跃状态的触摸点，默认值是一个空数组<code class="docutils literal notranslate"><span class="pre">[]</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">targetTouches</span></code>：<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，代表所有处在触摸的目标元素节点内部、且仍然处于活动状态的触摸点，默认值是一个空数组<code class="docutils literal notranslate"><span class="pre">[]</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">changedTouches</span></code>：<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，代表本次触摸事件的相关触摸点，默认值是一个空数组<code class="docutils literal notranslate"><span class="pre">[]</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">ctrlKey</span></code>：布尔值，表示 Ctrl 键是否同时按下，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">shiftKey</span></code>：布尔值，表示 Shift 键是否同时按下，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">altKey</span></code>：布尔值，表示 Alt 键是否同时按下，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">metaKey</span></code>：布尔值，表示 Meta 键（或 Windows 键）是否同时按下，默认值为<code class="docutils literal notranslate"><span class="pre">false</span></code>。</li>
</ul>
</div>
<div class="section" id="">
<span id="id18"></span><h3>实例属性<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>TouchEvent 接口的实例具有<code class="docutils literal notranslate"><span class="pre">Event</span></code>实例的所有属性和方法，此外还有一些它自己的实例属性，这些属性全部都是只读。</p>
<p><strong>（1）TouchEvent.altKey，TouchEvent.ctrlKey，TouchEvent.shiftKey，TouchEvent.metaKey</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">TouchEvent.altKey</span></code>：布尔值，表示触摸时是否按下了 Alt 键。</li>
<li><code class="docutils literal notranslate"><span class="pre">TouchEvent.ctrlKey</span></code>：布尔值，表示触摸时是否按下了 Ctrl 键。</li>
<li><code class="docutils literal notranslate"><span class="pre">TouchEvent.shiftKey</span></code>：布尔值：表示触摸时是否按下了 Shift 键。</li>
<li><code class="docutils literal notranslate"><span class="pre">TouchEvent.metaKey</span></code>：布尔值，表示触摸时是否按下了 Meta 键（或 Windows 键）。</li>
</ul>
<p>下面是一个示例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">someElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;altKey = &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ctrlKey = &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;metaKey = &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;shiftKey = &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>（2）TouchEvent.changedTouches</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">TouchEvent.changedTouches</span></code>属性返回一个<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，成员是一组<code class="docutils literal notranslate"><span class="pre">Touch</span></code>实例对象，表示本次触摸事件的相关触摸点。</p>
<p>对于不同的时间，该属性的含义有所不同。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">touchstart</span></code>事件：被激活的触摸点</li>
<li><code class="docutils literal notranslate"><span class="pre">touchmove</span></code>事件：发生变化的触摸点</li>
<li><code class="docutils literal notranslate"><span class="pre">touchend</span></code>事件：消失的触摸点（即不再被触碰的点）</li>
</ul>
<p>下面是一个示例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">someElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">identifier</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>（3）TouchEvent.touches</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">TouchEvent.touches</span></code>属性返回一个<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，成员是所有仍然处于活动状态（即触摸中）的触摸点。一般来说，一个手指就是一个触摸点。</p>
<p>下面是一个示例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">someElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 一根手指触摸</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="nx">handle_one_touch</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// 两根手指触摸</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="nx">handle_two_touches</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// 三根手指触摸</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="nx">handle_three_touches</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// 其他情况</span>
    <span class="k">default</span><span class="o">:</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Not supported&#39;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>（4）TouchEvent.targetTouches</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">TouchEvent.targetTouches</span></code>属性返回一个<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，成员是触摸事件的目标元素节点内部、所有仍然处于活动状态（即触摸中）的触摸点。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">touches_in_target</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码用来判断，是否所有触摸点都在目标元素内。</p>
</div>
</div>
<div class="section" id="">
<span id="id19"></span><h2>触摸事件的种类<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>触摸引发的事件，有以下几种。可以通过<code class="docutils literal notranslate"><span class="pre">TouchEvent.type</span></code>属性，查看到底发生的是哪一种事件。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">touchstart</span></code>：用户开始触摸时触发，它的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性返回发生触摸的元素节点。</li>
<li><code class="docutils literal notranslate"><span class="pre">touchend</span></code>：用户不再接触触摸屏时（或者移出屏幕边缘时）触发，它的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性与<code class="docutils literal notranslate"><span class="pre">touchstart</span></code>事件一致的，就是开始触摸时所在的元素节点。它的<code class="docutils literal notranslate"><span class="pre">changedTouches</span></code>属性返回一个<code class="docutils literal notranslate"><span class="pre">TouchList</span></code>实例，包含所有不再触摸的触摸点（即<code class="docutils literal notranslate"><span class="pre">Touch</span></code>实例对象）。</li>
<li><code class="docutils literal notranslate"><span class="pre">touchmove</span></code>：用户移动触摸点时触发，它的<code class="docutils literal notranslate"><span class="pre">target</span></code>属性与<code class="docutils literal notranslate"><span class="pre">touchstart</span></code>事件一致。如果触摸的半径、角度、力度发生变化，也会触发该事件。</li>
<li><code class="docutils literal notranslate"><span class="pre">touchcancel</span></code>：触摸点取消时触发，比如在触摸区域跳出一个情态窗口（modal window）、触摸点离开了文档区域（进入浏览器菜单栏）、用户的触摸点太多，超过了支持的上限（自动取消早先的触摸点）。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="nx">handleStart</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="nx">handleMove</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">handleStart</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">touches</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">touches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">touches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pageY</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">handleMove</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">touches</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">touch</span> <span class="o">=</span> <span class="nx">touches</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">touch</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id20"></span><h2>表单事件的种类<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="input">
<span id="input"></span><h3>input 事件<a class="headerlink" href="#input" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>事件当<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;textarea&gt;</span></code>的值发生变化时触发。对于复选框（<code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=checkbox&gt;</span></code>）或单选框（<code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=radio&gt;</span></code>），用户改变选项时，也会触发这个事件。另外，对于打开<code class="docutils literal notranslate"><span class="pre">contenteditable</span></code>属性的元素，只要值发生变化，也会触发<code class="docutils literal notranslate"><span class="pre">input</span></code>事件。</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>事件的一个特点，就是会连续触发，比如用户每按下一次按键，就会触发一次<code class="docutils literal notranslate"><span class="pre">input</span></code>事件。</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>事件对象继承了<code class="docutils literal notranslate"><span class="pre">InputEvent</span></code>接口。</p>
</div>
<div class="section" id="select">
<span id="select"></span><h3>select 事件<a class="headerlink" href="#select" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code>事件当在<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;textarea&gt;</span></code>里面选中文本时触发。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;input id=&quot;test&quot; type=&quot;text&quot; value=&quot;Select me!&quot; /&gt;</span>

<span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span> <span class="c1">// &quot;select&quot;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>选中的文本可以通过<code class="docutils literal notranslate"><span class="pre">event.target</span></code>元素的<code class="docutils literal notranslate"><span class="pre">selectionDirection</span></code>、<code class="docutils literal notranslate"><span class="pre">selectionEnd</span></code>、<code class="docutils literal notranslate"><span class="pre">selectionStart</span></code>和<code class="docutils literal notranslate"><span class="pre">value</span></code>属性拿到。</p>
</div>
<div class="section" id="change">
<span id="change"></span><h3>Change 事件<a class="headerlink" href="#change" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Change</span></code>事件当<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;textarea&gt;</span></code>的值发生变化时触发。它与<code class="docutils literal notranslate"><span class="pre">input</span></code>事件的最大不同，就是不会连续触发，只有当全部修改完成时才会触发，另一方面<code class="docutils literal notranslate"><span class="pre">input</span></code>事件必然伴随<code class="docutils literal notranslate"><span class="pre">change</span></code>事件。具体来说，分成以下几种情况。</p>
<ul class="simple">
<li>激活单选框（radio）或复选框（checkbox）时触发。</li>
<li>用户提交时触发。比如，从下列列表（select）完成选择，在日期或文件输入框完成选择。</li>
<li>当文本框或<code class="docutils literal notranslate"><span class="pre">&lt;textarea&gt;</span></code>元素的值发生改变，并且丧失焦点时触发。</li>
</ul>
<p>下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;select size=&quot;1&quot; onchange=&quot;changeEventHandler(event);&quot;&gt;</span>
<span class="c1">//   &lt;option&gt;chocolate&lt;/option&gt;</span>
<span class="c1">//   &lt;option&gt;strawberry&lt;/option&gt;</span>
<span class="c1">//   &lt;option&gt;vanilla&lt;/option&gt;</span>
<span class="c1">// &lt;/select&gt;</span>

<span class="kd">function</span> <span class="nx">changeEventHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="invalid">
<span id="invalid"></span><h3>invalid 事件<a class="headerlink" href="#invalid" title="永久链接至标题">¶</a></h3>
<p>用户提交表单时，如果表单元素的值不满足校验条件，就会触发<code class="docutils literal notranslate"><span class="pre">invalid</span></code>事件。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">required</span> <span class="na">oninvalid</span><span class="o">=</span><span class="s">&quot;console.log(&#39;invalid input&#39;)&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，输入框是必填的。如果不填，用户点击按钮提交时，就会触发输入框的<code class="docutils literal notranslate"><span class="pre">invalid</span></code>事件，导致提交被取消。</p>
</div>
<div class="section" id="reset-submit">
<span id="reset-submit"></span><h3>reset 事件，submit 事件<a class="headerlink" href="#reset-submit" title="永久链接至标题">¶</a></h3>
<p>这两个事件发生在表单对象<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>上，而不是发生在表单的成员上。</p>
<p><code class="docutils literal notranslate"><span class="pre">reset</span></code>事件当表单重置（所有表单成员变回默认值）时触发。</p>
<p><code class="docutils literal notranslate"><span class="pre">submit</span></code>事件当表单数据向服务器提交时触发。注意，<code class="docutils literal notranslate"><span class="pre">submit</span></code>事件的发生对象是<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>元素，而不是<code class="docutils literal notranslate"><span class="pre">&lt;button&gt;</span></code>元素，因为提交的是表单，而不是按钮。</p>
</div>
</div>
<div class="section" id="">
<span id="id21"></span><h2>资源事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="beforeunload">
<span id="beforeunload"></span><h3>beforeunload 事件<a class="headerlink" href="#beforeunload" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">beforeunload</span></code>事件在窗口、文档、各种资源将要卸载前触发。它可以用来防止用户不小心卸载资源。</p>
<p>如果该事件对象的<code class="docutils literal notranslate"><span class="pre">returnValue</span></code>属性是一个非空字符串，那么浏览器就会弹出一个对话框，询问用户是否要卸载该资源。但是，用户指定的字符串可能无法显示，浏览器会展示预定义的字符串。如果用户点击“取消”按钮，资源就不会卸载。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;beforeunload&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="s1">&#39;你确定离开吗？&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，用户如果关闭窗口，浏览器会弹出一个窗口，要求用户确认。</p>
<p>浏览器对这个事件的行为很不一致，有的浏览器调用<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code>，也会弹出对话框。IE 浏览器需要显式返回一个非空的字符串，才会弹出对话框。而且，大多数浏览器在对话框中不显示指定文本，只显示默认文本。因此，可以采用下面的写法，取得最大的兼容性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;beforeunload&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">confirmationMessage</span> <span class="o">=</span> <span class="s1">&#39;确认关闭窗口？&#39;</span><span class="p">;</span>

  <span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">confirmationMessage</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">confirmationMessage</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>注意，许多手机浏览器默认忽略这个事件，桌面浏览器也有方法忽略这个事件。所以，它可能根本不会生效，不能依赖它来阻止用户关闭窗口。</p>
</div>
<div class="section" id="unload">
<span id="unload"></span><h3>unload 事件<a class="headerlink" href="#unload" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">unload</span></code>事件在窗口关闭或者<code class="docutils literal notranslate"><span class="pre">document</span></code>对象将要卸载时触发。它的触发顺序排在<code class="docutils literal notranslate"><span class="pre">beforeunload</span></code>、<code class="docutils literal notranslate"><span class="pre">pagehide</span></code>事件后面。<code class="docutils literal notranslate"><span class="pre">unload</span></code>事件只在页面没有被浏览器缓存时才会触发，换言之，如果通过按下“前进/后退”导致页面卸载，并不会触发<code class="docutils literal notranslate"><span class="pre">unload</span></code>事件。</p>
<p><code class="docutils literal notranslate"><span class="pre">unload</span></code>事件发生时，文档处于一个特殊状态。所有资源依然存在，但是对用户来说都不可见，UI 互动全部无效。这个事件是无法取消的，即使在监听函数里面抛出错误，也不能停止文档的卸载。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;unload&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;文档将要卸载&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="load">
<span id="load"></span><h3>load 事件<a class="headerlink" href="#load" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">load</span></code>事件在页面或某个资源加载成功时触发。注意，页面或资源从浏览器缓存加载，并不会触发<code class="docutils literal notranslate"><span class="pre">load</span></code>事件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;所有资源都加载完成&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">error</span></code>事件是在页面或资源加载失败时触发。<code class="docutils literal notranslate"><span class="pre">abort</span></code>事件在用户取消加载时触发。</p>
<p>这三个事件实际上属于进度事件，不仅发生在<code class="docutils literal notranslate"><span class="pre">document</span></code>对象，还发生在各种外部资源上面。浏览网页就是一个加载各种资源的过程，图像（image）、样式表（style sheet）、脚本（script）、视频（video）、音频（audio）、Ajax请求（XMLHttpRequest）等等。这些资源和<code class="docutils literal notranslate"><span class="pre">document</span></code>对象、<code class="docutils literal notranslate"><span class="pre">window</span></code>对象、XMLHttpRequestUpload 对象，都会触发<code class="docutils literal notranslate"><span class="pre">load</span></code>事件和<code class="docutils literal notranslate"><span class="pre">error</span></code>事件。</p>
</div>
</div>
<div class="section" id="session">
<span id="session"></span><h2>session 历史事件<a class="headerlink" href="#session" title="永久链接至标题">¶</a></h2>
<div class="section" id="pageshow-pagehide">
<span id="pageshow-pagehide"></span><h3>pageshow 事件，pagehide 事件<a class="headerlink" href="#pageshow-pagehide" title="永久链接至标题">¶</a></h3>
<p>默认情况下，浏览器会在当前会话（session）缓存页面，当用户点击“前进/后退”按钮时，浏览器就会从缓存中加载页面。</p>
<p>pageshow 事件在页面加载时触发，包括第一次加载和从缓存加载两种情况。如果要指定页面每次加载（不管是不是从浏览器缓存）时都运行的代码，可以放在这个事件的监听函数。</p>
<p>第一次加载时，它的触发顺序排在<code class="docutils literal notranslate"><span class="pre">load</span></code>事件后面。从缓存加载时，<code class="docutils literal notranslate"><span class="pre">load</span></code>事件不会触发，因为网页在缓存中的样子通常是<code class="docutils literal notranslate"><span class="pre">load</span></code>事件的监听函数运行后的样子，所以不必重复执行。同理，如果是从缓存中加载页面，网页内初始化的 JavaScript 脚本（比如 DOMContentLoaded 事件的监听函数）也不会执行。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;pageshow&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;pageshow: &#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>pageshow 事件有一个<code class="docutils literal notranslate"><span class="pre">persisted</span></code>属性，返回一个布尔值。页面第一次加载时，这个属性是<code class="docutils literal notranslate"><span class="pre">false</span></code>；当页面从缓存加载时，这个属性是<code class="docutils literal notranslate"><span class="pre">true</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;pageshow&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">persisted</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pagehide</span></code>事件与<code class="docutils literal notranslate"><span class="pre">pageshow</span></code>事件类似，当用户通过“前进/后退”按钮，离开当前页面时触发。它与 unload 事件的区别在于，如果在 window 对象上定义<code class="docutils literal notranslate"><span class="pre">unload</span></code>事件的监听函数之后，页面不会保存在缓存中，而使用<code class="docutils literal notranslate"><span class="pre">pagehide</span></code>事件，页面会保存在缓存中。</p>
<p><code class="docutils literal notranslate"><span class="pre">pagehide</span></code>事件实例也有一个<code class="docutils literal notranslate"><span class="pre">persisted</span></code>属性，将这个属性设为<code class="docutils literal notranslate"><span class="pre">true</span></code>，就表示页面要保存在缓存中；设为<code class="docutils literal notranslate"><span class="pre">false</span></code>，表示网页不保存在缓存中，这时如果设置了unload 事件的监听函数，该函数将在 pagehide 事件后立即运行。</p>
<p>如果页面包含<code class="docutils literal notranslate"><span class="pre">&lt;frame&gt;</span></code>或<code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>元素，则<code class="docutils literal notranslate"><span class="pre">&lt;frame&gt;</span></code>页面的<code class="docutils literal notranslate"><span class="pre">pageshow</span></code>事件和<code class="docutils literal notranslate"><span class="pre">pagehide</span></code>事件，都会在主页面之前触发。</p>
</div>
<div class="section" id="popstate">
<span id="popstate"></span><h3>popstate 事件<a class="headerlink" href="#popstate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件在浏览器的<code class="docutils literal notranslate"><span class="pre">history</span></code>对象的当前记录发生显式切换时触发。注意，调用<code class="docutils literal notranslate"><span class="pre">history.pushState()</span></code>或<code class="docutils literal notranslate"><span class="pre">history.replaceState()</span></code>，并不会触发<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件。该事件只在用户在<code class="docutils literal notranslate"><span class="pre">history</span></code>记录之间显式切换时触发，比如鼠标点击“后退/前进”按钮，或者在脚本中调用<code class="docutils literal notranslate"><span class="pre">history.back()</span></code>、<code class="docutils literal notranslate"><span class="pre">history.forward()</span></code>、<code class="docutils literal notranslate"><span class="pre">history.go()</span></code>时触发。</p>
<p>该事件对象有一个<code class="docutils literal notranslate"><span class="pre">state</span></code>属性，保存<code class="docutils literal notranslate"><span class="pre">history.pushState</span></code>方法和<code class="docutils literal notranslate"><span class="pre">history.replaceState</span></code>方法为当前记录添加的<code class="docutils literal notranslate"><span class="pre">state</span></code>对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onpopstate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;state: &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s1">&#39;title 1&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=1&#39;</span><span class="p">);</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">2</span><span class="p">},</span> <span class="s1">&#39;title 2&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=2&#39;</span><span class="p">);</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">3</span><span class="p">},</span> <span class="s1">&#39;title 3&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=3&#39;</span><span class="p">);</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span> <span class="c1">// state: {&quot;page&quot;:1}</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span> <span class="c1">// state: null</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// state: {&quot;page&quot;:3}</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">pushState</span></code>方法向<code class="docutils literal notranslate"><span class="pre">history</span></code>添加了两条记录，然后<code class="docutils literal notranslate"><span class="pre">replaceState</span></code>方法替换掉当前记录。因此，连续两次<code class="docutils literal notranslate"><span class="pre">back</span></code>方法，会让当前条目退回到原始网址，它没有附带<code class="docutils literal notranslate"><span class="pre">state</span></code>对象，所以事件的<code class="docutils literal notranslate"><span class="pre">state</span></code>属性为<code class="docutils literal notranslate"><span class="pre">null</span></code>，然后前进两条记录，又回到<code class="docutils literal notranslate"><span class="pre">replaceState</span></code>方法添加的记录。</p>
<p>浏览器对于页面首次加载，是否触发<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件，处理不一样，Firefox 不触发该事件。</p>
</div>
<div class="section" id="hashchange">
<span id="hashchange"></span><h3>hashchange 事件<a class="headerlink" href="#hashchange" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">hashchange</span></code>事件在 URL 的 hash 部分（即<code class="docutils literal notranslate"><span class="pre">#</span></code>号后面的部分，包括<code class="docutils literal notranslate"><span class="pre">#</span></code>号）发生变化时触发。该事件一般在<code class="docutils literal notranslate"><span class="pre">window</span></code>对象上监听。</p>
<p><code class="docutils literal notranslate"><span class="pre">hashchange</span></code>的事件实例具有两个特有属性：<code class="docutils literal notranslate"><span class="pre">oldURL</span></code>属性和<code class="docutils literal notranslate"><span class="pre">newURL</span></code>属性，分别表示变化前后的完整 URL。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// URL 是 http://www.example.com/</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="nx">myFunction</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">myFunction</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">oldURL</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">newURL</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;part2&#39;</span><span class="p">;</span>
<span class="c1">// http://www.example.com/</span>
<span class="c1">// http://www.example.com/#part2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id22"></span><h2>网页状态事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="domcontentloaded">
<span id="domcontentloaded"></span><h3>DOMContentLoaded 事件<a class="headerlink" href="#domcontentloaded" title="永久链接至标题">¶</a></h3>
<p>网页下载并解析完成以后，浏览器就会在<code class="docutils literal notranslate"><span class="pre">document</span></code>对象上触发 DOMContentLoaded 事件。这时，仅仅完成了网页的解析（整张页面的 DOM 生成了），所有外部资源（样式表、脚本、iframe 等等）可能还没有下载结束。也就是说，这个事件比<code class="docutils literal notranslate"><span class="pre">load</span></code>事件，发生时间早得多。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DOM生成&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>注意，网页的 JavaScript 脚本是同步执行的，脚本一旦发生堵塞，将推迟触发<code class="docutils literal notranslate"><span class="pre">DOMContentLoaded</span></code>事件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DOM 生成&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 这段代码会推迟触发 DOMContentLoaded 事件</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="readystatechange">
<span id="readystatechange"></span><h3>readystatechange 事件<a class="headerlink" href="#readystatechange" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readystatechange</span></code>事件当 Document 对象和 XMLHttpRequest 对象的<code class="docutils literal notranslate"><span class="pre">readyState</span></code>属性发生变化时触发。<code class="docutils literal notranslate"><span class="pre">document.readyState</span></code>有三个可能的值：<code class="docutils literal notranslate"><span class="pre">loading</span></code>（网页正在加载）、<code class="docutils literal notranslate"><span class="pre">interactive</span></code>（网页已经解析完成，但是外部资源仍然处在加载状态）和<code class="docutils literal notranslate"><span class="pre">complete</span></code>（网页和所有外部资源已经结束加载，<code class="docutils literal notranslate"><span class="pre">load</span></code>事件即将触发）。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s1">&#39;interactive&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这个事件可以看作<code class="docutils literal notranslate"><span class="pre">DOMContentLoaded</span></code>事件的另一种实现方法。</p>
</div>
</div>
<div class="section" id="">
<span id="id23"></span><h2>窗口事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="scroll">
<span id="scroll"></span><h3>scroll 事件<a class="headerlink" href="#scroll" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件在文档或文档元素滚动时触发，主要出现在用户拖动滚动条。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</pre></div>
</div>
<p>该事件会连续地大量触发，所以它的监听函数之中不应该有非常耗费计算的操作。推荐的做法是使用<code class="docutils literal notranslate"><span class="pre">requestAnimationFrame</span></code>或<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>控制该事件的触发频率，然后可以结合<code class="docutils literal notranslate"><span class="pre">customEvent</span></code>抛出一个新事件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">throttle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
      <span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="nx">name</span><span class="p">));</span>
        <span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="c1">// 将 scroll 事件重定义为 optimizedScroll 事件</span>
  <span class="nx">throttle</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;optimizedScroll&#39;</span><span class="p">);</span>
<span class="p">})();</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;optimizedScroll&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Resource conscious scroll callback!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">throttle</span></code>函数用于控制事件触发频率，<code class="docutils literal notranslate"><span class="pre">requestAnimationFrame</span></code>方法保证每次页面重绘（每秒60次），只会触发一次<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件的监听函数。也就是说，上面方法将<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件的触发频率，限制在每秒60次。具体来说，就是<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件只要频率低于每秒60次，就会触发<code class="docutils literal notranslate"><span class="pre">optimizedScroll</span></code>事件，从而执行<code class="docutils literal notranslate"><span class="pre">optimizedScroll</span></code>事件的监听函数。</p>
<p>改用<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>方法，可以放置更大的时间间隔。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">scrollThrottler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">scrollTimeout</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">scrollThrottler</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scrollTimeout</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">scrollTimeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">scrollTimeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">actualScrollHandler</span><span class="p">();</span>
      <span class="p">},</span> <span class="mi">66</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">actualScrollHandler</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}());</span>
</pre></div>
</div>
<p>上面代码中，每次<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件都会执行<code class="docutils literal notranslate"><span class="pre">scrollThrottler</span></code>函数。该函数里面有一个定时器<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>，每66毫秒触发一次（每秒15次）真正执行的任务<code class="docutils literal notranslate"><span class="pre">actualScrollHandler</span></code>。</p>
<p>下面是一个更一般的<code class="docutils literal notranslate"><span class="pre">throttle</span></code>函数的写法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">time</span> <span class="o">+</span> <span class="nx">wait</span> <span class="o">-</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span><span class="p">();</span>
      <span class="nx">time</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
</pre></div>
</div>
<p>上面的代码将<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件的触发频率，限制在一秒一次。</p>
<p><code class="docutils literal notranslate"><span class="pre">lodash</span></code>函数库提供了现成的<code class="docutils literal notranslate"><span class="pre">throttle</span></code>函数，可以直接使用。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">throttle</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="resize">
<span id="resize"></span><h3>resize 事件<a class="headerlink" href="#resize" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">resize</span></code>事件在改变浏览器窗口大小时触发，主要发生在<code class="docutils literal notranslate"><span class="pre">window</span></code>对象上面。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">resizeMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">&lt;</span> <span class="mi">768</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;移动设备的视口&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="nx">resizeMethod</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>该事件也会连续地大量触发，所以最好像上面的<code class="docutils literal notranslate"><span class="pre">scroll</span></code>事件一样，通过<code class="docutils literal notranslate"><span class="pre">throttle</span></code>函数控制事件触发频率。</p>
</div>
<div class="section" id="fullscreenchange-fullscreenerror">
<span id="fullscreenchange-fullscreenerror"></span><h3>fullscreenchange 事件，fullscreenerror 事件<a class="headerlink" href="#fullscreenchange-fullscreenerror" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">fullscreenchange</span></code>事件在进入或推出全屏状态时触发，该事件发生在<code class="docutils literal notranslate"><span class="pre">document</span></code>对象上面。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;fullscreenchange&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fullscreenerror</span></code>事件在浏览器无法切换到全屏状态时触发。</p>
</div>
</div>
<div class="section" id="">
<span id="id24"></span><h2>剪贴板事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>以下三个事件属于剪贴板操作的相关事件。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cut</span></code>：将选中的内容从文档中移除，加入剪贴板时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">copy</span></code>：进行复制动作时触发。</li>
<li><code class="docutils literal notranslate"><span class="pre">paste</span></code>：剪贴板内容粘贴到文档后触发。</li>
</ul>
<p>这三个事件都是<code class="docutils literal notranslate"><span class="pre">ClipboardEvent</span></code>接口的实例。<code class="docutils literal notranslate"><span class="pre">ClipboardEvent</span></code>有一个实例属性<code class="docutils literal notranslate"><span class="pre">clipboardData</span></code>，是一个 DataTransfer 对象，存放剪贴的数据。具体的 API 接口和操作方法，请参见《触摸事件》的 DataTransfer 对象部分。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello, world!&#39;</span><span class="p">);</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;b&gt;Hello, world!&lt;/b&gt;&#39;</span><span class="p">);</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上面的代码使得复制进入剪贴板的，都是开发者指定的数据，而不是用户想要拷贝的数据。</p>
</div>
<div class="section" id="">
<span id="id25"></span><h2>焦点事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>焦点事件发生在元素节点和<code class="docutils literal notranslate"><span class="pre">document</span></code>对象上面，与获得或失去焦点相关。它主要包括以下四个事件。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">focus</span></code>：元素节点获得焦点后触发，该事件不会冒泡。</li>
<li><code class="docutils literal notranslate"><span class="pre">blur</span></code>：元素节点失去焦点后触发，该事件不会冒泡。</li>
<li><code class="docutils literal notranslate"><span class="pre">focusin</span></code>：元素节点将要获得焦点时触发，发生在<code class="docutils literal notranslate"><span class="pre">focus</span></code>事件之前。该事件会冒泡。</li>
<li><code class="docutils literal notranslate"><span class="pre">focusout</span></code>：元素节点将要失去焦点时触发，发生在<code class="docutils literal notranslate"><span class="pre">blur</span></code>事件之前。该事件会冒泡。</li>
</ul>
<p>这四个事件都继承了<code class="docutils literal notranslate"><span class="pre">FocusEvent</span></code>接口。<code class="docutils literal notranslate"><span class="pre">FocusEvent</span></code>实例具有以下属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">FocusEvent.target</span></code>：事件的目标节点。</li>
<li><code class="docutils literal notranslate"><span class="pre">FocusEvent.relatedTarget</span></code>：对于<code class="docutils literal notranslate"><span class="pre">focusin</span></code>事件，返回失去焦点的节点；对于<code class="docutils literal notranslate"><span class="pre">focusout</span></code>事件，返回将要接受焦点的节点；对于<code class="docutils literal notranslate"><span class="pre">focus</span></code>和<code class="docutils literal notranslate"><span class="pre">blur</span></code>事件，返回<code class="docutils literal notranslate"><span class="pre">null</span></code>。</li>
</ul>
<p>由于<code class="docutils literal notranslate"><span class="pre">focus</span></code>和<code class="docutils literal notranslate"><span class="pre">blur</span></code>事件不会冒泡，只能在捕获阶段触发，所以<code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>方法的第三个参数需要设为<code class="docutils literal notranslate"><span class="pre">true</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码针对表单的文本输入框，接受焦点时设置背景色，失去焦点时去除背景色。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="css.html" class="btn btn-neutral float-right" title="CSS操作" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="event.html" class="btn btn-neutral" title="事件模型" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>