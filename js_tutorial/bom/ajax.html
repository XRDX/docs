

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AJAX &mdash; JS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="CORS通信" href="cors.html" />
    <link rel="prev" title="同源政策" href="same-origin.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html">stdlib 标准库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oop/index.html">面向对象编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">语法专题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM 模型</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">BOM 浏览器环境</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="engine.html">浏览器环境概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="window.html">window对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">History 对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookie.html">Cookie</a></li>
<li class="toctree-l2"><a class="reference internal" href="webstorage.html">浏览器端数据储存机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="same-origin.html">同源政策</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">AJAX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xmlhttprequest">XMLHttpRequest对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xmlhttprequest">XMLHttpRequest实例的属性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#readystate">readyState</a></li>
<li class="toctree-l4"><a class="reference internal" href="#onreadystatechange">onreadystatechange</a></li>
<li class="toctree-l4"><a class="reference internal" href="#response">response</a></li>
<li class="toctree-l4"><a class="reference internal" href="#responsetype">responseType</a></li>
<li class="toctree-l4"><a class="reference internal" href="#responsetext">responseText</a></li>
<li class="toctree-l4"><a class="reference internal" href="#responsexml">responseXML</a></li>
<li class="toctree-l4"><a class="reference internal" href="#status">status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statustext">statusText</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeout">timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">事件监听接口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#withcredentials">withCredentials</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xmlhttprequest">XMLHttpRequest实例的方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#abort">abort()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getallresponseheaders">getAllResponseHeaders()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getresponseheader">getResponseHeader()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#open">open()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send">send()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setrequestheader">setRequestHeader()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overridemimetype">overrideMimeType()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xmlhttprequest">XMLHttpRequest实例的事件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#readystatechange">readyStateChange事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#progress">progress事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loaderrorabort">load事件、error事件、abort事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loadend">loadend事件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">文件上传</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">参考链接</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cors.html">CORS通信</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexeddb.html">IndexedDB：浏览器端数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="notification.html">Web Notifications API</a></li>
<li class="toctree-l2"><a class="reference internal" href="mobile.html">移动设备API</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">BOM 浏览器环境</a> &raquo;</li>
        
      <li>AJAX</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ajax">
<span id="ajax"></span><h1>AJAX<a class="headerlink" href="#ajax" title="永久链接至标题">¶</a></h1>
<p>浏览器与服务器之间，采用HTTP协议通信。用户在浏览器地址栏键入一个网址，或者通过网页表单向服务器提交内容，这时浏览器就会向服务器发出HTTP请求。</p>
<p>1999年，微软公司发布IE浏览器5.0版，第一次引入新功能：允许JavaScript脚本向服务器发起HTTP请求。这个功能当时并没有引起注意，直到2004年Gmail发布和2005年Google Map发布，才引起广泛重视。2005年2月，AJAX这个词第一次正式提出，指围绕这个功能进行开发的一整套做法。从此，AJAX成为脚本发起HTTP通信的代名词，W3C也在2006年发布了它的国际标准。</p>
<p>具体来说，AJAX包括以下几个步骤。</p>
<ol class="simple">
<li>创建AJAX对象</li>
<li>发出HTTP请求</li>
<li>接收服务器传回的数据</li>
<li>更新网页数据</li>
</ol>
<p>概括起来，就是一句话，AJAX通过原生的<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>对象发出HTTP请求，得到服务器返回的数据后，再进行处理。</p>
<p>AJAX可以是同步请求，也可以是异步请求。但是，大多数情况下，特指异步请求。因为同步的Ajax请求，对浏览器有“堵塞效应”。</p>
<div class="section" id="xmlhttprequest">
<span id="xmlhttprequest"></span><h2>XMLHttpRequest对象<a class="headerlink" href="#xmlhttprequest" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>对象用来在浏览器与服务器之间传送数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com/page.php&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码向指定的服务器网址，发出GET请求。</p>
<p>然后，AJAX指定回调函数，监听通信状态（<code class="docutils literal notranslate"><span class="pre">readyState</span></code>属性）的变化。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ajax</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">handleStateChange</span><span class="p">;</span>
</pre></div>
</div>
<p>一旦拿到服务器返回的数据，AJAX不会刷新整个网页，而是只更新相关部分，从而不打断用户正在做的事情。</p>
<p>注意，AJAX只能向同源网址（协议、域名、端口都相同）发出HTTP请求，如果发出跨源请求，就会报错（详见《同源政策》和《CORS机制》两节）。</p>
<p>虽然名字里面有<code class="docutils literal notranslate"><span class="pre">XML</span></code>，但是实际上，XMLHttpRequest可以报送各种数据，包括字符串和二进制，而且除了HTTP，它还支持通过其他协议传送（比如File和FTP）。</p>
<p>下面是<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>对象的典型用法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="c1">// 指定通信过程中状态改变时的回调函数</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="c1">// 通信成功时，状态值为4</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// open方式用于指定HTTP动词、请求的网址、是否异步</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/endpoint&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// 发送HTTP请求</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">open</span></code>方法的第三个参数是一个布尔值，表示是否为异步请求。如果设为<code class="docutils literal notranslate"><span class="pre">false</span></code>，就表示这个请求是同步的，下面是一个例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/bar/foo.txt&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="xmlhttprequest">
<span id="id1"></span><h2>XMLHttpRequest实例的属性<a class="headerlink" href="#xmlhttprequest" title="永久链接至标题">¶</a></h2>
<div class="section" id="readystate">
<span id="readystate"></span><h3>readyState<a class="headerlink" href="#readystate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readyState</span></code>是一个只读属性，用一个整数和对应的常量，表示XMLHttpRequest请求当前所处的状态。</p>
<ul class="simple">
<li>0，对应常量<code class="docutils literal notranslate"><span class="pre">UNSENT</span></code>，表示XMLHttpRequest实例已经生成，但是<code class="docutils literal notranslate"><span class="pre">open()</span></code>方法还没有被调用。</li>
<li>1，对应常量<code class="docutils literal notranslate"><span class="pre">OPENED</span></code>，表示<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法还没有被调用，仍然可以使用<code class="docutils literal notranslate"><span class="pre">setRequestHeader()</span></code>，设定HTTP请求的头信息。</li>
<li>2，对应常量<code class="docutils literal notranslate"><span class="pre">HEADERS_RECEIVED</span></code>，表示<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法已经执行，并且头信息和状态码已经收到。</li>
<li>3，对应常量<code class="docutils literal notranslate"><span class="pre">LOADING</span></code>，表示正在接收服务器传来的body部分的数据，如果<code class="docutils literal notranslate"><span class="pre">responseType</span></code>属性是<code class="docutils literal notranslate"><span class="pre">text</span></code>或者空字符串，<code class="docutils literal notranslate"><span class="pre">responseText</span></code>就会包含已经收到的部分信息。</li>
<li>4，对应常量<code class="docutils literal notranslate"><span class="pre">DONE</span></code>，表示服务器数据已经完全接收，或者本次接收已经失败了。</li>
</ul>
<p>在通信过程中，每当发生状态变化的时候，<code class="docutils literal notranslate"><span class="pre">readyState</span></code>属性的值就会发生改变。这个值每一次变化，都会触发<code class="docutils literal notranslate"><span class="pre">readyStateChange</span></code>事件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Handle the response.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
 <span class="c1">// Show the &#39;Loading...&#39; message or do nothing.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码表示，只有<code class="docutils literal notranslate"><span class="pre">readyState</span></code>变为4时，才算确认请求已经成功，其他值都表示请求还在进行中。</p>
</div>
<div class="section" id="onreadystatechange">
<span id="onreadystatechange"></span><h3>onreadystatechange<a class="headerlink" href="#onreadystatechange" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">onreadystatechange</span></code>属性指向一个回调函数，当<code class="docutils literal notranslate"><span class="pre">readystatechange</span></code>事件发生的时候，这个回调函数就会调用，并且XMLHttpRequest实例的<code class="docutils literal notranslate"><span class="pre">readyState</span></code>属性也会发生变化。</p>
<p>另外，如果使用<code class="docutils literal notranslate"><span class="pre">abort()</span></code>方法，终止XMLHttpRequest请求，<code class="docutils literal notranslate"><span class="pre">onreadystatechange</span></code>回调函数也会被调用。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span> <span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span> <span class="o">!=</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">readyState</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="mi">200</span> <span class="o">!=</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">status</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseText</span> <span class="p">);</span>
<span class="p">};</span>
<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="response">
<span id="response"></span><h3>response<a class="headerlink" href="#response" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">response</span></code>属性为只读，返回接收到的数据体（即body部分）。它的类型可以是ArrayBuffer、Blob、Document、JSON对象、或者一个字符串，这由<code class="docutils literal notranslate"><span class="pre">XMLHttpRequest.responseType</span></code>属性的值决定。</p>
<p>如果本次请求没有成功或者数据不完整，该属性就会等于<code class="docutils literal notranslate"><span class="pre">null</span></code>。</p>
</div>
<div class="section" id="responsetype">
<span id="responsetype"></span><h3>responseType<a class="headerlink" href="#responsetype" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">responseType</span></code>属性用来指定服务器返回数据（<code class="docutils literal notranslate"><span class="pre">xhr.response</span></code>）的类型。</p>
<ul class="simple">
<li>&quot;&quot;：字符串（默认值）</li>
<li>&quot;arraybuffer&quot;：ArrayBuffer对象</li>
<li>&quot;blob&quot;：Blob对象</li>
<li>&quot;document&quot;：Document对象</li>
<li>&quot;json&quot;：JSON对象</li>
<li>&quot;text&quot;：字符串</li>
</ul>
<p>text类型适合大多数情况，而且直接处理文本也比较方便，document类型适合返回XML文档的情况，blob类型适合读取二进制数据，比如图片文件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/image.png&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s1">&#39;blob&#39;</span><span class="p">;</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">response</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">});</span>
    <span class="c1">// 或者</span>
    <span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">oReq</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
<p>如果将这个属性设为ArrayBuffer，就可以按照数组的方式处理二进制数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/image.png&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s1">&#39;arraybuffer&#39;</span><span class="p">;</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">binStr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// var byte = uInt8Array[i];</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
<p>如果将这个属性设为“json”，支持JSON的浏览器（Firefox&gt;9，chrome&gt;30），就会自动对返回数据调用<code class="docutils literal notranslate"><span class="pre">JSON.parse()</span></code>方法。也就是说，你从xhr.response属性（注意，不是xhr.responseText属性）得到的不是文本，而是一个JSON对象。</p>
<p>XHR2支持Ajax的返回类型为文档，即xhr.responseType=&quot;document&quot; 。这意味着，对于那些打开CORS的网站，我们可以直接用Ajax抓取网页，然后不用解析HTML字符串，直接对XHR回应进行DOM操作。</p>
</div>
<div class="section" id="responsetext">
<span id="responsetext"></span><h3>responseText<a class="headerlink" href="#responsetext" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">responseText</span></code>属性返回从服务器接收到的字符串，该属性为只读。如果本次请求没有成功或者数据不完整，该属性就会等于<code class="docutils literal notranslate"><span class="pre">null</span></code>。</p>
<p>如果服务器返回的数据格式是JSON，就可以使用<code class="docutils literal notranslate"><span class="pre">responseText</span></code>属性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ajax</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="responsexml">
<span id="responsexml"></span><h3>responseXML<a class="headerlink" href="#responsexml" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">responseXML</span></code>属性返回从服务器接收到的Document对象，该属性为只读。如果本次请求没有成功，或者数据不完整，或者不能被解析为XML或HTML，该属性等于<code class="docutils literal notranslate"><span class="pre">null</span></code>。</p>
<p>返回的数据会被直接解析为DOM对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* 返回的XML文件如下</span>
<span class="cm">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot; ?&gt;</span>
<span class="cm">  &lt;book&gt;</span>
<span class="cm">      &lt;chapter id=&quot;1&quot;&gt;(Re-)Introducing JavaScript&lt;/chapter&gt;</span>
<span class="cm">      &lt;chapter id=&quot;2&quot;&gt;JavaScript in Action&lt;/chapter&gt;</span>
<span class="cm">  &lt;/book&gt;</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ajax</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">chapters</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;chapter&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>如果服务器返回的数据，没有明示<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>头信息等于<code class="docutils literal notranslate"><span class="pre">text/xml</span></code>，可以使用<code class="docutils literal notranslate"><span class="pre">overrideMimeType()</span></code>方法，指定XMLHttpRequest对象将返回的数据解析为XML。</p>
</div>
<div class="section" id="status">
<span id="status"></span><h3>status<a class="headerlink" href="#status" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">status</span></code>属性为只读属性，表示本次请求所得到的HTTP状态码，它是一个整数。一般来说，如果通信成功的话，这个状态码是200。</p>
<ul class="simple">
<li>200, OK，访问正常</li>
<li>301, Moved Permanently，永久移动</li>
<li>302, Move temporarily，暂时移动</li>
<li>304, Not Modified，未修改</li>
<li>307, Temporary Redirect，暂时重定向</li>
<li>401, Unauthorized，未授权</li>
<li>403, Forbidden，禁止访问</li>
<li>404, Not Found，未发现指定网址</li>
<li>500, Internal Server Error，服务器发生错误</li>
</ul>
<p>基本上，只有2xx和304的状态码，表示服务器返回是正常状态。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">ajax</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span>
    <span class="o">||</span> <span class="p">(</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">304</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle the response.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Status error!</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="statustext">
<span id="statustext"></span><h3>statusText<a class="headerlink" href="#statustext" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">statusText</span></code>属性为只读属性，返回一个字符串，表示服务器发送的状态提示。不同于<code class="docutils literal notranslate"><span class="pre">status</span></code>属性，该属性包含整个状态信息，比如”200 OK“。</p>
</div>
<div class="section" id="timeout">
<span id="timeout"></span><h3>timeout<a class="headerlink" href="#timeout" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>属性等于一个整数，表示多少毫秒后，如果请求仍然没有得到结果，就会自动终止。如果该属性等于0，就表示没有时间限制。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">ontimeout</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;The request for &quot;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">&quot; timed out.&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="nx">timeout</span><span class="p">;</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id2"></span><h3>事件监听接口<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>XMLHttpRequest第一版，只能对<code class="docutils literal notranslate"><span class="pre">onreadystatechange</span></code>这一个事件指定回调函数。该事件对所有情况作出响应。 XMLHttpRequest第二版允许对更多的事件指定回调函数。</p>
<ul class="simple">
<li>onloadstart 请求发出</li>
<li>onprogress 正在发送和加载数据</li>
<li>onabort 请求被中止，比如用户调用了<code class="docutils literal notranslate"><span class="pre">abort()</span></code>方法</li>
<li>onerror 请求失败</li>
<li>onload 请求成功完成</li>
<li>ontimeout 用户指定的时限到期，请求还未完成</li>
<li>onloadend 请求完成，不管成果或失败</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="kd">var</span> <span class="nx">responseText</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">responseText</span><span class="p">);</span>
 <span class="c1">// process the response.</span>
<span class="p">};</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;There was an error!&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>注意，如果发生网络错误（比如服务器无法连通），<code class="docutils literal notranslate"><span class="pre">onerror</span></code>事件无法获取报错信息，所以只能显示报错。</p>
</div>
<div class="section" id="withcredentials">
<span id="withcredentials"></span><h3>withCredentials<a class="headerlink" href="#withcredentials" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">withCredentials</span></code>属性是一个布尔值，表示跨域请求时，用户信息（比如Cookie和认证的HTTP头信息）是否会包含在请求之中，默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。即向<code class="docutils literal notranslate"><span class="pre">example.com</span></code>发出跨域请求时，不会发送<code class="docutils literal notranslate"><span class="pre">example.com</span></code>设置在本机上的Cookie（如果有的话）。</p>
<p>如果你需要通过跨域AJAX发送Cookie，需要打开<code class="docutils literal notranslate"><span class="pre">withCredentials</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</div>
<p>为了让这个属性生效，服务器必须显式返回<code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Credentials</span></code>这个头信息。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Credentials</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.withCredentials</span></code>属性打开的话，不仅会发送Cookie，还会设置远程主机指定的Cookie。注意，此时你的脚本还是遵守同源政策，无法 从<code class="docutils literal notranslate"><span class="pre">document.cookie</span></code>或者HTTP回应的头信息之中，读取这些Cookie。</p>
</div>
</div>
<div class="section" id="xmlhttprequest">
<span id="id3"></span><h2>XMLHttpRequest实例的方法<a class="headerlink" href="#xmlhttprequest" title="永久链接至标题">¶</a></h2>
<div class="section" id="abort">
<span id="abort"></span><h3>abort()<a class="headerlink" href="#abort" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">abort</span></code>方法用来终止已经发出的HTTP请求。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com/page.php&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ajaxAbortTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ajax</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
    <span class="nx">ajax</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码在发出5秒之后，终止一个AJAX请求。</p>
</div>
<div class="section" id="getallresponseheaders">
<span id="getallresponseheaders"></span><h3>getAllResponseHeaders()<a class="headerlink" href="#getallresponseheaders" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getAllResponseHeaders</span></code>方法返回服务器发来的所有HTTP头信息。格式为字符串，每个头信息之间使用<code class="docutils literal notranslate"><span class="pre">CRLF</span></code>分隔，如果没有受到服务器回应，该属性返回<code class="docutils literal notranslate"><span class="pre">null</span></code>。</p>
</div>
<div class="section" id="getresponseheader">
<span id="getresponseheader"></span><h3>getResponseHeader()<a class="headerlink" href="#getresponseheader" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getResponseHeader</span></code>方法返回HTTP头信息指定字段的值，如果还没有收到服务器回应或者指定字段不存在，则该属性为<code class="docutils literal notranslate"><span class="pre">null</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">getHeaderTime</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="s2">&quot;Last-Modified&quot;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">oReq</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">oReq</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span> <span class="s2">&quot;yourpage.html&quot;</span><span class="p">);</span>
<span class="nx">oReq</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">getHeaderTime</span><span class="p">;</span>
<span class="nx">oReq</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
<p>如果有多个字段同名，则它们的值会被连接为一个字符串，每个字段之间使用“逗号+空格”分隔。</p>
</div>
<div class="section" id="open">
<span id="open"></span><h3>open()<a class="headerlink" href="#open" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>对象的<code class="docutils literal notranslate"><span class="pre">open</span></code>方法用于指定发送HTTP请求的参数，它的使用格式如下，一共可以接受五个参数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">void</span> <span class="nx">open</span><span class="p">(</span>
   <span class="nx">string</span> <span class="nx">method</span><span class="p">,</span>
   <span class="nx">string</span> <span class="nx">url</span><span class="p">,</span>
   <span class="nx">optional</span> <span class="kr">boolean</span> <span class="nx">async</span><span class="p">,</span>
   <span class="nx">optional</span> <span class="nx">string</span> <span class="nx">user</span><span class="p">,</span>
   <span class="nx">optional</span> <span class="nx">string</span> <span class="nx">password</span>
<span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">method</span></code>：表示HTTP动词，比如“GET”、“POST”、“PUT”和“DELETE”。</li>
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: 表示请求发送的网址。</li>
<li><code class="docutils literal notranslate"><span class="pre">async</span></code>: 格式为布尔值，默认为<code class="docutils literal notranslate"><span class="pre">true</span></code>，表示请求是否为异步。如果设为<code class="docutils literal notranslate"><span class="pre">false</span></code>，则<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法只有等到收到服务器返回的结果，才会有返回值。</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>：表示用于认证的用户名，默认为空字符串。</li>
<li><code class="docutils literal notranslate"><span class="pre">password</span></code>：表示用于认证的密码，默认为空字符串。</li>
</ul>
<p>如果对使用过<code class="docutils literal notranslate"><span class="pre">open()</span></code>方法的请求，再次使用这个方法，等同于调用<code class="docutils literal notranslate"><span class="pre">abort()</span></code>。</p>
<p>下面发送POST请求的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="s1">&#39;someURL&#39;</span><span class="p">));</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">encodeURI</span><span class="p">(</span><span class="s1">&#39;dataString&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>上面方法中，open方法向指定URL发出POST请求，send方法送出实际的数据。</p>
<p>下面是一个同步AJAX请求的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/bar/foo.txt&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="send">
<span id="send"></span><h3>send()<a class="headerlink" href="#send" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">send</span></code>方法用于实际发出HTTP请求。如果不带参数，就表示HTTP请求只包含头信息，也就是只有一个URL，典型例子就是GET请求；如果带有参数，就表示除了头信息，还带有包含具体数据的信息体，典型例子就是POST请求。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span>
  <span class="p">,</span> <span class="s1">&#39;http://www.example.com/somepage.php?id=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="p">,</span> <span class="kc">true</span>
<span class="p">);</span>

<span class="c1">// 等同于</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;id=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com/somepage.php&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">GET</span></code>请求的参数，可以作为查询字符串附加在URL后面，也可以作为<code class="docutils literal notranslate"><span class="pre">send</span></code>方法的参数。</p>
<p>下面是发送POST请求的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;email=&#39;</span>
  <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span>
  <span class="o">+</span> <span class="s1">&#39;&amp;password=&#39;</span>
  <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.com/somepage.php&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">);</span>
<span class="nx">ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>如果请求是异步的（默认为异步），该方法在发出请求后会立即返回。如果请求为同步，该方法只有等到收到服务器回应后，才会返回。</p>
<p>注意，所有XMLHttpRequest的监听事件，都必须在<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法调用之前设定。</p>
<p><code class="docutils literal notranslate"><span class="pre">send</span></code>方法的参数就是发送的数据。多种格式的数据，都可以作为它的参数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">void</span> <span class="nx">send</span><span class="p">();</span>
<span class="k">void</span> <span class="nx">send</span><span class="p">(</span><span class="nx">ArrayBufferView</span> <span class="nx">data</span><span class="p">);</span>
<span class="k">void</span> <span class="nx">send</span><span class="p">(</span><span class="nx">Blob</span> <span class="nx">data</span><span class="p">);</span>
<span class="k">void</span> <span class="nx">send</span><span class="p">(</span><span class="nx">Document</span> <span class="nx">data</span><span class="p">);</span>
<span class="k">void</span> <span class="nx">send</span><span class="p">(</span><span class="nb">String</span> <span class="nx">data</span><span class="p">);</span>
<span class="k">void</span> <span class="nx">send</span><span class="p">(</span><span class="nx">FormData</span> <span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>如果发送<code class="docutils literal notranslate"><span class="pre">Document</span></code>数据，在发送之前，数据会先被串行化。</p>
<p>发送二进制数据，最好使用<code class="docutils literal notranslate"><span class="pre">ArrayBufferView</span></code>或<code class="docutils literal notranslate"><span class="pre">Blob</span></code>对象，这使得通过Ajax上传文件成为可能。</p>
<p>下面是一个上传<code class="docutils literal notranslate"><span class="pre">ArrayBuffer</span></code>对象的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">sendArrayBuffer</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/server&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">uInt8Array</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>FormData类型可以用于构造表单数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>

<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;张三&#39;</span><span class="p">);</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;zhangsan@example.com&#39;</span><span class="p">);</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;birthDate&#39;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/register&quot;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>
</pre></div>
</div>
<p>上面的代码构造了一个<code class="docutils literal notranslate"><span class="pre">formData</span></code>对象，然后使用send方法发送。它的效果与点击下面表单的submit按钮是一样的。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;registration&#39;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;registration&#39;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#39;/register&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;text&#39;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;username&#39;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#39;张三&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;email&#39;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;email&#39;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#39;zhangsan@example.com&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;number&#39;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;birthDate&#39;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#39;1940&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;submit&#39;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#39;return sendForm(this.form);&#39;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>FormData也可以将现有表单构造生成。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">formElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;submitform.php&quot;</span><span class="p">);</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">formElement</span><span class="p">));</span>
</pre></div>
</div>
<p>FormData对象还可以对现有表单添加数据，这为我们操作表单提供了极大的灵活性。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">sendForm</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;csrf&#39;</span><span class="p">,</span> <span class="s1">&#39;e69a18d7db1286040586e6da1950128c&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">form</span><span class="p">.</span><span class="nx">action</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">};</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#registration&#39;</span><span class="p">);</span>
<span class="nx">sendForm</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
</pre></div>
</div>
<p>FormData对象也能用来模拟File控件，进行文件上传。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">uploadFiles</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">file</span><span class="p">;</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">file</span><span class="p">);</span> <span class="c1">// 可加入第三个参数，表示文件名</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>  <span class="c1">// multipart/form-data</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;file&quot;]&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">uploadFiles</span><span class="p">(</span><span class="s1">&#39;/server&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>FormData也可以加入JavaScript生成的文件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 添加JavaScript生成的文件</span>
<span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&lt;a id=&quot;a&quot;&gt;&lt;b id=&quot;b&quot;&gt;hey!&lt;/b&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">content</span><span class="p">],</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;text/xml&quot;</span><span class="p">});</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;webmasterfile&quot;</span><span class="p">,</span> <span class="nx">blob</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="setrequestheader">
<span id="setrequestheader"></span><h3>setRequestHeader()<a class="headerlink" href="#setrequestheader" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">setRequestHeader</span></code>方法用于设置HTTP头信息。该方法必须在<code class="docutils literal notranslate"><span class="pre">open()</span></code>之后、<code class="docutils literal notranslate"><span class="pre">send()</span></code>之前调用。如果该方法多次调用，设定同一个字段，则每一次调用的值会被合并成一个单一的值发送。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</pre></div>
</div>
<p>上面代码首先设置头信息<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>，表示发送JSON格式的数据；然后设置<code class="docutils literal notranslate"><span class="pre">Content-Length</span></code>，表示数据长度；最后发送JSON数据。</p>
</div>
<div class="section" id="overridemimetype">
<span id="overridemimetype"></span><h3>overrideMimeType()<a class="headerlink" href="#overridemimetype" title="永久链接至标题">¶</a></h3>
<p>该方法用来指定服务器返回数据的MIME类型。该方法必须在<code class="docutils literal notranslate"><span class="pre">send()</span></code>之前调用。</p>
<p>传统上，如果希望从服务器取回二进制数据，就要使用这个方法，人为将数据类型伪装成文本数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/image.png&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// 强制将MIME改为文本类型</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">overrideMimeType</span><span class="p">(</span><span class="s1">&#39;text/plain; charset=x-user-defined&#39;</span><span class="p">);</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">binStr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">binStr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">binStr</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="kd">var</span> <span class="kr">byte</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>  <span class="c1">// 去除高位字节，留下低位字节</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
<p>上面代码中，因为传回来的是二进制数据，首先用<code class="docutils literal notranslate"><span class="pre">xhr.overrideMimeType</span></code>方法强制改变它的MIME类型，伪装成文本数据。字符集必需指定为“x-user-defined”，如果是其他字符集，浏览器内部会强制转码，将其保存成UTF-16的形式。字符集“x-user-defined”其实也会发生转码，浏览器会在每个字节前面再加上一个字节（0xF700-0xF7ff），因此后面要对每个字符进行一次与运算（&amp;），将高位的8个位去除，只留下低位的8个位，由此逐一读出原文件二进制数据的每个字节。</p>
<p>这种方法很麻烦，在XMLHttpRequest版本升级以后，一般采用指定<code class="docutils literal notranslate"><span class="pre">responseType</span></code>的方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">arraybuffer</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s2">&quot;arraybuffer&quot;</span><span class="p">;</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="xmlhttprequest">
<span id="id4"></span><h2>XMLHttpRequest实例的事件<a class="headerlink" href="#xmlhttprequest" title="永久链接至标题">¶</a></h2>
<div class="section" id="readystatechange">
<span id="readystatechange"></span><h3>readyStateChange事件<a class="headerlink" href="#readystatechange" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readyState</span></code>属性的值发生改变，就会触发readyStateChange事件。</p>
<p>我们可以通过<code class="docutils literal notranslate"><span class="pre">onReadyStateChange</span></code>属性，指定这个事件的回调函数，对不同状态进行不同处理。尤其是当状态变为4的时候，表示通信成功，这时回调函数就可以处理服务器传送回来的数据。</p>
</div>
<div class="section" id="progress">
<span id="progress"></span><h3>progress事件<a class="headerlink" href="#progress" title="永久链接至标题">¶</a></h3>
<p>上传文件时，XMLHTTPRequest对象的upload属性有一个progress，会不断返回上传的进度。</p>
<p>假定网页上有一个progress元素。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">progress</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;100&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>0% complete<span class="p">&lt;/</span><span class="nt">progress</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>文件上传时，对upload属性指定progress事件回调函数，即可获得上传的进度。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">upload</span><span class="p">(</span><span class="nx">blobOrFile</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/server&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

  <span class="c1">// Listen to the upload progress.</span>
  <span class="kd">var</span> <span class="nx">progressBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">progressBar</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
      <span class="nx">progressBar</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">progressBar</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="c1">// Fallback for unsupported browsers.</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">blobOrFile</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">upload</span><span class="p">(</span><span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;hello world&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">}));</span>
</pre></div>
</div>
</div>
<div class="section" id="loaderrorabort">
<span id="loaderrorabort"></span><h3>load事件、error事件、abort事件<a class="headerlink" href="#loaderrorabort" title="永久链接至标题">¶</a></h3>
<p>load事件表示服务器传来的数据接收完毕，error事件表示请求出错，abort事件表示请求被中断。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;abort&quot;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">);</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">updateProgress</span> <span class="p">(</span><span class="nx">oEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">oEvent</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">oEvent</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">oEvent</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
    <span class="c1">// ...</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 回应的总数据量未知，导致无法计算百分比</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferComplete</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The transfer is complete.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferFailed</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occurred while transferring the file.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">transferCanceled</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The transfer has been canceled by the user.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loadend">
<span id="loadend"></span><h3>loadend事件<a class="headerlink" href="#loadend" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">abort</span></code>、<code class="docutils literal notranslate"><span class="pre">load</span></code>和<code class="docutils literal notranslate"><span class="pre">error</span></code>这三个事件，会伴随一个<code class="docutils literal notranslate"><span class="pre">loadend</span></code>事件，表示请求结束，但不知道其是否成功。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;loadend&quot;</span><span class="p">,</span> <span class="nx">loadEnd</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">loadEnd</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;请求结束（不知道是否成功）&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id5"></span><h2>文件上传<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>HTML网页的<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>元素能够以四种格式，向服务器发送数据。</p>
<ul class="simple">
<li>使用<code class="docutils literal notranslate"><span class="pre">POST</span></code>方法，将<code class="docutils literal notranslate"><span class="pre">enctype</span></code>属性设为<code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>，这是默认方法。</li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;register.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;AJAXSubmit(this); return false;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>使用<code class="docutils literal notranslate"><span class="pre">POST</span></code>方法，将<code class="docutils literal notranslate"><span class="pre">enctype</span></code>属性设为<code class="docutils literal notranslate"><span class="pre">text/plain</span></code>。</li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;register.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;text/plain&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;AJAXSubmit(this); return false;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>使用<code class="docutils literal notranslate"><span class="pre">POST</span></code>方法，将<code class="docutils literal notranslate"><span class="pre">enctype</span></code>属性设为<code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code>。</li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;register.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;AJAXSubmit(this); return false;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>使用<code class="docutils literal notranslate"><span class="pre">GET</span></code>方法，<code class="docutils literal notranslate"><span class="pre">enctype</span></code>属性将被忽略。</li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;register.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;get&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;AJAXSubmit(this); return false;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>某个表单有两个字段，分别是<code class="docutils literal notranslate"><span class="pre">foo</span></code>和<code class="docutils literal notranslate"><span class="pre">baz</span></code>，其中<code class="docutils literal notranslate"><span class="pre">foo</span></code>字段的值等于<code class="docutils literal notranslate"><span class="pre">bar</span></code>，<code class="docutils literal notranslate"><span class="pre">baz</span></code>字段的值一个分为两行的字符串。上面四种方法，都可以将这个表单发送到服务器。</p>
<p>第一种方法是默认方法，POST发送，Encoding type为application/x-www-form-urlencoded。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Content-Type: application/x-www-form-urlencoded

foo=bar<span class="ni">&amp;baz=The+first+line.&amp;#37;</span>0D%0AThe+second+line.%0D%0A
</pre></div>
</div>
<p>第二种方法是POST发送，Encoding type为text/plain。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span>

<span class="nx">foo</span><span class="o">=</span><span class="nx">bar</span>
<span class="nx">baz</span><span class="o">=</span><span class="nx">The</span> <span class="nx">first</span> <span class="nx">line</span><span class="p">.</span>
<span class="nx">The</span> <span class="nx">second</span> <span class="nx">line</span><span class="p">.</span>
</pre></div>
</div>
<p>第三种方法是POST发送，Encoding type为multipart/form-data。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Content-Type: multipart/form-data; boundary=---------------------------314911788813839

-----------------------------314911788813839
Content-Disposition: form-data; name=&quot;foo&quot;

bar
-----------------------------314911788813839
Content-Disposition: form-data; name=&quot;baz&quot;

The first line.
The second line.

-----------------------------314911788813839--
</pre></div>
</div>
<p>第四种方法是GET请求。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>?foo=bar&amp;baz=The%20first%20line.%0AThe%20second%20line.
</pre></div>
</div>
<p>通常，我们使用file控件实现文件上传。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;file-form&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;handler.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;file-select&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;photos[]&quot;</span> <span class="na">multiple</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;upload-button&quot;</span><span class="p">&gt;</span>上传<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面HTML代码中，file控件的multiple属性，指定可以一次选择多个文件；如果没有这个属性，则一次只能选择一个文件。</p>
<p>file对象的files属性，返回一个FileList对象，包含了用户选中的文件。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fileSelect</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;file-select&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="nx">fileSelect</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
</pre></div>
</div>
<p>然后，新建一个FormData对象的实例，用来模拟发送到服务器的表单数据，把选中的文件添加到这个对象上面。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">&#39;image.*&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">continue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;photos[]&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码中的FormData对象的append方法，除了可以添加文件，还可以添加二进制对象（Blob）或者字符串。</p>
<p>{% highlight javascript %}</p>
<p>// Files
formData.append(name, file, filename);</p>
<p>// Blobs
formData.append(name, blob, filename);</p>
<p>// Strings
formData.append(name, value);</p>
<p>{% endhighlight %}</p>
<p>append方法的第一个参数是表单的控件名，第二个参数是实际的值，第三个参数是可选的，通常是文件名。</p>
<p>最后，使用Ajax方法向服务器上传文件。</p>
<p>{% highlight javascript %}</p>
<p>var xhr = new XMLHttpRequest();</p>
<p>xhr.open('POST', 'handler.php', true);</p>
<p>xhr.onload = function () {
if (xhr.status !== 200) {
alert('An error occurred!');
}
};</p>
<p>xhr.send(formData);</p>
<p>{% endhighlight %}</p>
<p>目前，各大浏览器（包括IE 10）都支持Ajax上传文件。</p>
<p>除了使用FormData接口上传，也可以直接使用File API上传。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;test-input&#39;</span><span class="p">).</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;myserver/uploads&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</pre></div>
</div>
<p>可以看到，上面这种写法比FormData的写法，要简单很多。</p>
</div>
<div class="section" id="">
<span id="id6"></span><h2>参考链接<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>MDN, <a class="reference external" href="https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest/Using_XMLHttpRequest">Using XMLHttpRequest</a></li>
<li>Mathias Bynens, <a class="reference external" href="http://mathiasbynens.be/notes/xhr-responsetype-json">Loading JSON-formatted data with Ajax and xhr.responseType='json'</a></li>
<li>Eric Bidelman, <a class="reference external" href="http://www.html5rocks.com/en/tutorials/file/xhr2/">New Tricks in XMLHttpRequest2</a></li>
<li>Matt West, <a class="reference external" href="http://blog.teamtreehouse.com/uploading-files-ajax">Uploading Files with AJAX</a></li>
<li>Matt Gaunt, <a class="reference external" href="http://updates.html5rocks.com/2015/03/introduction-to-fetch">Introduction to fetch()</a></li>
<li>Nikhil Marathe, <a class="reference external" href="https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/">This API is so Fetching!</a></li>
<li>Ludovico Fischer, <a class="reference external" href="http://www.sitepoint.com/introduction-to-the-fetch-api/">Introduction to the Fetch API</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cors.html" class="btn btn-neutral float-right" title="CORS通信" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="same-origin.html" class="btn btn-neutral" title="同源政策" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>