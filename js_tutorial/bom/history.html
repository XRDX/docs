

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>History 对象 &mdash; JS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Cookie" href="cookie.html" />
    <link rel="prev" title="window对象" href="window.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html">stdlib 标准库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oop/index.html">面向对象编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">语法专题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM 模型</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">BOM 浏览器环境</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="engine.html">浏览器环境概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="window.html">window对象</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">History 对象</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#history-back-history-forward-history-go">History.back()、History.forward()、History.go()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#history-pushstate">History.pushState()，</a></li>
<li class="toctree-l4"><a class="reference internal" href="#history-replacestate">History.replaceState()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#popstate">popstate 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#urlsearchparams-api">URLSearchParams API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">参考链接</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cookie.html">Cookie</a></li>
<li class="toctree-l2"><a class="reference internal" href="webstorage.html">浏览器端数据储存机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="same-origin.html">同源政策</a></li>
<li class="toctree-l2"><a class="reference internal" href="ajax.html">AJAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="cors.html">CORS通信</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexeddb.html">IndexedDB：浏览器端数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="notification.html">Web Notifications API</a></li>
<li class="toctree-l2"><a class="reference internal" href="mobile.html">移动设备API</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">BOM 浏览器环境</a> &raquo;</li>
        
      <li>History 对象</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="history">
<span id="history"></span><h1>History 对象<a class="headerlink" href="#history" title="永久链接至标题">¶</a></h1>
<div class="section" id="">
<span id="id1"></span><h2>概述<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">window.history</span></code>属性指向 History 对象，它表示当前窗口的浏览历史。</p>
<p>History 对象保存了当前窗口访问过的所有页面网址。下面代码表示当前窗口一共访问过3个网址。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 3</span>
</pre></div>
</div>
<p>由于安全原因，浏览器不允许脚本读取这些地址，但是允许在地址之间导航。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 后退到前一个网址</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">()</span>

<span class="c1">// 等同于</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>浏览器工具栏的“前进”和“后退”按钮，其实就是对 History 对象进行操作。</p>
</div>
<div class="section" id="">
<span id="id2"></span><h2>属性<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>History 对象主要有两个属性。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">History.length</span></code>：当前窗口访问过的网址数量（包括当前网页）</li>
<li><code class="docutils literal notranslate"><span class="pre">History.state</span></code>：History 堆栈最上层的状态值（详见下文）</li>
</ul>
</div>
<div class="section" id="">
<span id="id3"></span><h2>方法<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="history-back-history-forward-history-go">
<span id="history-back-history-forward-history-go"></span><h3>History.back()、History.forward()、History.go()<a class="headerlink" href="#history-back-history-forward-history-go" title="永久链接至标题">¶</a></h3>
<p>这三个方法用于在历史之中移动。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">History.back()</span></code>：移动到上一个网址，等同于点击浏览器的后退键。对于第一个访问的网址，该方法无效果。</li>
<li><code class="docutils literal notranslate"><span class="pre">History.forward()</span></code>：移动到下一个网址，等同于点击浏览器的前进键。对于最后一个访问的网址，该方法无效果。</li>
<li><code class="docutils literal notranslate"><span class="pre">History.go()</span></code>：接受一个整数作为参数，以当前网址为基准，移动到参数指定的网址，比如<code class="docutils literal notranslate"><span class="pre">go(1)</span></code>相当于<code class="docutils literal notranslate"><span class="pre">forward()</span></code>，<code class="docutils literal notranslate"><span class="pre">go(-1)</span></code>相当于<code class="docutils literal notranslate"><span class="pre">back()</span></code>。如果参数超过实际存在的网址范围，该方法无效果；如果不指定参数，默认参数为<code class="docutils literal notranslate"><span class="pre">0</span></code>，相当于刷新当前页面。</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">forward</span><span class="p">();</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">history.go(0)</span></code>相当于刷新当前页面。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="nx">记录</span>
</pre></div>
</div>
<p>注意，移动到以前访问过的页面时，页面通常是从浏览器缓存之中加载，而不是重新要求服务器发送新的网页。</p>
</div>
<div class="section" id="history-pushstate">
<span id="history-pushstate"></span><h3>History.pushState()，<a class="headerlink" href="#history-pushstate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">History.pushState()</span></code>方法用于在历史中添加一条记录。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</pre></div>
</div>
<p>该方法接受三个参数，依次为：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">state</span></code>：一个与添加的记录相关联的状态对象，主要用于<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件。该事件触发时，该对象会传入回调函数。也就是说，浏览器会将这个对象序列化以后保留在本地，重新载入这个页面的时候，可以拿到这个对象。如果不需要这个对象，此处可以填<code class="docutils literal notranslate"><span class="pre">null</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">title</span></code>：新页面的标题。但是，现在所有浏览器都忽视这个参数，所以这里可以填空字符串。</li>
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>：新的网址，必须与当前页面处在同一个域。浏览器的地址栏将显示这个网址。</li>
</ul>
<p>假定当前网址是<code class="docutils literal notranslate"><span class="pre">example.com/1.html</span></code>，使用<code class="docutils literal notranslate"><span class="pre">pushState()</span></code>方法在浏览记录（History 对象）中添加一个新记录。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">stateObj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">};</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">,</span> <span class="s1">&#39;page 2&#39;</span><span class="p">,</span> <span class="s1">&#39;2.html&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>添加新记录后，浏览器地址栏立刻显示<code class="docutils literal notranslate"><span class="pre">example.com/2.html</span></code>，但并不会跳转到<code class="docutils literal notranslate"><span class="pre">2.html</span></code>，甚至也不会检查<code class="docutils literal notranslate"><span class="pre">2.html</span></code>是否存在，它只是成为浏览历史中的最新记录。这时，在地址栏输入一个新的地址(比如访问<code class="docutils literal notranslate"><span class="pre">google.com</span></code>)，然后点击了倒退按钮，页面的 URL 将显示<code class="docutils literal notranslate"><span class="pre">2.html</span></code>；你再点击一次倒退按钮，URL 将显示<code class="docutils literal notranslate"><span class="pre">1.html</span></code>。</p>
<p>总之，<code class="docutils literal notranslate"><span class="pre">pushState()</span></code>方法不会触发页面刷新，只是导致 History 对象发生变化，地址栏会有反应。</p>
<p>使用该方法之后，就可以用<code class="docutils literal notranslate"><span class="pre">History.state</span></code>属性读出状态对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">stateObj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">};</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">,</span> <span class="s1">&#39;page 2&#39;</span><span class="p">,</span> <span class="s1">&#39;2.html&#39;</span><span class="p">);</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">state</span> <span class="c1">// {foo: &quot;bar&quot;}</span>
</pre></div>
</div>
<p>如果<code class="docutils literal notranslate"><span class="pre">pushState</span></code>的 URL 参数设置了一个新的锚点值（即<code class="docutils literal notranslate"><span class="pre">hash</span></code>），并不会触发<code class="docutils literal notranslate"><span class="pre">hashchange</span></code>事件。反过来，如果 URL 的锚点值变了，则会在 History 对象创建一条浏览记录。</p>
<p>如果<code class="docutils literal notranslate"><span class="pre">pushState()</span></code>方法设置了一个跨域网址，则会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 报错</span>
<span class="c1">// 当前网址为 http://example.com</span>
<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;https://twitter.com/hello&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">pushState</span></code>想要插入一个跨域的网址，导致报错。这样设计的目的是，防止恶意代码让用户以为他们是在另一个网站上，因为这个方法不会导致页面跳转。</p>
</div>
<div class="section" id="history-replacestate">
<span id="history-replacestate"></span><h3>History.replaceState()<a class="headerlink" href="#history-replacestate" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">History.replaceState()</span></code>方法用来修改 History 对象的当前记录，其他都与<code class="docutils literal notranslate"><span class="pre">pushState()</span></code>方法一模一样。</p>
<p>假定当前网页是<code class="docutils literal notranslate"><span class="pre">example.com/example.html</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s1">&#39;title 1&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=1&#39;</span><span class="p">)</span>
<span class="c1">// URL 显示为 http://example.com/example.html?page=1</span>

<span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">2</span><span class="p">},</span> <span class="s1">&#39;title 2&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=2&#39;</span><span class="p">);</span>
<span class="c1">// URL 显示为 http://example.com/example.html?page=2</span>

<span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="mi">3</span><span class="p">},</span> <span class="s1">&#39;title 3&#39;</span><span class="p">,</span> <span class="s1">&#39;?page=3&#39;</span><span class="p">);</span>
<span class="c1">// URL 显示为 http://example.com/example.html?page=3</span>

<span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">()</span>
<span class="c1">// URL 显示为 http://example.com/example.html?page=1</span>

<span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">()</span>
<span class="c1">// URL 显示为 http://example.com/example.html</span>

<span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">// URL 显示为 http://example.com/example.html?page=3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="popstate">
<span id="popstate"></span><h2>popstate 事件<a class="headerlink" href="#popstate" title="永久链接至标题">¶</a></h2>
<p>每当同一个文档的浏览历史（即<code class="docutils literal notranslate"><span class="pre">history</span></code>对象）出现变化时，就会触发<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件。</p>
<p>注意，仅仅调用<code class="docutils literal notranslate"><span class="pre">pushState()</span></code>方法或<code class="docutils literal notranslate"><span class="pre">replaceState()</span></code>方法 ，并不会触发该事件，只有用户点击浏览器倒退按钮和前进按钮，或者使用 JavaScript 调用<code class="docutils literal notranslate"><span class="pre">History.back()</span></code>、<code class="docutils literal notranslate"><span class="pre">History.forward()</span></code>、<code class="docutils literal notranslate"><span class="pre">History.go()</span></code>方法时才会触发。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。</p>
<p>使用的时候，可以为<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件指定回调函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onpopstate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;location: &#39;</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;state: &#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">state</span><span class="p">));</span>
<span class="p">};</span>

<span class="c1">// 或者</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;popstate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;location: &#39;</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;state: &#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">state</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>回调函数的参数是一个<code class="docutils literal notranslate"><span class="pre">event</span></code>事件对象，它的<code class="docutils literal notranslate"><span class="pre">state</span></code>属性指向<code class="docutils literal notranslate"><span class="pre">pushState</span></code>和<code class="docutils literal notranslate"><span class="pre">replaceState</span></code>方法为当前 URL 所提供的状态对象（即这两个方法的第一个参数）。上面代码中的<code class="docutils literal notranslate"><span class="pre">event.state</span></code>，就是通过<code class="docutils literal notranslate"><span class="pre">pushState</span></code>和<code class="docutils literal notranslate"><span class="pre">replaceState</span></code>方法，为当前 URL 绑定的<code class="docutils literal notranslate"><span class="pre">state</span></code>对象。</p>
<p>这个<code class="docutils literal notranslate"><span class="pre">state</span></code>对象也可以直接通过<code class="docutils literal notranslate"><span class="pre">history</span></code>对象读取。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">currentState</span> <span class="o">=</span> <span class="nx">history</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
</pre></div>
</div>
<p>注意，页面第一次加载的时候，浏览器不会触发<code class="docutils literal notranslate"><span class="pre">popstate</span></code>事件。</p>
</div>
<div class="section" id="urlsearchparams-api">
<span id="urlsearchparams-api"></span><h2>URLSearchParams API<a class="headerlink" href="#urlsearchparams-api" title="永久链接至标题">¶</a></h2>
<p>URLSearchParams API 用于处理 URL 之中的查询字符串，即问号之后的部分。没有部署这个API的浏览器，可以用<a class="reference external" href="https://github.com/WebReflection/url-search-params">url-search-params</a>这个垫片库。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">paramsString</span> <span class="o">=</span> <span class="s1">&#39;q=URLUtils.searchParams&amp;topic=api&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">searchParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="nx">paramsString</span><span class="p">);</span>
</pre></div>
</div>
<p>URLSearchParams有以下方法，用来操作某个参数。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">has()</span></code>：返回一个布尔值，表示是否具有某个参数</li>
<li><code class="docutils literal notranslate"><span class="pre">get()</span></code>：返回指定参数的第一个值</li>
<li><code class="docutils literal notranslate"><span class="pre">getAll()</span></code>：返回一个数组，成员是指定参数的所有值</li>
<li><code class="docutils literal notranslate"><span class="pre">set()</span></code>：设置指定参数</li>
<li><code class="docutils literal notranslate"><span class="pre">delete()</span></code>：删除指定参数</li>
<li><code class="docutils literal notranslate"><span class="pre">append()</span></code>：在查询字符串之中，追加一个键值对</li>
<li><code class="docutils literal notranslate"><span class="pre">toString()</span></code>：返回整个查询字符串</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">paramsString</span> <span class="o">=</span> <span class="s1">&#39;q=URLUtils.searchParams&amp;topic=api&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">searchParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="nx">paramsString</span><span class="p">);</span>

<span class="nx">searchParams</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">)</span> <span class="c1">// &quot;api&quot;</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">)</span> <span class="c1">// [&quot;api&quot;]</span>

<span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// null，注意Firefox返回空字符串</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// 2</span>

<span class="nx">searchParams</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="s1">&#39;webdev&#39;</span><span class="p">);</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// &quot;q=URLUtils.searchParams&amp;topic=api&amp;foo=2&amp;topic=webdev&quot;</span>

<span class="nx">searchParams</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// [2, 3]</span>

<span class="nx">searchParams</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">);</span>
<span class="nx">searchParams</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// &quot;q=URLUtils.searchParams&amp;foo=2&amp;foo=3&quot;</span>
</pre></div>
</div>
<p>URLSearchParams还有三个方法，用来遍历所有参数。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">keys()</span></code>：遍历所有参数名</li>
<li><code class="docutils literal notranslate"><span class="pre">values()</span></code>：遍历所有参数值</li>
<li><code class="docutils literal notranslate"><span class="pre">entries()</span></code>：遍历所有参数的键值对</li>
</ul>
<p>上面三个方法返回的都是<code class="docutils literal notranslate"><span class="pre">Iterator</span></code>对象。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">searchParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="s1">&#39;key1=value1&amp;key2=value2&#39;</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">searchParams</span><span class="p">.</span><span class="nx">keys</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// key1</span>
<span class="c1">// key2</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">searchParams</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// value1</span>
<span class="c1">// value2</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">pair</span> <span class="k">of</span> <span class="nx">searchParams</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">+</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>
<span class="c1">// key1, value1</span>
<span class="c1">// key2, value2</span>
</pre></div>
</div>
<p>在Chrome浏览器之中，<code class="docutils literal notranslate"><span class="pre">URLSearchParams</span></code>实例本身就是<code class="docutils literal notranslate"><span class="pre">Iterator</span></code>对象，与<code class="docutils literal notranslate"><span class="pre">entries</span></code>方法返回值相同。所以，可以写成下面的样子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">of</span> <span class="nx">searchParams</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>下面是一个替换当前URL的例子。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// URL: https://example.com?version=1.0</span>
<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({},</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sb">`</span><span class="si">${</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="si">}</span><span class="sb">?</span><span class="si">${</span><span class="nx">params</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="c1">// URL: https://example.com?version=2.0</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">URLSearchParams</span></code>实例可以当作 POST 数据发送，所有数据都会 URL 编码。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">();</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;api_key&#39;</span><span class="p">,</span> <span class="s1">&#39;1234567890&#39;</span><span class="p">);</span>

<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://example.com/api&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="nx">body</span><span class="o">:</span> <span class="nx">params</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(...)</span>
</pre></div>
</div>
<p>DOM的<code class="docutils literal notranslate"><span class="pre">a</span></code>元素节点的<code class="docutils literal notranslate"><span class="pre">searchParams</span></code>属性，就是一个<code class="docutils literal notranslate"><span class="pre">URLSearchParams</span></code>实例。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s1">&#39;https://example.com?filter=api&#39;</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">)</span> <span class="c1">// &quot;api&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">URLSearchParams</span></code>还可以与<code class="docutils literal notranslate"><span class="pre">URL</span></code>接口结合使用。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">location</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;somedefault&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id4"></span><h2>参考链接<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>MOZILLA DEVELOPER NETWORK，<a class="reference external" href="https://developer.mozilla.org/en-US/docs/DOM/Manipulating_the_browser_history">Manipulating the browser history</a></li>
<li>MOZILLA DEVELOPER NETWORK，<a class="reference external" href="https://developer.mozilla.org/en-US/docs/DOM/window.onpopstate">window.onpopstate</a></li>
<li>Johnny Simpson, <a class="reference external" href="http://www.inserthtml.com/2013/06/history-api/">Controlling History: The HTML5 History API And ‘Selective’ Loading</a></li>
<li>Louis Lazaris, <a class="reference external" href="http://www.impressivewebs.com/html5-history-api-syntax/">HTML5 History API: A Syntax Primer</a></li>
<li>Eric Bidelman, <a class="reference external" href="https://developers.google.com/web/updates/2016/01/urlsearchparams?hl=en">Easy URL manipulation with URLSearchParams</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cookie.html" class="btn btn-neutral float-right" title="Cookie" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="window.html" class="btn btn-neutral" title="window对象" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>