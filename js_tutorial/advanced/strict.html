

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>严格模式 &mdash; JS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="ECMAScript 6 介绍" href="ecmascript6.html" />
    <link rel="prev" title="Promise 对象" href="promise.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html">stdlib 标准库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oop/index.html">面向对象编程</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">语法专题</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="single-thread.html">异步操作概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer.html">定时器</a></li>
<li class="toctree-l2"><a class="reference internal" href="promise.html">Promise 对象</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">严格模式</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#">设计目的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">启用方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#">显式报错</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">只读属性不可写</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">只设置了取值器的属性不可写</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">禁止扩展的对象不可扩展</a></li>
<li class="toctree-l4"><a class="reference internal" href="#evalarguments">eval、arguments 不可用作标识名</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">函数不能有重名的参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">禁止八进制的前缀0表示法</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">增强的安全措施</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">全局变量显式声明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#this">禁止 this 关键字指向全局对象</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fn-calleefn-caller">禁止使用 fn.callee、fn.caller</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arguments-calleearguments-caller">禁止使用 arguments.callee、arguments.caller</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">禁止删除变量</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">静态绑定</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#with">禁止使用 with 语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eval">创设 eval 作用域</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arguments">arguments 不再追踪参数的变化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#javascript">向下一个版本的 JavaScript 过渡</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">非函数代码块不得声明函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">保留字</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">参考链接</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ecmascript6.html">ECMAScript 6 介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecmascript6.html#">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecmascript6.html#es6">运行ES6文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecmascript6.html#es6es5">将ES6文件转为ES5文件</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM 模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bom/index.html">BOM 浏览器环境</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">语法专题</a> &raquo;</li>
        
      <li>严格模式</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>严格模式<a class="headerlink" href="#" title="永久链接至标题">¶</a></h1>
<p>除了正常的运行模式，JavaScript 还有第二种运行模式：严格模式（strict mode）。顾名思义，这种模式采用更加严格的 JavaScript 语法。</p>
<p>同样的代码，在正常模式和严格模式中，可能会有不一样的运行结果。一些在正常模式下可以运行的语句，在严格模式下将不能运行。</p>
<div class="section" id="">
<span id="id2"></span><h2>设计目的<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>早期的 JavaScript 语言有很多设计不合理的地方，但是为了兼容以前的代码，又不能改变老的语法，只能不断添加新的语法，引导程序员使用新语法。</p>
<p>严格模式是从 ES5 进入标准的，主要目的有以下几个。</p>
<ul class="simple">
<li>明确禁止一些不合理、不严谨的语法，减少 JavaScript 语言的一些怪异行为。</li>
<li>增加更多报错的场合，消除代码运行的一些不安全之处，保证代码运行的安全。</li>
<li>提高编译器效率，增加运行速度。</li>
<li>为未来新版本的 JavaScript 语法做好铺垫。</li>
</ul>
<p>总之，严格模式体现了 JavaScript 更合理、更安全、更严谨的发展方向。</p>
</div>
<div class="section" id="">
<span id="id3"></span><h2>启用方法<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>进入严格模式的标志，是一行字符串<code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">strict</span></code>。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>老版本的引擎会把它当作一行普通字符串，加以忽略。新版本的引擎就会进入严格模式。</p>
<p>严格模式可以用于整个脚本，也可以只用于单个函数。</p>
<p><strong>（1） 整个脚本文件</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">strict</span></code>放在脚本文件的第一行，整个脚本都将以严格模式运行。如果这行语句不在第一行就无效，整个脚本会以正常模式运行。(严格地说，只要前面不是产生实际运行结果的语句，<code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">strict</span></code>可以不在第一行，比如直接跟在一个空的分号后面，或者跟在注释后面。)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;这是严格模式&#39;</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;这是正常模式&#39;</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面代码中，一个网页文件依次有两段 JavaScript 代码。前一个<code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code>标签是严格模式，后一个不是。</p>
<p>如果<code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">strict</span></code>写成下面这样，则不起作用，严格模式必须从代码一开始就生效。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;这是正常模式&#39;</span><span class="p">);</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>（2）单个函数</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">strict</span></code>放在函数体的第一行，则整个函数以严格模式运行。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">strict</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="s1">&#39;这是严格模式&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">strict2</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;这也是严格模式&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">notStrict</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;这是正常模式&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>有时，需要把不同的脚本合并在一个文件里面。如果一个脚本是严格模式，另一个脚本不是，它们的合并就可能出错。严格模式的脚本在前，则合并后的脚本都是严格模式；如果正常模式的脚本在前，则合并后的脚本都是正常模式。这两种情况下，合并后的结果都是不正确的。这时可以考虑把整个脚本文件放在一个立即执行的匿名函数之中。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="c1">// some code here</span>
<span class="p">})();</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id4"></span><h2>显式报错<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>严格模式使得 JavaScript 的语法变得更严格，更多的操作会显式报错。其中有些操作，在正常模式下只会默默地失败，不会报错。</p>
<div class="section" id="">
<span id="id5"></span><h3>只读属性不可写<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>严格模式下，设置字符串的<code class="docutils literal notranslate"><span class="pre">length</span></code>属性，会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="c1">// TypeError: Cannot assign to read only property &#39;length&#39; of string &#39;abc&#39;</span>
</pre></div>
</div>
<p>上面代码报错，因为<code class="docutils literal notranslate"><span class="pre">length</span></code>是只读属性，严格模式下不可写。正常模式下，改变<code class="docutils literal notranslate"><span class="pre">length</span></code>属性是无效的，但不会报错。</p>
<p>严格模式下，对只读属性赋值，或者删除不可配置（non-configurable）属性都会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 对只读属性赋值会报错</span>
<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">({},</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">value</span><span class="o">:</span> <span class="mi">37</span><span class="p">,</span>
  <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="c1">// TypeError: Cannot assign to read only property &#39;a&#39; of object #&lt;Object&gt;</span>

<span class="c1">// 删除不可配置的属性会报错</span>
<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">({},</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>
<span class="k">delete</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">p</span>
<span class="c1">// TypeError: Cannot delete property &#39;p&#39; of #&lt;Object&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id6"></span><h3>只设置了取值器的属性不可写<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>严格模式下，对一个只有取值器（getter）、没有存值器（setter）的属性赋值，会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">get</span> <span class="nx">v</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">// Uncaught TypeError: Cannot set property v of #&lt;Object&gt; which has only a getter</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">obj.v</span></code>只有取值器，没有存值器，对它进行赋值就会报错。</p>
</div>
<div class="section" id="">
<span id="id7"></span><h3>禁止扩展的对象不可扩展<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>严格模式下，对禁止扩展的对象添加新属性，会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">preventExtensions</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// Uncaught TypeError: Cannot add property v, object is not extensible</span>
</pre></div>
</div>
<p>上面代码中，<code class="docutils literal notranslate"><span class="pre">obj</span></code>对象禁止扩展，添加属性就会报错。</p>
</div>
<div class="section" id="evalarguments">
<span id="evalarguments"></span><h3>eval、arguments 不可用作标识名<a class="headerlink" href="#evalarguments" title="永久链接至标题">¶</a></h3>
<p>严格模式下，使用<code class="docutils literal notranslate"><span class="pre">eval</span></code>或者<code class="docutils literal notranslate"><span class="pre">arguments</span></code>作为标识名，将会报错。下面的语句都会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nb">eval</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">arguments</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">set</span> <span class="nx">p</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">};</span>
<span class="k">try</span> <span class="p">{</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">x</span><span class="p">(</span><span class="nb">eval</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">arguments</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="kd">function</span> <span class="nb">eval</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;use strict&#39;; return 17;&quot;</span><span class="p">);</span>
<span class="c1">// SyntaxError: Unexpected eval or arguments in strict mode</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id8"></span><h3>函数不能有重名的参数<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>正常模式下，如果函数有多个重名的参数，可以用<code class="docutils literal notranslate"><span class="pre">arguments[i]</span></code>读取。严格模式下，这属于语法错误。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Uncaught SyntaxError: Duplicate parameter name not allowed in this context</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id9"></span><h3>禁止八进制的前缀0表示法<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>正常模式下，整数的第一位如果是<code class="docutils literal notranslate"><span class="pre">0</span></code>，表示这是八进制数，比如<code class="docutils literal notranslate"><span class="pre">0100</span></code>等于十进制的64。严格模式禁止这种表示法，整数第一位为<code class="docutils literal notranslate"><span class="pre">0</span></code>，将报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0100</span><span class="p">;</span>
<span class="c1">// Uncaught SyntaxError: Octal literals are not allowed in strict mode.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id10"></span><h2>增强的安全措施<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>严格模式增强了安全保护，从语法上防止了一些不小心会出现的错误。</p>
<div class="section" id="">
<span id="id11"></span><h3>全局变量显式声明<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>正常模式中，如果一个变量没有声明就赋值，默认是全局变量。严格模式禁止这种用法，全局变量必须显式声明。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 报错，v未声明</span>

<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 报错，i 未声明</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">()</span> <span class="c1">// 报错，未声明就创建一个全局变量</span>
</pre></div>
</div>
<p>因此，严格模式下，变量都必须先声明，然后再使用。</p>
</div>
<div class="section" id="this">
<span id="this"></span><h3>禁止 this 关键字指向全局对象<a class="headerlink" href="#this" title="永久链接至标题">¶</a></h3>
<p>正常模式下，函数内部的<code class="docutils literal notranslate"><span class="pre">this</span></code>可能会指向全局对象，严格模式禁止这种用法，避免无意间创造全局变量。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 正常模式</span>
<span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nb">window</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">()</span> <span class="c1">// true</span>

<span class="c1">// 严格模式</span>
<span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">()</span> <span class="c1">// true</span>
</pre></div>
</div>
<p>上面代码中，严格模式的函数体内部<code class="docutils literal notranslate"><span class="pre">this</span></code>是<code class="docutils literal notranslate"><span class="pre">undefined</span></code>。</p>
<p>这种限制对于构造函数尤其有用。使用构造函数时，有时忘了加<code class="docutils literal notranslate"><span class="pre">new</span></code>，这时<code class="docutils literal notranslate"><span class="pre">this</span></code>不再指向全局对象，而是报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">f</span><span class="p">();</span><span class="c1">// 报错，this 未定义</span>
</pre></div>
</div>
<p>严格模式下，函数直接调用时（不使用<code class="docutils literal notranslate"><span class="pre">new</span></code>调用），函数内部的<code class="docutils literal notranslate"><span class="pre">this</span></code>表示<code class="docutils literal notranslate"><span class="pre">undefined</span></code>（未定义），因此可以用<code class="docutils literal notranslate"><span class="pre">call</span></code>、<code class="docutils literal notranslate"><span class="pre">apply</span></code>和<code class="docutils literal notranslate"><span class="pre">bind</span></code>方法，将任意值绑定在<code class="docutils literal notranslate"><span class="pre">this</span></code>上面。正常模式下，<code class="docutils literal notranslate"><span class="pre">this</span></code>指向全局对象，如果绑定的值是非对象，将被自动转为对象再绑定上去，而<code class="docutils literal notranslate"><span class="pre">null</span></code>和<code class="docutils literal notranslate"><span class="pre">undefined</span></code>这两个无法转成对象的值，将被忽略。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 正常模式</span>
<span class="kd">function</span> <span class="nx">fun</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">fun</span><span class="p">()</span> <span class="c1">// window</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// Number {2}</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="c1">// Boolean {true}</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span> <span class="c1">// window</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span> <span class="c1">// window</span>

<span class="c1">// 严格模式</span>
<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">fun</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">fun</span><span class="p">()</span> <span class="c1">//undefined</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 2</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span> <span class="c1">// null</span>
<span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span> <span class="c1">// undefined</span>
</pre></div>
</div>
<p>上面代码中，可以把任意类型的值，绑定在<code class="docutils literal notranslate"><span class="pre">this</span></code>上面。</p>
</div>
<div class="section" id="fn-calleefn-caller">
<span id="fn-calleefn-caller"></span><h3>禁止使用 fn.callee、fn.caller<a class="headerlink" href="#fn-calleefn-caller" title="永久链接至标题">¶</a></h3>
<p>函数内部不得使用<code class="docutils literal notranslate"><span class="pre">fn.caller</span></code>、<code class="docutils literal notranslate"><span class="pre">fn.arguments</span></code>，否则会报错。这意味着不能在函数内部得到调用栈了。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f1</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="nx">f1</span><span class="p">.</span><span class="nx">caller</span><span class="p">;</span>    <span class="c1">// 报错</span>
  <span class="nx">f1</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span> <span class="c1">// 报错</span>
<span class="p">}</span>

<span class="nx">f1</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="arguments-calleearguments-caller">
<span id="arguments-calleearguments-caller"></span><h3>禁止使用 arguments.callee、arguments.caller<a class="headerlink" href="#arguments-calleearguments-caller" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">arguments.callee</span></code>和<code class="docutils literal notranslate"><span class="pre">arguments.caller</span></code>是两个历史遗留的变量，从来没有标准化过，现在已经取消了。正常模式下调用它们没有什么作用，但是不会报错。严格模式明确规定，函数内部使用<code class="docutils literal notranslate"><span class="pre">arguments.callee</span></code>、<code class="docutils literal notranslate"><span class="pre">arguments.caller</span></code>将会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">f</span><span class="p">();</span> <span class="c1">// 报错</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id12"></span><h3>禁止删除变量<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>严格模式下无法删除变量，如果使用<code class="docutils literal notranslate"><span class="pre">delete</span></code>命令删除一个变量，会报错。只有对象的属性，且属性的描述对象的<code class="docutils literal notranslate"><span class="pre">configurable</span></code>属性设置为<code class="docutils literal notranslate"><span class="pre">true</span></code>，才能被<code class="docutils literal notranslate"><span class="pre">delete</span></code>命令删除。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
<span class="k">delete</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// 语法错误</span>

<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">x</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="k">delete</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="c1">// 删除成功</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id13"></span><h2>静态绑定<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>JavaScript 语言的一个特点，就是允许“动态绑定”，即某些属性和方法到底属于哪一个对象，不是在编译时确定的，而是在运行时（runtime）确定的。</p>
<p>严格模式对动态绑定做了一些限制。某些情况下，只允许静态绑定。也就是说，属性和方法到底归属哪个对象，必须在编译阶段就确定。这样做有利于编译效率的提高，也使得代码更容易阅读，更少出现意外。</p>
<p>具体来说，涉及以下几个方面。</p>
<div class="section" id="with">
<span id="with"></span><h3>禁止使用 with 语句<a class="headerlink" href="#with" title="永久链接至标题">¶</a></h3>
<p>严格模式下，使用<code class="docutils literal notranslate"><span class="pre">with</span></code>语句将报错。因为<code class="docutils literal notranslate"><span class="pre">with</span></code>语句无法在编译时就确定，某个属性到底归属哪个对象，从而影响了编译效果。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">v</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kd">with</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">v</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Uncaught SyntaxError: Strict mode code may not include a with statement</span>
</pre></div>
</div>
</div>
<div class="section" id="eval">
<span id="eval"></span><h3>创设 eval 作用域<a class="headerlink" href="#eval" title="永久链接至标题">¶</a></h3>
<p>正常模式下，JavaScript 语言有两种变量作用域（scope）：全局作用域和函数作用域。严格模式创设了第三种作用域：<code class="docutils literal notranslate"><span class="pre">eval</span></code>作用域。</p>
<p>正常模式下，<code class="docutils literal notranslate"><span class="pre">eval</span></code>语句的作用域，取决于它处于全局作用域，还是函数作用域。严格模式下，<code class="docutils literal notranslate"><span class="pre">eval</span></code>语句本身就是一个作用域，不再能够在其所运行的作用域创设新的变量了，也就是说，<code class="docutils literal notranslate"><span class="pre">eval</span></code>所生成的变量只能用于<code class="docutils literal notranslate"><span class="pre">eval</span></code>内部。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;var x = 5; x&#39;</span><span class="p">))</span> <span class="c1">// 5</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1">// 2</span>
<span class="p">})()</span>
</pre></div>
</div>
<p>上面代码中，由于<code class="docutils literal notranslate"><span class="pre">eval</span></code>语句内部是一个独立作用域，所以内部的变量<code class="docutils literal notranslate"><span class="pre">x</span></code>不会泄露到外部。</p>
<p>注意，如果希望<code class="docutils literal notranslate"><span class="pre">eval</span></code>语句也使用严格模式，有两种方式。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// 方式一</span>
<span class="kd">function</span> <span class="nx">f1</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">f1</span><span class="p">(</span><span class="s1">&#39;undeclared_variable = 1&#39;</span><span class="p">);</span> <span class="c1">// 报错</span>

<span class="c1">// 方式二</span>
<span class="kd">function</span> <span class="nx">f2</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
  <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">f2</span><span class="p">(</span><span class="s1">&#39;&quot;use strict&quot;;undeclared_variable = 1&#39;</span><span class="p">)</span>  <span class="c1">// 报错</span>
</pre></div>
</div>
<p>上面两种写法，<code class="docutils literal notranslate"><span class="pre">eval</span></code>内部使用的都是严格模式。</p>
</div>
<div class="section" id="arguments">
<span id="arguments"></span><h3>arguments 不再追踪参数的变化<a class="headerlink" href="#arguments" title="永久链接至标题">¶</a></h3>
<p>变量<code class="docutils literal notranslate"><span class="pre">arguments</span></code>代表函数的参数。严格模式下，函数内部改变参数与<code class="docutils literal notranslate"><span class="pre">arguments</span></code>的联系被切断了，两者不再存在联动关系。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 正常模式为[2, 2]</span>

<span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 严格模式为[2, 1]</span>
</pre></div>
</div>
<p>上面代码中，改变函数的参数，不会反应到<code class="docutils literal notranslate"><span class="pre">arguments</span></code>对象上来。</p>
</div>
</div>
<div class="section" id="javascript">
<span id="javascript"></span><h2>向下一个版本的 JavaScript 过渡<a class="headerlink" href="#javascript" title="永久链接至标题">¶</a></h2>
<p>JavaScript语言的下一个版本是 ECMAScript 6，为了平稳过渡，严格模式引入了一些 ES6 语法。</p>
<div class="section" id="">
<span id="id14"></span><h3>非函数代码块不得声明函数<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>ES6 会引入块级作用域。为了与新版本接轨，ES5 的严格模式只允许在全局作用域或函数作用域声明函数。也就是说，不允许在非函数的代码块内声明函数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f1</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// 语法错误</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f2</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// 语法错误</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码在<code class="docutils literal notranslate"><span class="pre">if</span></code>代码块和<code class="docutils literal notranslate"><span class="pre">for</span></code>代码块中声明了函数，ES5 环境会报错。</p>
<p>注意，如果是 ES6 环境，上面的代码不会报错，因为 ES6 允许在代码块之中声明函数。</p>
</div>
<div class="section" id="">
<span id="id15"></span><h3>保留字<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>为了向将来 JavaScript 的新版本过渡，严格模式新增了一些保留字（implements、interface、let、package、private、protected、public、static、yield等）。使用这些词作为变量名将会报错。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="kr">package</span><span class="p">(</span><span class="kr">protected</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 语法错误</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="kr">implements</span><span class="p">;</span> <span class="c1">// 语法错误</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id16"></span><h2>参考链接<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>MDN, <a class="reference external" href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Functions_and_function_scope/Strict_mode">Strict mode</a></li>
<li>Dr. Axel Rauschmayer, <a class="reference external" href="http://www.2ality.com/2011/10/strict-mode-hatred.html">JavaScript: Why the hatred for strict mode?</a></li>
<li>Dr. Axel Rauschmayer，<a class="reference external" href="http://www.2ality.com/2011/01/javascripts-strict-mode-summary.html">JavaScript’s strict mode: a summary</a></li>
<li>Douglas Crockford, <a class="reference external" href="http://www.yuiblog.com/blog/2010/12/14/strict-mode-is-coming-to-town/">Strict Mode Is Coming To Town</a></li>
<li><a class="reference external" href="http://java-script.limewebs.com/strictMode/test_hosted.html">JavaScript Strict Mode Support</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ecmascript6.html" class="btn btn-neutral float-right" title="ECMAScript 6 介绍" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="promise.html" class="btn btn-neutral" title="Promise 对象" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>