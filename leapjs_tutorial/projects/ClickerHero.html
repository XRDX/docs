

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>点击英雄 &mdash; LeapJS 教程 beta 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Clicker Hero" href="ClickerHero_en.html" />
    <link rel="prev" title="项目列表" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> LeapJS 教程
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">LeapJS 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_shapes/index.html">绘图函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shapes/index.html">图形对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="../audio/index.html">音乐与音效</a></li>
<li class="toctree-l1"><a class="reference internal" href="../events/index.html">事件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transform/transform.html">图形变换</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physical/index.html">碰撞</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">项目列表</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">点击英雄</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#">教学阶段</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">项目体验</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">开发环境</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ide">IDE介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">坐标介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">插入图片</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">行动起来</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">点击事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">随机位置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">显示分数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">播放声音</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">代码重构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">难度提升</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">游戏结束</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">重新开始</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#">挑战阶段</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ClickerHero_en.html">Clicker Hero</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LeapJS 教程</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">项目列表</a> &raquo;</li>
        
      <li>点击英雄</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>点击英雄<a class="headerlink" href="#" title="永久链接至标题">¶</a></h1>
<div class="section" id="">
<span id="id2"></span><h2>教学阶段<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<div class="section" id="">
<span id="id3"></span><h3>项目体验<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>打开网址：<a class="reference external" href="http://ide.leaplearner.com/lmumov/1">http://ide.leaplearner.com/lmumov/1</a>，或者扫描一下二维码体验项目</p>
<p><img alt="" src="../_images/clicker.png" /></p>
</div>
<div class="section" id="">
<span id="id4"></span><h3>开发环境<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>打开网址: <a class="reference external" href="http://ide.leaplearner.com/jincai/1/edit?js,output">http://ide.leaplearner.com/jincai/1/edit</a>，点击<code class="docutils literal notranslate"><span class="pre">projects</span></code>-&gt;<code class="docutils literal notranslate"><span class="pre">clone</span></code>开始自己的项目。记录网址中间的这一串6个特殊字符，它是每个人项目的标示。</p>
<p>在IDE中我们添加了一些代码，是一些我们将要使用的资源地址，建议保留。</p>
</div>
<div class="section" id="ide">
<span id="ide"></span><h3>IDE介绍<a class="headerlink" href="#ide" title="永久链接至标题">¶</a></h3>
<p>下面是立乐IDE的一个截图，如果和截图不一样没关系，点击上面的标签名称就可以打开或者关闭对应的页签。介绍几个主要区域：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">JavaScript</span></code>区域，这里是代码区域，也是我们输入代码的地方，是最重要的地方</li>
<li><code class="docutils literal notranslate"><span class="pre">Output</span></code>区域，这里是展示区域，用于展示输出效果</li>
</ul>
<p><img alt="ide" src="../_images/ide1.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">Share</span></code>: 点击后生成链接和二维码，可以通过手机扫描获取到项目展示信息。</p>
<p><code class="docutils literal notranslate"><span class="pre">Run</span></code>: 点击后执行JavaScript代码。每次点击<code class="docutils literal notranslate"><span class="pre">Run</span></code>都会重新开始执行。</p>
<p><code class="docutils literal notranslate"><span class="pre">Auto-run</span></code>: 勾选后，只要修改代码便会自动执行代码。</p>
<p><code class="docutils literal notranslate"><span class="pre">↗</span></code>：点击后在打开一个新页签，展示项目。</p>
<p><code class="docutils literal notranslate"><span class="pre">html</span></code>：描述网页内容的的。</p>
<p><code class="docutils literal notranslate"><span class="pre">console</span></code>：控制台，在激活状态下，会将日志信息和报错信息输出到这里。</p>
<p><code class="docutils literal notranslate"><span class="pre">css</span></code>: 用于配置网页的样式，在本书中暂不涉及。</p>
</div>
<div class="section" id="">
<span id="id5"></span><h3>坐标介绍<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>为了定义空间的位置，数学家们发明了坐标的概念，在此至上发展出了庞大的几何学科。在计算机图形中，坐标系统更是不可或缺。</p>
<p>我们将左上角的坐标定义为<code class="docutils literal notranslate"><span class="pre">(0,0)</span></code>，把水平轴为<code class="docutils literal notranslate"><span class="pre">x轴</span></code>，把垂直坐标定义为<code class="docutils literal notranslate"><span class="pre">y轴</span></code>。平面上的任意一个点，在<code class="docutils literal notranslate"><span class="pre">x轴</span></code>上的投影称之为该点的<code class="docutils literal notranslate"><span class="pre">x坐标</span></code>，同样，在<code class="docutils literal notranslate"><span class="pre">y轴</span></code>上的投影即<code class="docutils literal notranslate"><span class="pre">y坐标</span></code>。因此，整个坐标系看起来像是这个样子的。</p>
<p><img alt="pos_xy" src="../_images/axis2.png" /></p>
<p>只要确定了坐标点的值，我们就能很容易的确定坐标的位置了。</p>
<blockquote>
<div><p>小知识：笛卡尔坐标系和网页坐标系</p>
<p>和数学上常见的笛卡尔坐标系不同的是，网页坐标系的y轴正方向朝下。这是因为人类阅读习惯于从左到右，从上到下，在浏览器的定位系统中，根据这个习惯来定义坐标的位置，使得在网页设计时更为合理。</p>
</div></blockquote>
</div>
<div class="section" id="">
<span id="id6"></span><h3>插入图片<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>用到了Sprite这个类，它的定义是这样的。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Sprite</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>，是图片的地址，一般以<code class="docutils literal notranslate"><span class="pre">jpg</span></code>或者<code class="docutils literal notranslate"><span class="pre">png</span></code>结尾</li>
<li><code class="docutils literal notranslate"><span class="pre">x</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span></code>，图片左上角的横坐标和纵坐标</li>
<li><code class="docutils literal notranslate"><span class="pre">width</span></code>、<code class="docutils literal notranslate"><span class="pre">height</span></code>，图片在画布上显示的宽度和高度</li>
</ul>
<p>最后，使用图片对象的<code class="docutils literal notranslate"><span class="pre">draw</span></code>方法将图片绘制在画布上。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://orjajlo36.bkt.clouddn.com/backgroundimage2.jpg&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">550</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://ou1htxdl4.bkt.clouddn.com/coin.png&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
<span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
</pre></div>
</div>
<p>点击执行，就可以将这两张图片绘制在画布上了。</p>
</div>
<div class="section" id="">
<span id="id7"></span><h3>行动起来<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>接下来，就是让物体开始运动起来了。画布上，我们每隔一段时间<code class="docutils literal notranslate"><span class="pre">(16.7ms)</span></code>将图形重新绘制一次，因为频率非常块，看起来就像是动起来一样。</p>
<p>这里我们需要先定义一个<code class="docutils literal notranslate"><span class="pre">GameLoop</span></code>函数，它的作用是在每一帧里绘制图形，同时在下一帧中调用自己。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  
    <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">loadRssAndRun</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
</pre></div>
</div>
<p>在<code class="docutils literal notranslate"><span class="pre">GameLoop</span></code>中，我们让物体的y值每次都增加一，以达到每次往下移动的效果。最后，我们用一个函数<code class="docutils literal notranslate"><span class="pre">loadRssAndRun(GameLoop);</span></code>来加载图片并且开始执行这个循环。</p>
<p>完整代码如下：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://orjajlo36.bkt.clouddn.com/backgroundimage2.jpg&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">550</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://ou1htxdl4.bkt.clouddn.com/coin.png&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  
    <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">loadRssAndRun</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id8"></span><h3>点击事件<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>在点中物体时，我们需要让物体消失，然后刷新出一个新的物体。事实上，我们不用这么麻烦，把物体的坐标修改为0就可以了。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id9"></span><h3>随机位置<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>每次都是固定的位置显然不好玩，让我们同时修改下物体的水平位置，使用一个随机的概念。<code class="docutils literal notranslate"><span class="pre">Math.random()</span></code>会产生一个0到1的随机数，乘以300，即随机生成一个0到300的随机数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id10"></span><h3>显示分数<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>接下来就是记录游戏的分数了。让我们新增一个变量<code class="docutils literal notranslate"><span class="pre">score</span></code>，初始值为0。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>数字是没法直接显示出来的，我们需要将数字转为字符串，利用JavaScript中字符串＋数字，自动将数字转为字符串的特性，我们可以实现数字的转换。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">scoreMsg</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">scoreMsg</span> <span class="o">=</span> <span class="s2">&quot;score:&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">;</span>
  
    <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">scoreMsg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>当然，别忘了在成功点击物体时增加分数，否则分数就不会增加啦。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
    <span class="nx">score</span><span class="o">++</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>完整代码如下</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://orjajlo36.bkt.clouddn.com/backgroundimage2.jpg&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">550</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://ou1htxdl4.bkt.clouddn.com/coin.png&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">scoreMsg</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">scoreMsg</span> <span class="o">=</span> <span class="s2">&quot;score:&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">;</span>
  
    <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">scoreMsg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">loadRssAndRun</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>

<span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
    <span class="nx">score</span><span class="o">++</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id11"></span><h3>播放声音<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>没有声音，再好的戏也出不来。让我们来增加两个声音，背景音乐和点击音效，这里增加了两个新的声音对象</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bgm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://oq2qlcey8.bkt.clouddn.com/bgm.mp3&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">clickSound</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">clickSound</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://llcs-1252287760.cossh.myqcloud.com/audio/gold.mp3&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>背景音乐我们需要让它循环播放，因此设置<code class="docutils literal notranslate"><span class="pre">loop</span></code>属性为<code class="docutils literal notranslate"><span class="pre">true</span></code></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bgm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://oq2qlcey8.bkt.clouddn.com/bgm.mp3&quot;</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
</pre></div>
</div>
<p>而物体点击音效则是在点击的时候播放，因此我们把它加在点击时</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
    <span class="nx">score</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">clickSound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
<p>最终代码</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://orjajlo36.bkt.clouddn.com/backgroundimage2.jpg&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">550</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://ou1htxdl4.bkt.clouddn.com/coin.png&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">bgm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://oq2qlcey8.bkt.clouddn.com/bgm.mp3&quot;</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">clickSound</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">clickSound</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://llcs-1252287760.cossh.myqcloud.com/audio/gold.mp3&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">scoreMsg</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
   <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="nx">scoreMsg</span> <span class="o">=</span> <span class="s2">&quot;score:&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">;</span>
 
   <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
   <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
   <span class="nx">scoreMsg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
   <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">loadRssAndRun</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>

<span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
   <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
   <span class="nx">score</span><span class="o">++</span><span class="p">;</span>
   <span class="nx">clickSound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id12"></span><h3>代码重构<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>在进入下一章节前，我们先对我们的程序进行一个小小的重构。在改变速度这里，我们使用了这么一行代码</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>这里1代表的是速度，但是并不直观。所以我们定义一个变量<code class="docutils literal notranslate"><span class="pre">speed</span></code>来表达它。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">scoreMsg</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">speed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">...</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">speed</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id13"></span><h3>难度提升<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>接下来，就是我们对游戏的难度进行修改。我们在每一次分数增加的时候去提高物体掉落的速度，这样就能提高游戏难度了！</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
    <span class="nx">score</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">speed</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">clickSound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
<p>如果你觉得难度变化太大，你可以降低这个数值，让速度的增长变的慢一点。</p>
</div>
<div class="section" id="">
<span id="id14"></span><h3>游戏结束<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>游戏结束时，我们在屏幕上写上Game Over。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">GameOver</span><span class="p">(){</span>
    <span class="s1">&#39;Game Over&#39;</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>怎么判断游戏结束呢，先用一段伪代码来表示</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>如果物体超出了画布:
    游戏结束
其他情况下：
    继续游戏循环
</pre></div>
</div>
<p>在JavaScript中，就可以写成</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="p">...</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
        <span class="nx">GameOver</span><span class="p">();</span>
    <span class="k">else</span>
        <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id15"></span><h3>重新开始<a class="headerlink" href="#" title="永久链接至标题">¶</a></h3>
<p>重新开始游戏循环前，我们要做这几件事情</p>
<ul class="simple">
<li>把分数清零</li>
<li>把物体放回到最上方</li>
<li>把速度变为最初的速度</li>
</ul>
<p>最后执行游戏循环。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">GameStart</span><span class="p">(){</span>
    <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">speed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">GameLoop</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>那什么时候触发游戏重新开始呢，当然是游戏结束的时候了。我们需要在游戏结束时添加一个按钮来激活它。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">retry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span> <span class="s2">&quot;http://osykyzwcn.bkt.clouddn.com/SHAYUx0001.png&quot;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="nx">retry</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="nx">GameStart</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameOver</span><span class="p">(){</span>
    <span class="s2">&quot;Game Over&quot;</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
    <span class="nx">retry</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>    
<span class="p">}</span>
</pre></div>
</div>
<p>当游戏结束的时候，这个按钮就会被绘制到画布上，点击就可以重新开始游戏啦。</p>
<p>最终代码</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://orjajlo36.bkt.clouddn.com/backgroundimage2.jpg&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">550</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="s2">&quot;http://ou1htxdl4.bkt.clouddn.com/coin.png&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">bgm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://oq2qlcey8.bkt.clouddn.com/bgm.mp3&quot;</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">bgm</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">sound</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
<span class="nx">sound</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://llcs-1252287760.cossh.myqcloud.com/audio/gold.mp3&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">speed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">hiscore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">item</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">score</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">speed</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="nx">sound</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">sound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">300</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">GameStart</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">speed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">GameLoop</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">GameLoop</span><span class="p">(){</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">speed</span><span class="p">;</span>
    
    <span class="nx">bg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
    
    <span class="kd">var</span> <span class="nx">scoreMsg</span> <span class="o">=</span> <span class="s2">&quot;Score: &quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">;</span>
    <span class="nx">scoreMsg</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="nx">GameOver</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="nx">nextFrame</span><span class="p">(</span><span class="nx">GameLoop</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">retry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span> <span class="s2">&quot;http://osykyzwcn.bkt.clouddn.com/SHAYUx0001.png&quot;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="nx">retry</span><span class="p">.</span><span class="nx">click</span> <span class="o">=</span> <span class="nx">GameStart</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameOver</span><span class="p">(){</span>
    <span class="s2">&quot;Game Over&quot;</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
    <span class="nx">retry</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>    
<span class="p">}</span>

<span class="nx">loadRssAndRun</span><span class="p">(</span><span class="nx">GameStart</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="">
<span id="id16"></span><h2>挑战阶段<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>初级：</p>
<ul class="simple">
<li>替换图片、音乐素材资源</li>
<li>修改游戏参数，调整游戏难度</li>
</ul>
<p>中级：</p>
<ul class="simple">
<li>让道具从其他方向出现</li>
<li>在界面上添加更多丰富的元素</li>
</ul>
<p>高阶：</p>
<ul class="simple">
<li>同时掉落更多道具</li>
<li>运动方向多样化</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ClickerHero_en.html" class="btn btn-neutral float-right" title="Clicker Hero" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="项目列表" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vic Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'beta',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/GA.js"></script>
      <script type="text/javascript" src="../_static/googleAnalysis.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>